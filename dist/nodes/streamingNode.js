var _0x8aec=['stampm','Diff\x20ticks:','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20','floor','\x0a\x0asetSlaveOffset:\x20ERROR\x20-\x20timestamps\x20DO\x20NOT\x20match!','\x0aNode:\x20','\x0aZero\x20index,\x20last\x20offset:\x20','\x0aDifference\x20(buffer\x20-\x20zero):\x20','\x20-\x20','\x0a\x0a\x0a','checkDataAvailability','maxNegativeOffset','attributes','time','offsetExists','offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20','\x20-\x20(','deleteObsoleteRows','Rows\x20to\x20delete\x20(','):\x20','createAggregates','field','tick','rawstore','timeSeriesTick','Time','ema','interval','initWindow','winsize','addStreamAggr','|winbuf|','sub','|variance|','winBufMin','max','|max|','getAggregates','getFloat','name','push','timeDiff','exports','../brokers/brokers.js','base','aggregate','master','config','stringify','connectionConfig','parse','topic','fusionNodeI','parent','fusionTick','nodeid','position','postConstructor','type','client','fusion_id','nodeId','addListener','bind','connection','mqtt','broker','log','PROBLEM:\x20No\x20connection\x20(OK\x20for\x20tests)!','connectToKafka','Connecting\x20to\x20Kafka:\x20','Consumer','zookeeper','offset','Offset','consumer','Message\x20receieved.','value','processRecord','ERROR','error','Error','min','partition','setOffset','setMasterOffset','buffer','length','getOffsetTimestamp'];(function(_0x2766bd,_0x485e42){var _0x5b8bb5=function(_0x5c21e5){while(--_0x5c21e5){_0x2766bd['push'](_0x2766bd['shift']());}};var _0x55bfe4=function(){var _0x169b59={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x2ae61f,_0x350988,_0x4dcf15,_0x18b33e){_0x18b33e=_0x18b33e||{};var _0x148925=_0x350988+'='+_0x4dcf15;var _0x5b7df9=0x0;for(var _0x5b7df9=0x0,_0x1c07f3=_0x2ae61f['length'];_0x5b7df9<_0x1c07f3;_0x5b7df9++){var _0x3181fd=_0x2ae61f[_0x5b7df9];_0x148925+=';\x20'+_0x3181fd;var _0x424c00=_0x2ae61f[_0x3181fd];_0x2ae61f['push'](_0x424c00);_0x1c07f3=_0x2ae61f['length'];if(_0x424c00!==!![]){_0x148925+='='+_0x424c00;}}_0x18b33e['cookie']=_0x148925;},'removeCookie':function(){return'dev';},'getCookie':function(_0x5332f7,_0x516c58){_0x5332f7=_0x5332f7||function(_0x41860d){return _0x41860d;};var _0x46d103=_0x5332f7(new RegExp('(?:^|;\x20)'+_0x516c58['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x53fbc1=function(_0x35003e,_0x38a26e){_0x35003e(++_0x38a26e);};_0x53fbc1(_0x5b8bb5,_0x485e42);return _0x46d103?decodeURIComponent(_0x46d103[0x1]):undefined;}};var _0x5b26ca=function(){var _0x154bb3=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x154bb3['test'](_0x169b59['removeCookie']['toString']());};_0x169b59['updateCookie']=_0x5b26ca;var _0x57a727='';var _0xc44428=_0x169b59['updateCookie']();if(!_0xc44428){_0x169b59['setCookie'](['*'],'counter',0x1);}else if(_0xc44428){_0x57a727=_0x169b59['getCookie'](null,'counter');}else{_0x169b59['removeCookie']();}};_0x55bfe4();}(_0x8aec,0x194));var _0x411a=function(_0x5d0e9e,_0x105ca5){_0x5d0e9e=_0x5d0e9e-0x0;var _0xbe1a75=_0x8aec[_0x5d0e9e];return _0xbe1a75;};var _0x5bc505=function(){var _0x4664ff=!![];return function(_0x9c6dbc,_0x100e68){var _0x1732f2=_0x4664ff?function(){if(_0x100e68){var _0x1249fc=_0x100e68['apply'](_0x9c6dbc,arguments);_0x100e68=null;return _0x1249fc;}}:function(){};_0x4664ff=![];return _0x1732f2;};}();var _0x4f1ad7=_0x5bc505(this,function(){var _0x25f6e2=function(){return'\x64\x65\x76';},_0x4998f0=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x391e92=function(){var _0x562627=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x562627['\x74\x65\x73\x74'](_0x25f6e2['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x5740ca=function(){var _0xfddcc2=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0xfddcc2['\x74\x65\x73\x74'](_0x4998f0['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4c5095=function(_0x5dc074){var _0x3b3a9b=~-0x1>>0x1+0xff%0x0;if(_0x5dc074['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x3b3a9b)){_0x207f70(_0x5dc074);}};var _0x207f70=function(_0x2c74e3){var _0x53be1f=~-0x4>>0x1+0xff%0x0;if(_0x2c74e3['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x53be1f){_0x4c5095(_0x2c74e3);}};if(!_0x391e92()){if(!_0x5740ca()){_0x4c5095('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x4c5095('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x4c5095('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x4f1ad7();const kafka=require('kafka-node');const {KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require(_0x411a('0x0'));class streamingNode{constructor(_0x16a7dc,_0x388ce3,_0x1e4886,_0x4c15cd,_0x1efbb2,_0x39798a,_0x34c63b){this[_0x411a('0x1')]=_0x16a7dc;this[_0x411a('0x2')]={};this[_0x411a('0x3')]=_0x1e4886[_0x411a('0x3')];this[_0x411a('0x4')]=JSON['parse'](JSON[_0x411a('0x5')](_0x1e4886));this[_0x411a('0x6')]=JSON[_0x411a('0x7')](JSON['stringify'](_0x388ce3));this[_0x411a('0x8')]='measurements_node_'+this['config']['nodeid'];this[_0x411a('0x9')]=_0x39798a;this['processRecordCb']=_0x1efbb2;this[_0x411a('0xa')]=_0x34c63b;this[_0x411a('0xb')]=_0x1e4886['fusionTick'];this['nodeId']=_0x1e4886[_0x411a('0xc')];this['buffer']=[];this[_0x411a('0xd')]=0x0;}[_0x411a('0xe')](){let _0x827b02=this;if(this[_0x411a('0xa')]!=null){if(this[_0x411a('0xa')][_0x411a('0x4')]['connection'][_0x411a('0xf')]=='kafka'){this['broker']=new KafkaNodeBroker(this[_0x411a('0x6')],this['topic'],_0x411a('0x10')+ +this[_0x411a('0xa')][_0x411a('0x11')]+this[_0x411a('0x12')]);this['broker'][_0x411a('0x13')](_0x827b02['processRecord'][_0x411a('0x14')](_0x827b02));}else if(this[_0x411a('0xa')]['config'][_0x411a('0x15')][_0x411a('0xf')]==_0x411a('0x16')){this[_0x411a('0x17')]=new MQTTBroker(this[_0x411a('0x6')],this[_0x411a('0x8')],_0x411a('0x10')+this['parent'][_0x411a('0x11')]+this[_0x411a('0x12')]);this[_0x411a('0x17')][_0x411a('0x13')](_0x827b02['processRecord'][_0x411a('0x14')](_0x827b02));}else{console[_0x411a('0x18')](_0x411a('0x19'));}}else{console['log']('PROBLEM:\x20No\x20parent\x20defined.\x20No\x20connection\x20(OK\x20for\x20tests).');}}['isMaster'](){return this[_0x411a('0x3')];}[_0x411a('0x1a')](){console['log'](_0x411a('0x1b')+this[_0x411a('0x8')]);this[_0x411a('0x1c')]=kafka[_0x411a('0x1c')];this[_0x411a('0x10')]=new kafka['Client'](this[_0x411a('0x6')][_0x411a('0x1d')],this['id']);this[_0x411a('0x1e')]=new kafka[(_0x411a('0x1f'))](this['client']);let _0x16a873=this;this[_0x411a('0x20')]=new this[(_0x411a('0x1c'))](this[_0x411a('0x10')],[{'topic':this['topic'],'partition':0x0}],{'groupId':this['id']});this['consumer']['on']('message',function(_0x4dc95f){try{console[_0x411a('0x18')](_0x411a('0x21'));let _0x212117=JSON['parse'](_0x4dc95f[_0x411a('0x22')]);_0x16a873[_0x411a('0x23')](_0x212117);}catch(_0x3820d1){console[_0x411a('0x18')](_0x411a('0x24'),_0x3820d1);}});this[_0x411a('0x20')]['on'](_0x411a('0x25'),function(_0x51c618){console[_0x411a('0x18')](_0x411a('0x26'),_0x51c618);});this[_0x411a('0x20')]['on']('offsetOutOfRange',function(_0xf78f1b){console['log'](_0x16a873['id'],'outOfRange',_0xf78f1b);_0xf78f1b['maxNum']=0x2;_0x16a873[_0x411a('0x1e')]['fetch']([_0xf78f1b],function(_0x172f65,_0x294eb1){if(_0x172f65){return console['error'](_0x172f65);}var _0x1d1078=Math[_0x411a('0x27')](_0x294eb1[_0xf78f1b[_0x411a('0x8')]][_0xf78f1b[_0x411a('0x28')]]);console[_0x411a('0x18')](_0x16a873);_0x16a873[_0x411a('0x20')][_0x411a('0x29')](_0xf78f1b[_0x411a('0x8')],_0xf78f1b[_0x411a('0x28')],_0x1d1078);});});}['broadcastAggregates'](_0x22305e){}[_0x411a('0x2a')](){this[_0x411a('0xd')]=this[_0x411a('0x2b')][_0x411a('0x2c')]-0x1;}[_0x411a('0x2d')](){return this[_0x411a('0x2b')][this['position']]['stampm'];}['setSlaveOffset'](_0x218d98){if(this[_0x411a('0x2b')]['length']==0x0){console[_0x411a('0x18')]('setSlaveIndex:\x20there\x20is\x20no\x20data\x20-\x20'+this[_0x411a('0x12')]);return![];}let _0x4c5a38=this[_0x411a('0x2b')][_0x411a('0x2c')]-0x1;let _0x34ac19=this['buffer'][_0x4c5a38][_0x411a('0x2e')];let _0x4ba842=(_0x34ac19-_0x218d98)/this[_0x411a('0xb')];console[_0x411a('0x18')]('Fusion\x20tick',this[_0x411a('0xb')],_0x411a('0x2f'),_0x4ba842);let _0x293ea8=_0x4c5a38-_0x4ba842;if(_0x293ea8<0x0){console[_0x411a('0x18')](_0x411a('0x30')+this[_0x411a('0x12')]+'('+_0x293ea8+'/'+_0x4c5a38+')@'+this[_0x411a('0xa')][_0x411a('0x11')]);return![];}else if(_0x293ea8>_0x4c5a38){console[_0x411a('0x18')](_0x411a('0x31')+this[_0x411a('0x12')]+'('+_0x293ea8+'/'+_0x4c5a38+')@'+this['parent'][_0x411a('0x11')]);return![];}else if(_0x293ea8!=Math[_0x411a('0x32')](_0x293ea8)){console[_0x411a('0x18')]('setSlaveOffset:\x20zeroIndex\x20is\x20not\x20a\x20whole\x20number\x20-\x20'+_0x293ea8);}console[_0x411a('0x18')](_0x293ea8);if(this[_0x411a('0x2b')][_0x293ea8][_0x411a('0x2e')]!=_0x218d98){console['log'](_0x411a('0x33'));console['log'](_0x411a('0x34')+this[_0x411a('0x12')]);console[_0x411a('0x18')](_0x411a('0x35')+_0x293ea8+',\x20'+_0x4c5a38);console[_0x411a('0x18')](_0x411a('0x36')+this['buffer'][_0x293ea8][_0x411a('0x2e')]+_0x411a('0x37')+_0x218d98);console['log'](_0x411a('0x38'));}this[_0x411a('0xd')]=_0x293ea8;return!![];}[_0x411a('0x39')](){let _0x8bdc31=!![];this[_0x411a('0x3a')]=0x0;for(let _0x1181c4 in this[_0x411a('0x4')][_0x411a('0x3b')]){let _0x3d6b5a=this[_0x411a('0x4')]['attributes'][_0x1181c4][_0x411a('0x3c')];if(_0x3d6b5a<this[_0x411a('0x3a')])this['maxNegativeOffset']=_0x3d6b5a;if(!this[_0x411a('0x3d')](_0x3d6b5a))_0x8bdc31=![];}return _0x8bdc31;}['offsetExists'](_0x5953d0){let _0x4cd1f2=this[_0x411a('0xd')]+_0x5953d0;let _0x277b1d=this[_0x411a('0x2b')][_0x411a('0x2c')]-0x1;if(_0x4cd1f2<0x0){console[_0x411a('0x18')](_0x411a('0x3e')+this[_0x411a('0x12')]+_0x411a('0x3f')+_0x4cd1f2+')');return![];}else if(_0x4cd1f2>_0x277b1d){console[_0x411a('0x18')]('offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20'+this['nodeId']+this[_0x411a('0x12')]+_0x411a('0x3f')+_0x4cd1f2+'/'+_0x277b1d+')');return![];}return!![];}[_0x411a('0x40')](){let _0x455fec=this[_0x411a('0xd')]+this[_0x411a('0x3a')]-0x5;console[_0x411a('0x18')](_0x411a('0x41')+this[_0x411a('0x12')]+',\x20'+this['parent'][_0x411a('0x11')]+_0x411a('0x42')+_0x455fec+'\x20/\x20'+this[_0x411a('0x2b')]['length']);for(let _0x3d5715=0x1;_0x3d5715<_0x455fec;_0x3d5715++)this[_0x411a('0x2b')]['shift']();}[_0x411a('0x43')](_0xc1117d){for(let _0x5f04e4 in _0xc1117d){let _0x18b9d6=_0xc1117d[_0x5f04e4];let _0x3abee5=_0x18b9d6[_0x411a('0x44')];let _0x1a125f=_0x18b9d6[_0x411a('0x45')];let _0x4e721c=this[_0x411a('0x46')]['addStreamAggr']({'type':_0x411a('0x47'),'timestamp':_0x411a('0x48'),'value':_0x3abee5});let _0x3406fa=_0x3abee5+'|tick';this[_0x411a('0x2')][_0x3406fa]=_0x4e721c;for(let _0x3505f9 in _0x1a125f){let _0x5cc634=_0x1a125f[_0x3505f9];let _0x2f2f2b=_0x5cc634[_0x411a('0xf')];if(_0x2f2f2b==_0x411a('0x49')){let _0x13464c=_0x5cc634[_0x411a('0x4a')];let _0x29090f=_0x5cc634[_0x411a('0x4b')];let _0x4e721c=this[_0x411a('0x46')]['addStreamAggr']({'type':'ema','inAggr':this['aggregate'][_0x3406fa],'emaType':'previous','interval':_0x13464c,'initWindow':_0x29090f});let _0x517fac=_0x3abee5+'|ema|'+_0x13464c;this[_0x411a('0x2')][_0x517fac]=_0x4e721c;}else if(_0x2f2f2b=='winbuf'){let _0xc990f8=_0x5cc634[_0x411a('0x4c')];let _0x4e721c=this[_0x411a('0x46')][_0x411a('0x4d')]({'type':'timeSeriesWinBufVector','inAggr':this[_0x411a('0x2')][_0x3406fa],'winsize':_0xc990f8});let _0x270894=_0x3abee5+_0x411a('0x4e')+_0xc990f8;this[_0x411a('0x2')][_0x270894]=_0x4e721c;let _0x5d3d32=_0x5cc634[_0x411a('0x4f')];for(var _0x72e73f in _0x5d3d32){let _0x394acf=_0x5d3d32[_0x72e73f];let _0x3e62a2=_0x394acf[_0x411a('0xf')];if(_0x3e62a2=='variance'){let _0x4e721c=this[_0x411a('0x46')][_0x411a('0x4d')]({'type':'variance','inAggr':this[_0x411a('0x2')][_0x270894]});let _0x4c82cd=_0x3abee5+_0x411a('0x50')+_0xc990f8;this[_0x411a('0x2')][_0x4c82cd]=_0x4e721c;}else if(_0x3e62a2=='ma'){let _0x4e721c=this[_0x411a('0x46')][_0x411a('0x4d')]({'type':'ma','inAggr':this[_0x411a('0x2')][_0x270894]});let _0x23176f=_0x3abee5+'|ma|'+_0xc990f8;this[_0x411a('0x2')][_0x23176f]=_0x4e721c;}else if(_0x3e62a2==_0x411a('0x27')){let _0x4e721c=this[_0x411a('0x46')][_0x411a('0x4d')]({'type':_0x411a('0x51'),'inAggr':this['aggregate'][_0x270894]});let _0x2597ec=_0x3abee5+'|min|'+_0xc990f8;this['aggregate'][_0x2597ec]=_0x4e721c;}else if(_0x3e62a2==_0x411a('0x52')){let _0x4e721c=this['rawstore'][_0x411a('0x4d')]({'type':'winBufMax','inAggr':this['aggregate'][_0x270894]});let _0x21c6af=_0x3abee5+_0x411a('0x53')+_0xc990f8;this[_0x411a('0x2')][_0x21c6af]=_0x4e721c;}}}}}}[_0x411a('0x54')](){var _0x1e6ce9={};for(let _0x58b296 in this[_0x411a('0x2')]){if(!(_0x58b296['indexOf'](_0x411a('0x45'))>0x0||_0x58b296['indexOf']('winbuf')>0x0)){_0x1e6ce9[_0x58b296]=this[_0x411a('0x2')][_0x58b296][_0x411a('0x55')]();_0x1e6ce9['stampm']=this[_0x411a('0x2')][_0x58b296]['getTimestamp']();};};return _0x1e6ce9;}['getPartialFeatureVector'](){let _0x6919f2=[];for(let _0xfa2944 in this[_0x411a('0x4')][_0x411a('0x3b')]){let _0x517b2e=this[_0x411a('0xd')];let _0x3308e7=this[_0x411a('0x2b')][_0x517b2e][_0x411a('0x2e')];let _0x3a4afa=this[_0x411a('0x4')][_0x411a('0x3b')][_0xfa2944]['attributes'];let _0x3b7de=this[_0x411a('0x4')]['attributes'][_0xfa2944][_0x411a('0x3c')];_0x517b2e=_0x517b2e+_0x3b7de;let _0x24cdcf=_0x3308e7+_0x3b7de*this['fusionTick'];let _0x51cb3c=this['buffer'][_0x517b2e][_0x411a('0x2e')];if(_0x24cdcf!=_0x51cb3c){while(_0x51cb3c-_0x24cdcf<0x0){_0x517b2e++;_0x51cb3c=this[_0x411a('0x2b')][_0x517b2e]['stampm'];}if(_0x51cb3c!=_0x24cdcf)_0x517b2e--;}for(let _0x20ad5e in _0x3a4afa){let _0x261cdd=_0x3a4afa[_0x20ad5e][_0x411a('0xf')];let _0x1b6a43=_0x3a4afa[_0x20ad5e][_0x411a('0x56')];if(_0x261cdd=='value'){let _0x76fc2a=this[_0x411a('0x2b')][_0x517b2e][_0x1b6a43];_0x6919f2[_0x411a('0x57')](_0x76fc2a);}else if(_0x261cdd==_0x411a('0x58')){let _0x404615=_0x517b2e-_0x3a4afa[_0x20ad5e][_0x411a('0x4a')];let _0x76fc2a=this['buffer'][_0x404615][_0x1b6a43]-this['buffer'][_0x517b2e][_0x1b6a43];_0x6919f2['push'](_0x76fc2a);}}}return _0x6919f2;}}module[_0x411a('0x59')]=streamingNode;