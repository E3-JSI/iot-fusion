const streamingNode = require('../nodes/streamingNode.js');
const streamingEnergyNode = require('../nodes/streamingEnergyNode.js');
const streamingWeatherNode = require('../nodes/streamingWeatherNode.js');
const streamingStaticNode = require('../nodes/streamingStaticNode.js');
const fileManager = require('../../common/utils/fileManager.js');
const qm = require('qminer');
const fs = require('fs');

// example of unit tests
var assert = require('assert');

// connection config
let connectionConfig = {};

// basic aggregate config
let aggrConfigs = {
    "energy": [
        { "field": "pc", "tick": [
            { "type": "winbuf", "winsize": 1 * 60 * 60 * 1000, "sub": [
                { "type": "ma" },
            ]},
            { "type": "winbuf", "winsize": 6 * 60 * 60 * 1000, "sub": [
                { "type": "variance" },
                { "type": "ma" },
            ]},
            { "type": "winbuf", "winsize": 24 * 60 * 60 * 1000, "sub": [
                { "type": "variance" },
                { "type": "ma" },
                { "type": "min" },
                { "type": "max" }
            ]},
            { "type": "winbuf", "winsize": 7 * 24 * 60 * 60 * 1000, "sub": [
                { "type": "variance" },
                { "type": "ma" },
                { "type": "min" },
                { "type": "max" }
            ]},
            { "type": "winbuf", "winsize": 30 * 24 * 60 * 60 * 1000, "sub": [
                { "type": "ma" },
            ]}
        ]}
    ],
    "weather": [],
    "static": [
        { "field": "holiday", "tick": [
            { "type": "winbuf", "winsize": 7 * 24 * 60 * 60 * 1000, "sub": [
                { "type": "ma" }
            ]}
        ]}
    ]
};

// basic fusion config
// for testing reasons we are overriding fusionTick, which is in each node
// otherwise inherited from fusionConfig
let fusionConfig = {
    "connection": {
        type: "none"  // kafka, mqtt
    },
    "fusionModel": "test",
    "fusionTick": 60 * 60 * 1000, // 1 hour
    "nodes": [
        {
            "type": "energy",
            "nodeid": "N1",
            "aggrConfigId": "energy",
            "fusionTick": 60 * 60 * 1000, // 1 hour
            "master": true,
            "attributes": [
                { "time": 0, "attributes": [                        // current time
                    { type: "value", "name": "pc" },
                    { type: "value", "name": "pc|ma|3600000" },     // 1h
                    { type: "value", "name": "pc|ma|21600000" },    // 6h
                    { type: "value", "name": "pc|ma|86400000" },    // 1d
                    { type: "value", "name": "pc|ma|604800000" },   // 1w
                    { type: "value", "name": "pc|ma|2592000000" },  // 1m

                    { type: "value", "name": "pc|min|86400000" },   // 1d
                    { type: "value", "name": "pc|min|604800000" },  // 1w

                    { type: "value", "name": "pc|max|86400000" },   // 1d
                    { type: "value", "name": "pc|max|604800000" },  // 1w

                    { type: "value", "name": "pc|variance|21600000" },    // 6h
                    { type: "value", "name": "pc|variance|86400000" },    // 1d
                    { type: "value", "name": "pc|variance|604800000" }    // 1w
                ]},
                { "time": -24, "attributes": [                       // 1d ago
                    { type: "value", "name": "pc" }
                ]},
                { "time": -48, "attributes": [                       // 2d ago
                    { type: "value", "name": "pc" }
                ]},
                { "time": -168, "attributes": [                      // 1w ago
                    { type: "value", "name": "pc" }
                ]}
            ]
        },
        {
            "type": "static",
            "nodeid": "static",
            "aggrConfigId": "static",
            "fusionTick": 60 * 60 * 1000, // 1 hour
            "master": false,
            "attributes": [
                { "time": 24, "attributes": [
                    { type: "value", "name": "timeOfDay" },
                    { type: "value", "name": "weekEnd" },
                    { type: "value", "name": "holiday" },
                    { type: "value", "name": "dayAfterHoliday" },
                    { type: "value", "name": "dayBeforeHoliday" },
                    { type: "value", "name": "dayOfWeek" },
                    { type: "value", "name": "dayOfYear" },
                    { type: "value", "name": "monthOfYear" }
                ]}
            ]
        },
        {
            "type": "weather",
            "nodeid": "weather",
            "aggrConfigId": "weather",
            "fusionTick": 60 * 60 * 1000, // 1 hour
            "master": false,
            "datasize": 48,     // default value is 48 hours in advance
            "attributes": [
                { "time": 0, "attributes": [
                    { type: "value", name: "temperature24" },
                    { type: "value", name: "humidity24" },
                    { type: "value", name: "pressure24" },
                    { type: "value", name: "windSpeed24" },
                    { type: "value", name: "windBearing24" },
                    { type: "value", name: "cloudCover24" }
                ]}
            ]
        }
    ]
}

const testNodeConfig = JSON.parse(JSON.stringify(fusionConfig["nodes"][2]));

function processRecordDummyCb(nodeI, parent) {
    return true;
}

describe('streamingWeatherNode', function() {
    let base;
    let sn;

    before(function() {
        fileManager.removeFolder('./db2/');
        fileManager.createFolder('./db2/');
        // create base
        base = new qm.Base({ dbPath: './db2/', mode: 'createClean' });
        // sn = new streamingNode(base, connectionConfig, fusionConfig["nodes"][0], aggrConfigs, null, 99, null);
        // sen = new streamingEnergyNode(base, connectionConfig, fusionConfig["nodes"][0], aggrConfigs, processRecordDummyCb, 99, null);

        // create default 48h ahead weather prediction node
        swn = new streamingWeatherNode(base, connectionConfig, fusionConfig["nodes"][2], aggrConfigs, processRecordDummyCb, 99, null);

        // create 24h ahead weather prediction node
        fusionConfig["nodes"]["2"]["datasize"] = 24;
        fusionConfig["nodes"]["2"]["nodeid"] = "W2";
        swn24 = new streamingWeatherNode(base, connectionConfig, fusionConfig["nodes"][2], aggrConfigs, processRecordDummyCb, 99, null);

        // create 3d ahead weather prediction node
        fusionConfig["nodes"]["2"]["datasize"] = 3;
        fusionConfig["nodes"]["2"]["datatype"] = "daily";
        fusionConfig["nodes"]["2"]["nodeid"] = "W3";
        fusionConfig["nodes"]["2"]["fieldtypes"] =
            [ "temperature", "humidity", "pressure", "windSpeed", "windBearing", "cloudCover", "daylight" ];
        swn3 = new streamingWeatherNode(base, connectionConfig, fusionConfig["nodes"][2], aggrConfigs, processRecordDummyCb, 99, null);



        // ssn = new streamingStaticNode(base, connectionConfig, fusionConfig["nodes"][1], aggrConfigs, null, 99, null);
    });

    after(function() {
        base.close();
    });

    describe('initialization', function() {
        it('base saved', function() {
            assert.equal(base, swn.base);
        })

        it ('check if store exists', function() {
            assert.equal(swn.rawstore.name, "weather");
        })

        it ('check store structure', function() {
            assert.deepEqual(swn.rawstore.fields, [{"id":0,"name":"temperature0","type":"float","nullable":false,"internal":false,"primary":false},{"id":1,"name":"humidity0","type":"float","nullable":false,"internal":false,"primary":false},{"id":2,"name":"pressure0","type":"float","nullable":false,"internal":false,"primary":false},{"id":3,"name":"windSpeed0","type":"float","nullable":false,"internal":false,"primary":false},{"id":4,"name":"windBearing0","type":"float","nullable":false,"internal":false,"primary":false},{"id":5,"name":"cloudCover0","type":"float","nullable":false,"internal":false,"primary":false},{"id":6,"name":"temperature1","type":"float","nullable":false,"internal":false,"primary":false},{"id":7,"name":"humidity1","type":"float","nullable":false,"internal":false,"primary":false},{"id":8,"name":"pressure1","type":"float","nullable":false,"internal":false,"primary":false},{"id":9,"name":"windSpeed1","type":"float","nullable":false,"internal":false,"primary":false},{"id":10,"name":"windBearing1","type":"float","nullable":false,"internal":false,"primary":false},{"id":11,"name":"cloudCover1","type":"float","nullable":false,"internal":false,"primary":false},{"id":12,"name":"temperature2","type":"float","nullable":false,"internal":false,"primary":false},{"id":13,"name":"humidity2","type":"float","nullable":false,"internal":false,"primary":false},{"id":14,"name":"pressure2","type":"float","nullable":false,"internal":false,"primary":false},{"id":15,"name":"windSpeed2","type":"float","nullable":false,"internal":false,"primary":false},{"id":16,"name":"windBearing2","type":"float","nullable":false,"internal":false,"primary":false},{"id":17,"name":"cloudCover2","type":"float","nullable":false,"internal":false,"primary":false},{"id":18,"name":"temperature3","type":"float","nullable":false,"internal":false,"primary":false},{"id":19,"name":"humidity3","type":"float","nullable":false,"internal":false,"primary":false},{"id":20,"name":"pressure3","type":"float","nullable":false,"internal":false,"primary":false},{"id":21,"name":"windSpeed3","type":"float","nullable":false,"internal":false,"primary":false},{"id":22,"name":"windBearing3","type":"float","nullable":false,"internal":false,"primary":false},{"id":23,"name":"cloudCover3","type":"float","nullable":false,"internal":false,"primary":false},{"id":24,"name":"temperature4","type":"float","nullable":false,"internal":false,"primary":false},{"id":25,"name":"humidity4","type":"float","nullable":false,"internal":false,"primary":false},{"id":26,"name":"pressure4","type":"float","nullable":false,"internal":false,"primary":false},{"id":27,"name":"windSpeed4","type":"float","nullable":false,"internal":false,"primary":false},{"id":28,"name":"windBearing4","type":"float","nullable":false,"internal":false,"primary":false},{"id":29,"name":"cloudCover4","type":"float","nullable":false,"internal":false,"primary":false},{"id":30,"name":"temperature5","type":"float","nullable":false,"internal":false,"primary":false},{"id":31,"name":"humidity5","type":"float","nullable":false,"internal":false,"primary":false},{"id":32,"name":"pressure5","type":"float","nullable":false,"internal":false,"primary":false},{"id":33,"name":"windSpeed5","type":"float","nullable":false,"internal":false,"primary":false},{"id":34,"name":"windBearing5","type":"float","nullable":false,"internal":false,"primary":false},{"id":35,"name":"cloudCover5","type":"float","nullable":false,"internal":false,"primary":false},{"id":36,"name":"temperature6","type":"float","nullable":false,"internal":false,"primary":false},{"id":37,"name":"humidity6","type":"float","nullable":false,"internal":false,"primary":false},{"id":38,"name":"pressure6","type":"float","nullable":false,"internal":false,"primary":false},{"id":39,"name":"windSpeed6","type":"float","nullable":false,"internal":false,"primary":false},{"id":40,"name":"windBearing6","type":"float","nullable":false,"internal":false,"primary":false},{"id":41,"name":"cloudCover6","type":"float","nullable":false,"internal":false,"primary":false},{"id":42,"name":"temperature7","type":"float","nullable":false,"internal":false,"primary":false},{"id":43,"name":"humidity7","type":"float","nullable":false,"internal":false,"primary":false},{"id":44,"name":"pressure7","type":"float","nullable":false,"internal":false,"primary":false},{"id":45,"name":"windSpeed7","type":"float","nullable":false,"internal":false,"primary":false},{"id":46,"name":"windBearing7","type":"float","nullable":false,"internal":false,"primary":false},{"id":47,"name":"cloudCover7","type":"float","nullable":false,"internal":false,"primary":false},{"id":48,"name":"temperature8","type":"float","nullable":false,"internal":false,"primary":false},{"id":49,"name":"humidity8","type":"float","nullable":false,"internal":false,"primary":false},{"id":50,"name":"pressure8","type":"float","nullable":false,"internal":false,"primary":false},{"id":51,"name":"windSpeed8","type":"float","nullable":false,"internal":false,"primary":false},{"id":52,"name":"windBearing8","type":"float","nullable":false,"internal":false,"primary":false},{"id":53,"name":"cloudCover8","type":"float","nullable":false,"internal":false,"primary":false},{"id":54,"name":"temperature9","type":"float","nullable":false,"internal":false,"primary":false},{"id":55,"name":"humidity9","type":"float","nullable":false,"internal":false,"primary":false},{"id":56,"name":"pressure9","type":"float","nullable":false,"internal":false,"primary":false},{"id":57,"name":"windSpeed9","type":"float","nullable":false,"internal":false,"primary":false},{"id":58,"name":"windBearing9","type":"float","nullable":false,"internal":false,"primary":false},{"id":59,"name":"cloudCover9","type":"float","nullable":false,"internal":false,"primary":false},{"id":60,"name":"temperature10","type":"float","nullable":false,"internal":false,"primary":false},{"id":61,"name":"humidity10","type":"float","nullable":false,"internal":false,"primary":false},{"id":62,"name":"pressure10","type":"float","nullable":false,"internal":false,"primary":false},{"id":63,"name":"windSpeed10","type":"float","nullable":false,"internal":false,"primary":false},{"id":64,"name":"windBearing10","type":"float","nullable":false,"internal":false,"primary":false},{"id":65,"name":"cloudCover10","type":"float","nullable":false,"internal":false,"primary":false},{"id":66,"name":"temperature11","type":"float","nullable":false,"internal":false,"primary":false},{"id":67,"name":"humidity11","type":"float","nullable":false,"internal":false,"primary":false},{"id":68,"name":"pressure11","type":"float","nullable":false,"internal":false,"primary":false},{"id":69,"name":"windSpeed11","type":"float","nullable":false,"internal":false,"primary":false},{"id":70,"name":"windBearing11","type":"float","nullable":false,"internal":false,"primary":false},{"id":71,"name":"cloudCover11","type":"float","nullable":false,"internal":false,"primary":false},{"id":72,"name":"temperature12","type":"float","nullable":false,"internal":false,"primary":false},{"id":73,"name":"humidity12","type":"float","nullable":false,"internal":false,"primary":false},{"id":74,"name":"pressure12","type":"float","nullable":false,"internal":false,"primary":false},{"id":75,"name":"windSpeed12","type":"float","nullable":false,"internal":false,"primary":false},{"id":76,"name":"windBearing12","type":"float","nullable":false,"internal":false,"primary":false},{"id":77,"name":"cloudCover12","type":"float","nullable":false,"internal":false,"primary":false},{"id":78,"name":"temperature13","type":"float","nullable":false,"internal":false,"primary":false},{"id":79,"name":"humidity13","type":"float","nullable":false,"internal":false,"primary":false},{"id":80,"name":"pressure13","type":"float","nullable":false,"internal":false,"primary":false},{"id":81,"name":"windSpeed13","type":"float","nullable":false,"internal":false,"primary":false},{"id":82,"name":"windBearing13","type":"float","nullable":false,"internal":false,"primary":false},{"id":83,"name":"cloudCover13","type":"float","nullable":false,"internal":false,"primary":false},{"id":84,"name":"temperature14","type":"float","nullable":false,"internal":false,"primary":false},{"id":85,"name":"humidity14","type":"float","nullable":false,"internal":false,"primary":false},{"id":86,"name":"pressure14","type":"float","nullable":false,"internal":false,"primary":false},{"id":87,"name":"windSpeed14","type":"float","nullable":false,"internal":false,"primary":false},{"id":88,"name":"windBearing14","type":"float","nullable":false,"internal":false,"primary":false},{"id":89,"name":"cloudCover14","type":"float","nullable":false,"internal":false,"primary":false},{"id":90,"name":"temperature15","type":"float","nullable":false,"internal":false,"primary":false},{"id":91,"name":"humidity15","type":"float","nullable":false,"internal":false,"primary":false},{"id":92,"name":"pressure15","type":"float","nullable":false,"internal":false,"primary":false},{"id":93,"name":"windSpeed15","type":"float","nullable":false,"internal":false,"primary":false},{"id":94,"name":"windBearing15","type":"float","nullable":false,"internal":false,"primary":false},{"id":95,"name":"cloudCover15","type":"float","nullable":false,"internal":false,"primary":false},{"id":96,"name":"temperature16","type":"float","nullable":false,"internal":false,"primary":false},{"id":97,"name":"humidity16","type":"float","nullable":false,"internal":false,"primary":false},{"id":98,"name":"pressure16","type":"float","nullable":false,"internal":false,"primary":false},{"id":99,"name":"windSpeed16","type":"float","nullable":false,"internal":false,"primary":false},{"id":100,"name":"windBearing16","type":"float","nullable":false,"internal":false,"primary":false},{"id":101,"name":"cloudCover16","type":"float","nullable":false,"internal":false,"primary":false},{"id":102,"name":"temperature17","type":"float","nullable":false,"internal":false,"primary":false},{"id":103,"name":"humidity17","type":"float","nullable":false,"internal":false,"primary":false},{"id":104,"name":"pressure17","type":"float","nullable":false,"internal":false,"primary":false},{"id":105,"name":"windSpeed17","type":"float","nullable":false,"internal":false,"primary":false},{"id":106,"name":"windBearing17","type":"float","nullable":false,"internal":false,"primary":false},{"id":107,"name":"cloudCover17","type":"float","nullable":false,"internal":false,"primary":false},{"id":108,"name":"temperature18","type":"float","nullable":false,"internal":false,"primary":false},{"id":109,"name":"humidity18","type":"float","nullable":false,"internal":false,"primary":false},{"id":110,"name":"pressure18","type":"float","nullable":false,"internal":false,"primary":false},{"id":111,"name":"windSpeed18","type":"float","nullable":false,"internal":false,"primary":false},{"id":112,"name":"windBearing18","type":"float","nullable":false,"internal":false,"primary":false},{"id":113,"name":"cloudCover18","type":"float","nullable":false,"internal":false,"primary":false},{"id":114,"name":"temperature19","type":"float","nullable":false,"internal":false,"primary":false},{"id":115,"name":"humidity19","type":"float","nullable":false,"internal":false,"primary":false},{"id":116,"name":"pressure19","type":"float","nullable":false,"internal":false,"primary":false},{"id":117,"name":"windSpeed19","type":"float","nullable":false,"internal":false,"primary":false},{"id":118,"name":"windBearing19","type":"float","nullable":false,"internal":false,"primary":false},{"id":119,"name":"cloudCover19","type":"float","nullable":false,"internal":false,"primary":false},{"id":120,"name":"temperature20","type":"float","nullable":false,"internal":false,"primary":false},{"id":121,"name":"humidity20","type":"float","nullable":false,"internal":false,"primary":false},{"id":122,"name":"pressure20","type":"float","nullable":false,"internal":false,"primary":false},{"id":123,"name":"windSpeed20","type":"float","nullable":false,"internal":false,"primary":false},{"id":124,"name":"windBearing20","type":"float","nullable":false,"internal":false,"primary":false},{"id":125,"name":"cloudCover20","type":"float","nullable":false,"internal":false,"primary":false},{"id":126,"name":"temperature21","type":"float","nullable":false,"internal":false,"primary":false},{"id":127,"name":"humidity21","type":"float","nullable":false,"internal":false,"primary":false},{"id":128,"name":"pressure21","type":"float","nullable":false,"internal":false,"primary":false},{"id":129,"name":"windSpeed21","type":"float","nullable":false,"internal":false,"primary":false},{"id":130,"name":"windBearing21","type":"float","nullable":false,"internal":false,"primary":false},{"id":131,"name":"cloudCover21","type":"float","nullable":false,"internal":false,"primary":false},{"id":132,"name":"temperature22","type":"float","nullable":false,"internal":false,"primary":false},{"id":133,"name":"humidity22","type":"float","nullable":false,"internal":false,"primary":false},{"id":134,"name":"pressure22","type":"float","nullable":false,"internal":false,"primary":false},{"id":135,"name":"windSpeed22","type":"float","nullable":false,"internal":false,"primary":false},{"id":136,"name":"windBearing22","type":"float","nullable":false,"internal":false,"primary":false},{"id":137,"name":"cloudCover22","type":"float","nullable":false,"internal":false,"primary":false},{"id":138,"name":"temperature23","type":"float","nullable":false,"internal":false,"primary":false},{"id":139,"name":"humidity23","type":"float","nullable":false,"internal":false,"primary":false},{"id":140,"name":"pressure23","type":"float","nullable":false,"internal":false,"primary":false},{"id":141,"name":"windSpeed23","type":"float","nullable":false,"internal":false,"primary":false},{"id":142,"name":"windBearing23","type":"float","nullable":false,"internal":false,"primary":false},{"id":143,"name":"cloudCover23","type":"float","nullable":false,"internal":false,"primary":false},{"id":144,"name":"temperature24","type":"float","nullable":false,"internal":false,"primary":false},{"id":145,"name":"humidity24","type":"float","nullable":false,"internal":false,"primary":false},{"id":146,"name":"pressure24","type":"float","nullable":false,"internal":false,"primary":false},{"id":147,"name":"windSpeed24","type":"float","nullable":false,"internal":false,"primary":false},{"id":148,"name":"windBearing24","type":"float","nullable":false,"internal":false,"primary":false},{"id":149,"name":"cloudCover24","type":"float","nullable":false,"internal":false,"primary":false},{"id":150,"name":"temperature25","type":"float","nullable":false,"internal":false,"primary":false},{"id":151,"name":"humidity25","type":"float","nullable":false,"internal":false,"primary":false},{"id":152,"name":"pressure25","type":"float","nullable":false,"internal":false,"primary":false},{"id":153,"name":"windSpeed25","type":"float","nullable":false,"internal":false,"primary":false},{"id":154,"name":"windBearing25","type":"float","nullable":false,"internal":false,"primary":false},{"id":155,"name":"cloudCover25","type":"float","nullable":false,"internal":false,"primary":false},{"id":156,"name":"temperature26","type":"float","nullable":false,"internal":false,"primary":false},{"id":157,"name":"humidity26","type":"float","nullable":false,"internal":false,"primary":false},{"id":158,"name":"pressure26","type":"float","nullable":false,"internal":false,"primary":false},{"id":159,"name":"windSpeed26","type":"float","nullable":false,"internal":false,"primary":false},{"id":160,"name":"windBearing26","type":"float","nullable":false,"internal":false,"primary":false},{"id":161,"name":"cloudCover26","type":"float","nullable":false,"internal":false,"primary":false},{"id":162,"name":"temperature27","type":"float","nullable":false,"internal":false,"primary":false},{"id":163,"name":"humidity27","type":"float","nullable":false,"internal":false,"primary":false},{"id":164,"name":"pressure27","type":"float","nullable":false,"internal":false,"primary":false},{"id":165,"name":"windSpeed27","type":"float","nullable":false,"internal":false,"primary":false},{"id":166,"name":"windBearing27","type":"float","nullable":false,"internal":false,"primary":false},{"id":167,"name":"cloudCover27","type":"float","nullable":false,"internal":false,"primary":false},{"id":168,"name":"temperature28","type":"float","nullable":false,"internal":false,"primary":false},{"id":169,"name":"humidity28","type":"float","nullable":false,"internal":false,"primary":false},{"id":170,"name":"pressure28","type":"float","nullable":false,"internal":false,"primary":false},{"id":171,"name":"windSpeed28","type":"float","nullable":false,"internal":false,"primary":false},{"id":172,"name":"windBearing28","type":"float","nullable":false,"internal":false,"primary":false},{"id":173,"name":"cloudCover28","type":"float","nullable":false,"internal":false,"primary":false},{"id":174,"name":"temperature29","type":"float","nullable":false,"internal":false,"primary":false},{"id":175,"name":"humidity29","type":"float","nullable":false,"internal":false,"primary":false},{"id":176,"name":"pressure29","type":"float","nullable":false,"internal":false,"primary":false},{"id":177,"name":"windSpeed29","type":"float","nullable":false,"internal":false,"primary":false},{"id":178,"name":"windBearing29","type":"float","nullable":false,"internal":false,"primary":false},{"id":179,"name":"cloudCover29","type":"float","nullable":false,"internal":false,"primary":false},{"id":180,"name":"temperature30","type":"float","nullable":false,"internal":false,"primary":false},{"id":181,"name":"humidity30","type":"float","nullable":false,"internal":false,"primary":false},{"id":182,"name":"pressure30","type":"float","nullable":false,"internal":false,"primary":false},{"id":183,"name":"windSpeed30","type":"float","nullable":false,"internal":false,"primary":false},{"id":184,"name":"windBearing30","type":"float","nullable":false,"internal":false,"primary":false},{"id":185,"name":"cloudCover30","type":"float","nullable":false,"internal":false,"primary":false},{"id":186,"name":"temperature31","type":"float","nullable":false,"internal":false,"primary":false},{"id":187,"name":"humidity31","type":"float","nullable":false,"internal":false,"primary":false},{"id":188,"name":"pressure31","type":"float","nullable":false,"internal":false,"primary":false},{"id":189,"name":"windSpeed31","type":"float","nullable":false,"internal":false,"primary":false},{"id":190,"name":"windBearing31","type":"float","nullable":false,"internal":false,"primary":false},{"id":191,"name":"cloudCover31","type":"float","nullable":false,"internal":false,"primary":false},{"id":192,"name":"temperature32","type":"float","nullable":false,"internal":false,"primary":false},{"id":193,"name":"humidity32","type":"float","nullable":false,"internal":false,"primary":false},{"id":194,"name":"pressure32","type":"float","nullable":false,"internal":false,"primary":false},{"id":195,"name":"windSpeed32","type":"float","nullable":false,"internal":false,"primary":false},{"id":196,"name":"windBearing32","type":"float","nullable":false,"internal":false,"primary":false},{"id":197,"name":"cloudCover32","type":"float","nullable":false,"internal":false,"primary":false},{"id":198,"name":"temperature33","type":"float","nullable":false,"internal":false,"primary":false},{"id":199,"name":"humidity33","type":"float","nullable":false,"internal":false,"primary":false},{"id":200,"name":"pressure33","type":"float","nullable":false,"internal":false,"primary":false},{"id":201,"name":"windSpeed33","type":"float","nullable":false,"internal":false,"primary":false},{"id":202,"name":"windBearing33","type":"float","nullable":false,"internal":false,"primary":false},{"id":203,"name":"cloudCover33","type":"float","nullable":false,"internal":false,"primary":false},{"id":204,"name":"temperature34","type":"float","nullable":false,"internal":false,"primary":false},{"id":205,"name":"humidity34","type":"float","nullable":false,"internal":false,"primary":false},{"id":206,"name":"pressure34","type":"float","nullable":false,"internal":false,"primary":false},{"id":207,"name":"windSpeed34","type":"float","nullable":false,"internal":false,"primary":false},{"id":208,"name":"windBearing34","type":"float","nullable":false,"internal":false,"primary":false},{"id":209,"name":"cloudCover34","type":"float","nullable":false,"internal":false,"primary":false},{"id":210,"name":"temperature35","type":"float","nullable":false,"internal":false,"primary":false},{"id":211,"name":"humidity35","type":"float","nullable":false,"internal":false,"primary":false},{"id":212,"name":"pressure35","type":"float","nullable":false,"internal":false,"primary":false},{"id":213,"name":"windSpeed35","type":"float","nullable":false,"internal":false,"primary":false},{"id":214,"name":"windBearing35","type":"float","nullable":false,"internal":false,"primary":false},{"id":215,"name":"cloudCover35","type":"float","nullable":false,"internal":false,"primary":false},{"id":216,"name":"temperature36","type":"float","nullable":false,"internal":false,"primary":false},{"id":217,"name":"humidity36","type":"float","nullable":false,"internal":false,"primary":false},{"id":218,"name":"pressure36","type":"float","nullable":false,"internal":false,"primary":false},{"id":219,"name":"windSpeed36","type":"float","nullable":false,"internal":false,"primary":false},{"id":220,"name":"windBearing36","type":"float","nullable":false,"internal":false,"primary":false},{"id":221,"name":"cloudCover36","type":"float","nullable":false,"internal":false,"primary":false},{"id":222,"name":"temperature37","type":"float","nullable":false,"internal":false,"primary":false},{"id":223,"name":"humidity37","type":"float","nullable":false,"internal":false,"primary":false},{"id":224,"name":"pressure37","type":"float","nullable":false,"internal":false,"primary":false},{"id":225,"name":"windSpeed37","type":"float","nullable":false,"internal":false,"primary":false},{"id":226,"name":"windBearing37","type":"float","nullable":false,"internal":false,"primary":false},{"id":227,"name":"cloudCover37","type":"float","nullable":false,"internal":false,"primary":false},{"id":228,"name":"temperature38","type":"float","nullable":false,"internal":false,"primary":false},{"id":229,"name":"humidity38","type":"float","nullable":false,"internal":false,"primary":false},{"id":230,"name":"pressure38","type":"float","nullable":false,"internal":false,"primary":false},{"id":231,"name":"windSpeed38","type":"float","nullable":false,"internal":false,"primary":false},{"id":232,"name":"windBearing38","type":"float","nullable":false,"internal":false,"primary":false},{"id":233,"name":"cloudCover38","type":"float","nullable":false,"internal":false,"primary":false},{"id":234,"name":"temperature39","type":"float","nullable":false,"internal":false,"primary":false},{"id":235,"name":"humidity39","type":"float","nullable":false,"internal":false,"primary":false},{"id":236,"name":"pressure39","type":"float","nullable":false,"internal":false,"primary":false},{"id":237,"name":"windSpeed39","type":"float","nullable":false,"internal":false,"primary":false},{"id":238,"name":"windBearing39","type":"float","nullable":false,"internal":false,"primary":false},{"id":239,"name":"cloudCover39","type":"float","nullable":false,"internal":false,"primary":false},{"id":240,"name":"temperature40","type":"float","nullable":false,"internal":false,"primary":false},{"id":241,"name":"humidity40","type":"float","nullable":false,"internal":false,"primary":false},{"id":242,"name":"pressure40","type":"float","nullable":false,"internal":false,"primary":false},{"id":243,"name":"windSpeed40","type":"float","nullable":false,"internal":false,"primary":false},{"id":244,"name":"windBearing40","type":"float","nullable":false,"internal":false,"primary":false},{"id":245,"name":"cloudCover40","type":"float","nullable":false,"internal":false,"primary":false},{"id":246,"name":"temperature41","type":"float","nullable":false,"internal":false,"primary":false},{"id":247,"name":"humidity41","type":"float","nullable":false,"internal":false,"primary":false},{"id":248,"name":"pressure41","type":"float","nullable":false,"internal":false,"primary":false},{"id":249,"name":"windSpeed41","type":"float","nullable":false,"internal":false,"primary":false},{"id":250,"name":"windBearing41","type":"float","nullable":false,"internal":false,"primary":false},{"id":251,"name":"cloudCover41","type":"float","nullable":false,"internal":false,"primary":false},{"id":252,"name":"temperature42","type":"float","nullable":false,"internal":false,"primary":false},{"id":253,"name":"humidity42","type":"float","nullable":false,"internal":false,"primary":false},{"id":254,"name":"pressure42","type":"float","nullable":false,"internal":false,"primary":false},{"id":255,"name":"windSpeed42","type":"float","nullable":false,"internal":false,"primary":false},{"id":256,"name":"windBearing42","type":"float","nullable":false,"internal":false,"primary":false},{"id":257,"name":"cloudCover42","type":"float","nullable":false,"internal":false,"primary":false},{"id":258,"name":"temperature43","type":"float","nullable":false,"internal":false,"primary":false},{"id":259,"name":"humidity43","type":"float","nullable":false,"internal":false,"primary":false},{"id":260,"name":"pressure43","type":"float","nullable":false,"internal":false,"primary":false},{"id":261,"name":"windSpeed43","type":"float","nullable":false,"internal":false,"primary":false},{"id":262,"name":"windBearing43","type":"float","nullable":false,"internal":false,"primary":false},{"id":263,"name":"cloudCover43","type":"float","nullable":false,"internal":false,"primary":false},{"id":264,"name":"temperature44","type":"float","nullable":false,"internal":false,"primary":false},{"id":265,"name":"humidity44","type":"float","nullable":false,"internal":false,"primary":false},{"id":266,"name":"pressure44","type":"float","nullable":false,"internal":false,"primary":false},{"id":267,"name":"windSpeed44","type":"float","nullable":false,"internal":false,"primary":false},{"id":268,"name":"windBearing44","type":"float","nullable":false,"internal":false,"primary":false},{"id":269,"name":"cloudCover44","type":"float","nullable":false,"internal":false,"primary":false},{"id":270,"name":"temperature45","type":"float","nullable":false,"internal":false,"primary":false},{"id":271,"name":"humidity45","type":"float","nullable":false,"internal":false,"primary":false},{"id":272,"name":"pressure45","type":"float","nullable":false,"internal":false,"primary":false},{"id":273,"name":"windSpeed45","type":"float","nullable":false,"internal":false,"primary":false},{"id":274,"name":"windBearing45","type":"float","nullable":false,"internal":false,"primary":false},{"id":275,"name":"cloudCover45","type":"float","nullable":false,"internal":false,"primary":false},{"id":276,"name":"temperature46","type":"float","nullable":false,"internal":false,"primary":false},{"id":277,"name":"humidity46","type":"float","nullable":false,"internal":false,"primary":false},{"id":278,"name":"pressure46","type":"float","nullable":false,"internal":false,"primary":false},{"id":279,"name":"windSpeed46","type":"float","nullable":false,"internal":false,"primary":false},{"id":280,"name":"windBearing46","type":"float","nullable":false,"internal":false,"primary":false},{"id":281,"name":"cloudCover46","type":"float","nullable":false,"internal":false,"primary":false},{"id":282,"name":"temperature47","type":"float","nullable":false,"internal":false,"primary":false},{"id":283,"name":"humidity47","type":"float","nullable":false,"internal":false,"primary":false},{"id":284,"name":"pressure47","type":"float","nullable":false,"internal":false,"primary":false},{"id":285,"name":"windSpeed47","type":"float","nullable":false,"internal":false,"primary":false},{"id":286,"name":"windBearing47","type":"float","nullable":false,"internal":false,"primary":false},{"id":287,"name":"cloudCover47","type":"float","nullable":false,"internal":false,"primary":false}]);
        })

        it('aggregates initialized - number', function() {
            assert.equal(Object.keys(swn.aggregate).length, 0);
        })

        it('aggregates initialized - key names', function() {
            assert.deepEqual(Object.keys(swn.aggregate), []);
        })

        it('config saved', function() {
            assert.deepEqual(swn.config, testNodeConfig);
        })

        it('fusionNodeI correctly saved', function() {
            assert.equal(swn.fusionNodeI, 99);
        })

        it ('callback function should be set', function() {
            assert.equal(typeof swn.processRecordCb, "function");
        })

        it ('parent saved', function() {
            assert.equal(swn.parent, null);
        })

        it ('buffer empty', function() {
            assert.deepEqual(swn.buffer, []);
        })

        it ('buffer position is 0', function() {
            assert.equal(swn.position, 0);
        })

        it ('master flag set correctly', function() {
            assert.equal(swn.master, false);
        })

        it ('isMaster function', function() {
            assert.equal(swn.isMaster(), false);
        })

        it ('connectToKafka function exists', function() {
            assert.equal(typeof swn.connectToKafka, "function");
        })

        it ('broadcastAggregates function exists', function() {
            assert.equal(typeof swn.broadcastAggregates, "function");
        })

        it ('createAggregates function exists', function() {
            assert.equal(typeof swn.createAggregates, "function");
        })

        it ('offsetExists function exists', function() {
            assert.equal(typeof swn.offsetExists, "function");
        })

        it ('deleteObsoleteRows function exists', function() {
            assert.equal(typeof swn.deleteObsoleteRows, "function");
        })

        it ('checkDataAvailability function exists', function() {
            assert.equal(typeof swn.checkDataAvailability, "function");
        })

        it ('setSlaveOffset function exists', function() {
            assert.equal(typeof swn.setSlaveOffset, "function");
        })

        it ('getOffsetTimestamp function exists', function() {
            assert.equal(typeof swn.getOffsetTimestamp, "function");
        })

        it ('setMasterOffset function exists', function() {
            assert.equal(typeof swn.getOffsetTimestamp, "function");
        })

        it ('getAggregates function exists', function() {
            assert.equal(typeof swn.getAggregates, "function");
        })

        it ('getPartialFeatureVector function exists', function() {
            assert.equal(typeof swn.getPartialFeatureVector, "function");
        })

        it ('master set correctly', function() {
            assert.equal(swn.isMaster(), false);
        })

        it ('master offset set correctly', function() {
            swn.setMasterOffset();
            assert.equal(swn.position, -1);
        })

        it ('slave offset set correctly: no data', function() {
            assert.equal(swn.setSlaveOffset(0), false);
        })
    });

    describe('data insertion', function() {

        it ('data record record saved correctly', function() {
            let json = JSON.parse('{"latitude":45.95472,"longitude":13.664836,"timezone":"Europe/Ljubljana","currently":{"time": 0},"hourly":{"data":[{"time":1388530800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":41.68,"apparentTemperature":37.87,"dewPoint":36.19,"humidity":0.81,"pressure":1020.1,"windSpeed":5.82,"windBearing":92,"cloudCover":0.18,"uvIndex":0,"visibility":6.67},{"time":1388534400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.92,"apparentTemperature":39.92,"dewPoint":34.75,"humidity":0.82,"pressure":1019.69,"windSpeed":2.83,"windBearing":58,"cloudCover":0.42,"uvIndex":0,"visibility":6.18},{"time":1388538000,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.8,"apparentTemperature":36.94,"dewPoint":34.18,"humidity":0.8,"pressure":1019.3,"windSpeed":4.16,"windBearing":112,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388541600,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.18,"apparentTemperature":33.08,"dewPoint":34.93,"humidity":0.85,"pressure":1019.3,"windSpeed":9,"windBearing":120,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388545200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.02,"apparentTemperature":33.56,"dewPoint":31.67,"humidity":0.84,"pressure":1019.26,"windSpeed":3.25,"windBearing":239,"cloudCover":0.59,"uvIndex":0,"visibility":5.68},{"time":1388548800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.28,"apparentTemperature":32.75,"dewPoint":34.94,"humidity":0.84,"pressure":1019.1,"windSpeed":10,"windBearing":120,"visibility":7.03},{"time":1388552400,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.88,"apparentTemperature":36.59,"dewPoint":35.76,"humidity":0.85,"pressure":1019,"windSpeed":4.68,"windBearing":120,"visibility":6.67},{"time":1388556000,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.13,"apparentTemperature":35.13,"dewPoint":32.58,"humidity":0.9,"pressure":1019.2,"windSpeed":0.14,"windBearing":156,"cloudCover":0.77,"uvIndex":0,"visibility":7.75},{"time":1388559600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":40.62,"apparentTemperature":37.63,"dewPoint":35.66,"humidity":0.82,"pressure":1019,"windSpeed":4.46,"windBearing":123,"cloudCover":0.75,"uvIndex":0,"visibility":6.07},{"time":1388563200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":42.14,"apparentTemperature":38.98,"dewPoint":36.87,"humidity":0.81,"pressure":1019.4,"windSpeed":5,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.58},{"time":1388566800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":40.49,"apparentTemperature":40.49,"dewPoint":35.13,"humidity":0.81,"pressure":1020.2,"windSpeed":1,"windBearing":110,"cloudCover":0.81,"uvIndex":0,"visibility":7.4},{"time":1388570400,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":44.84,"apparentTemperature":44.84,"dewPoint":38.35,"humidity":0.78,"pressure":1019.9,"windSpeed":1.41,"windBearing":286,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388574000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":46.19,"apparentTemperature":46.19,"dewPoint":38.73,"humidity":0.75,"pressure":1019.8,"windSpeed":2.05,"windBearing":285,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388577600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":42.55,"apparentTemperature":42.55,"dewPoint":33.77,"humidity":0.71,"pressure":1019.54,"windSpeed":0.05,"windBearing":298,"cloudCover":0.63,"uvIndex":1,"visibility":8.59},{"time":1388581200,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.3,"apparentTemperature":49.3,"dewPoint":39.35,"humidity":0.68,"pressure":1019.1,"windSpeed":1.74,"windBearing":275,"cloudCover":0.31,"uvIndex":1,"visibility":7.06},{"time":1388584800,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.6,"apparentTemperature":49.6,"dewPoint":38.88,"humidity":0.66,"pressure":1019,"windSpeed":1.85,"windBearing":298,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388588400,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":45.11,"apparentTemperature":45.11,"dewPoint":36.12,"humidity":0.71,"pressure":1019.19,"windSpeed":0.67,"windBearing":251,"cloudCover":0.43,"uvIndex":0,"visibility":7.96},{"time":1388592000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.54,"apparentTemperature":43.54,"dewPoint":37.19,"humidity":0.78,"pressure":1019.1,"windSpeed":2.07,"windBearing":290,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388595600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.2,"apparentTemperature":43.2,"dewPoint":37.15,"humidity":0.79,"pressure":1019.5,"windSpeed":2.33,"windBearing":106,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388599200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.61,"apparentTemperature":39.61,"dewPoint":34.6,"humidity":0.82,"pressure":1020.04,"windSpeed":1.63,"windBearing":245,"cloudCover":0.67,"uvIndex":0,"visibility":8.75},{"time":1388602800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":44,"apparentTemperature":41.17,"dewPoint":37.74,"humidity":0.78,"pressure":1020.1,"windSpeed":5,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388606400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":42.88,"apparentTemperature":42.88,"dewPoint":36.9,"humidity":0.79,"pressure":1020.2,"windSpeed":2.06,"windBearing":113,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388610000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.4,"apparentTemperature":39.4,"dewPoint":34.86,"humidity":0.84,"pressure":1020.08,"windSpeed":2.14,"windBearing":103,"cloudCover":0.41,"uvIndex":0,"visibility":6.93},{"time":1388613600,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":40.51,"apparentTemperature":34.72,"dewPoint":35.38,"humidity":0.82,"pressure":1020,"windSpeed":9,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.62},{"time":1388617200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.89,"apparentTemperature":39.89,"dewPoint":34.98,"humidity":0.82,"pressure":1019.6,"windSpeed":2.71,"windBearing":116,"cloudCover":0.75,"uvIndex":0,"visibility":6.48},{"time":1388620800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.96,"apparentTemperature":36.96,"dewPoint":33.75,"humidity":0.88,"pressure":1019.3,"windSpeed":2.49,"windBearing":73,"cloudCover":0.59,"uvIndex":0,"visibility":6.09},{"time":1388624400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.4,"apparentTemperature":36.52,"dewPoint":34.61,"humidity":0.83,"pressure":1018.9,"windSpeed":4.11,"windBearing":114,"cloudCover":0.75,"uvIndex":0,"visibility":6.3},{"time":1388628000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.85,"apparentTemperature":37.85,"dewPoint":34.01,"humidity":0.86,"pressure":1018.9,"windSpeed":2.92,"windBearing":107,"cloudCover":0.31,"uvIndex":0,"visibility":6.34},{"time":1388631600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.05,"apparentTemperature":35.05,"dewPoint":32.48,"humidity":0.9,"pressure":1018.39,"windSpeed":1.4,"windBearing":296,"cloudCover":0.52,"uvIndex":0,"visibility":6.32},{"time":1388635200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":36.47,"apparentTemperature":29.75,"dewPoint":32.5,"humidity":0.85,"pressure":1018.3,"windSpeed":9,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":6.51},{"time":1388638800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.8,"apparentTemperature":34.52,"dewPoint":34.17,"humidity":0.87,"pressure":1018.1,"windSpeed":4.27,"windBearing":110,"cloudCover":0.31,"uvIndex":0,"visibility":6.67},{"time":1388642400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":33.23,"apparentTemperature":33.23,"dewPoint":31.37,"humidity":0.93,"pressure":1017.83,"windSpeed":2.35,"windBearing":270,"cloudCover":0.83,"uvIndex":0,"visibility":8.43},{"time":1388646000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":38.84,"apparentTemperature":38.84,"dewPoint":35.21,"humidity":0.87,"pressure":1017.7,"windSpeed":2.61,"windBearing":66,"cloudCover":0.75,"uvIndex":0,"visibility":6.2},{"time":1388649600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":40.2,"apparentTemperature":40.2,"dewPoint":36.89,"humidity":0.88,"pressure":1018,"windSpeed":2.21,"windBearing":63,"cloudCover":1,"uvIndex":0,"visibility":6.2},{"time":1388653200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":39.56,"apparentTemperature":34.03,"dewPoint":36.15,"humidity":0.87,"pressure":1017.72,"windSpeed":8.05,"windBearing":290,"cloudCover":0.89,"uvIndex":0,"visibility":7.1},{"time":1388656800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.64,"apparentTemperature":44.64,"dewPoint":38,"humidity":0.77,"pressure":1017.7,"windSpeed":2.33,"windBearing":348,"cloudCover":1,"uvIndex":1,"visibility":6.2},{"time":1388660400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":46.12,"apparentTemperature":46.12,"dewPoint":38.33,"humidity":0.74,"pressure":1017.3,"windSpeed":2.93,"windBearing":295,"cloudCover":1,"uvIndex":1,"visibility":6.03},{"time":1388664000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":38.01,"dewPoint":34.68,"humidity":0.76,"pressure":1016.52,"windSpeed":5.36,"windBearing":273,"cloudCover":0.92,"uvIndex":1,"visibility":7.28},{"time":1388667600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":47.2,"apparentTemperature":45.03,"dewPoint":40.35,"humidity":0.77,"pressure":1016.2,"windSpeed":4.84,"windBearing":337,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388671200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.85,"apparentTemperature":43.76,"dewPoint":41.03,"humidity":0.83,"pressure":1016.2,"windSpeed":4.41,"windBearing":315,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388674800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":43.36,"apparentTemperature":40.46,"dewPoint":40.54,"humidity":0.9,"pressure":1016.57,"windSpeed":4.95,"windBearing":286,"cloudCover":0.86,"uvIndex":0,"visibility":4.73},{"time":1388678400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":41.97,"dewPoint":42.1,"humidity":0.92,"pressure":1016.4,"windSpeed":4.24,"windBearing":313,"cloudCover":1,"uvIndex":0,"visibility":4.91},{"time":1388682000,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":44.2,"dewPoint":43.13,"humidity":0.96,"pressure":1016.6,"windSpeed":1.99,"windBearing":322,"cloudCover":1,"uvIndex":0,"visibility":4.4},{"time":1388685600,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":41.53,"dewPoint":40.15,"humidity":0.95,"pressure":1016.82,"windSpeed":2.93,"windBearing":268,"cloudCover":0.94,"uvIndex":0,"visibility":4.83},{"time":1388689200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":44.45,"humidity":0.95,"pressure":1016.7,"windSpeed":2,"windBearing":60,"cloudCover":1,"uvIndex":0,"visibility":4.6},{"time":1388692800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":42.16,"humidity":0.87,"pressure":1017,"windSpeed":1.52,"windBearing":339,"cloudCover":1,"uvIndex":0,"visibility":4.5},{"time":1388696400,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":42.87,"apparentTemperature":42.87,"dewPoint":41.4,"humidity":0.94,"pressure":1017.27,"windSpeed":2.03,"windBearing":334,"cloudCover":1,"uvIndex":0,"visibility":4.19},{"time":1388700000,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.19,"apparentTemperature":45.19,"dewPoint":42.98,"humidity":0.92,"pressure":1017.3,"windSpeed":1.91,"windBearing":277,"cloudCover":1,"uvIndex":0,"visibility":2.89},{"time":1388703600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.45,"apparentTemperature":45.45,"dewPoint":43.01,"humidity":0.91,"pressure":1017.4,"windSpeed":2,"windBearing":254,"cloudCover":1,"uvIndex":0,"visibility":2.92}]}}');

            swn.processRecord(json);
            assert.equal(swn.buffer.length, 1);

            let viable = [ 'humidity', 'pressure', 'windSpeed', 'windBearing', 'cloudCover', 'temperature'];

            for (let i = 0; i < json.hourly.data.length - 1; i++) {
                let keys = Object.keys(json.hourly.data[i]);
                for (let j = 0; j < keys.length; j++) {
                    let key = keys[j];
                    let storekey = key + i;
                    if (viable.indexOf(key) >= 0) {
                        //console.log(storekey, swn.buffer[0][storekey], json.hourly.data[i][key]);
                        assert.equal(swn.buffer[0][storekey], json.hourly.data[i][key]);
                    }
                }

            }

        });

        it ('data availability - offset does not exist', function() {
            swn.setSlaveOffset(0);
            assert.equal(swn.checkDataAvailability(), true);
        });

        it ('correct partial feature vector', function() {
            swn.setSlaveOffset(0);
            assert.deepEqual(swn.getPartialFeatureVector(), [
                39.89, 0.82, 1019.6, 2.71, 116, 0.75
            ]);
        });

        it ('empty record imputation', function() {
            swn.processRecord({});
            swn.processRecord([]);
        });

        it ('too short record of weather forecasts', function() {
            let json = JSON.parse('{"latitude":45.95472,"longitude":13.664836,"timezone":"Europe/Ljubljana","currently":{"time": 1},"hourly":{"data":[{"time":1388530800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":41.68,"apparentTemperature":37.87,"dewPoint":36.19,"humidity":0.81,"pressure":1020.1,"windSpeed":5.82,"windBearing":92,"cloudCover":0.18,"uvIndex":0,"visibility":6.67},{"time":1388534400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.92,"apparentTemperature":39.92,"dewPoint":34.75,"humidity":0.82,"pressure":1019.69,"windSpeed":2.83,"windBearing":58,"cloudCover":0.42,"uvIndex":0,"visibility":6.18},{"time":1388538000,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.8,"apparentTemperature":36.94,"dewPoint":34.18,"humidity":0.8,"pressure":1019.3,"windSpeed":4.16,"windBearing":112,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388541600,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.18,"apparentTemperature":33.08,"dewPoint":34.93,"humidity":0.85,"pressure":1019.3,"windSpeed":9,"windBearing":120,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388545200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.02,"apparentTemperature":33.56,"dewPoint":31.67,"humidity":0.84,"pressure":1019.26,"windSpeed":3.25,"windBearing":239,"cloudCover":0.59,"uvIndex":0,"visibility":5.68},{"time":1388548800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.28,"apparentTemperature":32.75,"dewPoint":34.94,"humidity":0.84,"pressure":1019.1,"windSpeed":10,"windBearing":120,"visibility":7.03},{"time":1388552400,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.88,"apparentTemperature":36.59,"dewPoint":35.76,"humidity":0.85,"pressure":1019,"windSpeed":4.68,"windBearing":120,"visibility":6.67},{"time":1388556000,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.13,"apparentTemperature":35.13,"dewPoint":32.58,"humidity":0.9,"pressure":1019.2,"windSpeed":0.14,"windBearing":156,"cloudCover":0.77,"uvIndex":0,"visibility":7.75},{"time":1388559600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":40.62,"apparentTemperature":37.63,"dewPoint":35.66,"humidity":0.82,"pressure":1019,"windSpeed":4.46,"windBearing":123,"cloudCover":0.75,"uvIndex":0,"visibility":6.07},{"time":1388563200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":42.14,"apparentTemperature":38.98,"dewPoint":36.87,"humidity":0.81,"pressure":1019.4,"windSpeed":5,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.58},{"time":1388566800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":40.49,"apparentTemperature":40.49,"dewPoint":35.13,"humidity":0.81,"pressure":1020.2,"windSpeed":1,"windBearing":110,"cloudCover":0.81,"uvIndex":0,"visibility":7.4},{"time":1388570400,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":44.84,"apparentTemperature":44.84,"dewPoint":38.35,"humidity":0.78,"pressure":1019.9,"windSpeed":1.41,"windBearing":286,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388574000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":46.19,"apparentTemperature":46.19,"dewPoint":38.73,"humidity":0.75,"pressure":1019.8,"windSpeed":2.05,"windBearing":285,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388577600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":42.55,"apparentTemperature":42.55,"dewPoint":33.77,"humidity":0.71,"pressure":1019.54,"windSpeed":0.05,"windBearing":298,"cloudCover":0.63,"uvIndex":1,"visibility":8.59},{"time":1388581200,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.3,"apparentTemperature":49.3,"dewPoint":39.35,"humidity":0.68,"pressure":1019.1,"windSpeed":1.74,"windBearing":275,"cloudCover":0.31,"uvIndex":1,"visibility":7.06},{"time":1388584800,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.6,"apparentTemperature":49.6,"dewPoint":38.88,"humidity":0.66,"pressure":1019,"windSpeed":1.85,"windBearing":298,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388588400,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":45.11,"apparentTemperature":45.11,"dewPoint":36.12,"humidity":0.71,"pressure":1019.19,"windSpeed":0.67,"windBearing":251,"cloudCover":0.43,"uvIndex":0,"visibility":7.96},{"time":1388592000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.54,"apparentTemperature":43.54,"dewPoint":37.19,"humidity":0.78,"pressure":1019.1,"windSpeed":2.07,"windBearing":290,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388595600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.2,"apparentTemperature":43.2,"dewPoint":37.15,"humidity":0.79,"pressure":1019.5,"windSpeed":2.33,"windBearing":106,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388599200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.61,"apparentTemperature":39.61,"dewPoint":34.6,"humidity":0.82,"pressure":1020.04,"windSpeed":1.63,"windBearing":245,"cloudCover":0.67,"uvIndex":0,"visibility":8.75},{"time":1388602800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":44,"apparentTemperature":41.17,"dewPoint":37.74,"humidity":0.78,"pressure":1020.1,"windSpeed":5,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388606400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":42.88,"apparentTemperature":42.88,"dewPoint":36.9,"humidity":0.79,"pressure":1020.2,"windSpeed":2.06,"windBearing":113,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388610000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.4,"apparentTemperature":39.4,"dewPoint":34.86,"humidity":0.84,"pressure":1020.08,"windSpeed":2.14,"windBearing":103,"cloudCover":0.41,"uvIndex":0,"visibility":6.93},{"time":1388613600,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":40.51,"apparentTemperature":34.72,"dewPoint":35.38,"humidity":0.82,"pressure":1020,"windSpeed":9,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.62},{"time":1388617200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.89,"apparentTemperature":39.89,"dewPoint":34.98,"humidity":0.82,"pressure":1019.6,"windSpeed":2.71,"windBearing":116,"cloudCover":0.75,"uvIndex":0,"visibility":6.48},{"time":1388620800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.96,"apparentTemperature":36.96,"dewPoint":33.75,"humidity":0.88,"pressure":1019.3,"windSpeed":2.49,"windBearing":73,"cloudCover":0.59,"uvIndex":0,"visibility":6.09},{"time":1388624400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.4,"apparentTemperature":36.52,"dewPoint":34.61,"humidity":0.83,"pressure":1018.9,"windSpeed":4.11,"windBearing":114,"cloudCover":0.75,"uvIndex":0,"visibility":6.3},{"time":1388628000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.85,"apparentTemperature":37.85,"dewPoint":34.01,"humidity":0.86,"pressure":1018.9,"windSpeed":2.92,"windBearing":107,"cloudCover":0.31,"uvIndex":0,"visibility":6.34},{"time":1388631600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.05,"apparentTemperature":35.05,"dewPoint":32.48,"humidity":0.9,"pressure":1018.39,"windSpeed":1.4,"windBearing":296,"cloudCover":0.52,"uvIndex":0,"visibility":6.32},{"time":1388635200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":36.47,"apparentTemperature":29.75,"dewPoint":32.5,"humidity":0.85,"pressure":1018.3,"windSpeed":9,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":6.51},{"time":1388638800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.8,"apparentTemperature":34.52,"dewPoint":34.17,"humidity":0.87,"pressure":1018.1,"windSpeed":4.27,"windBearing":110,"cloudCover":0.31,"uvIndex":0,"visibility":6.67},{"time":1388642400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":33.23,"apparentTemperature":33.23,"dewPoint":31.37,"humidity":0.93,"pressure":1017.83,"windSpeed":2.35,"windBearing":270,"cloudCover":0.83,"uvIndex":0,"visibility":8.43},{"time":1388646000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":38.84,"apparentTemperature":38.84,"dewPoint":35.21,"humidity":0.87,"pressure":1017.7,"windSpeed":2.61,"windBearing":66,"cloudCover":0.75,"uvIndex":0,"visibility":6.2},{"time":1388649600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":40.2,"apparentTemperature":40.2,"dewPoint":36.89,"humidity":0.88,"pressure":1018,"windSpeed":2.21,"windBearing":63,"cloudCover":1,"uvIndex":0,"visibility":6.2},{"time":1388653200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":39.56,"apparentTemperature":34.03,"dewPoint":36.15,"humidity":0.87,"pressure":1017.72,"windSpeed":8.05,"windBearing":290,"cloudCover":0.89,"uvIndex":0,"visibility":7.1},{"time":1388656800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.64,"apparentTemperature":44.64,"dewPoint":38,"humidity":0.77,"pressure":1017.7,"windSpeed":2.33,"windBearing":348,"cloudCover":1,"uvIndex":1,"visibility":6.2},{"time":1388660400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":46.12,"apparentTemperature":46.12,"dewPoint":38.33,"humidity":0.74,"pressure":1017.3,"windSpeed":2.93,"windBearing":295,"cloudCover":1,"uvIndex":1,"visibility":6.03},{"time":1388664000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":38.01,"dewPoint":34.68,"humidity":0.76,"pressure":1016.52,"windSpeed":5.36,"windBearing":273,"cloudCover":0.92,"uvIndex":1,"visibility":7.28},{"time":1388667600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":47.2,"apparentTemperature":45.03,"dewPoint":40.35,"humidity":0.77,"pressure":1016.2,"windSpeed":4.84,"windBearing":337,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388671200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.85,"apparentTemperature":43.76,"dewPoint":41.03,"humidity":0.83,"pressure":1016.2,"windSpeed":4.41,"windBearing":315,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388674800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":43.36,"apparentTemperature":40.46,"dewPoint":40.54,"humidity":0.9,"pressure":1016.57,"windSpeed":4.95,"windBearing":286,"cloudCover":0.86,"uvIndex":0,"visibility":4.73},{"time":1388678400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":41.97,"dewPoint":42.1,"humidity":0.92,"pressure":1016.4,"windSpeed":4.24,"windBearing":313,"cloudCover":1,"uvIndex":0,"visibility":4.91},{"time":1388682000,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":44.2,"dewPoint":43.13,"humidity":0.96,"pressure":1016.6,"windSpeed":1.99,"windBearing":322,"cloudCover":1,"uvIndex":0,"visibility":4.4},{"time":1388685600,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":41.53,"dewPoint":40.15,"humidity":0.95,"pressure":1016.82,"windSpeed":2.93,"windBearing":268,"cloudCover":0.94,"uvIndex":0,"visibility":4.83},{"time":1388689200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":44.45,"humidity":0.95,"pressure":1016.7,"windSpeed":2,"windBearing":60,"cloudCover":1,"uvIndex":0,"visibility":4.6},{"time":1388692800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":42.16,"humidity":0.87,"pressure":1017,"windSpeed":1.52,"windBearing":339,"cloudCover":1,"uvIndex":0,"visibility":4.5},{"time":1388696400,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":42.87,"apparentTemperature":42.87,"dewPoint":41.4,"humidity":0.94,"pressure":1017.27,"windSpeed":2.03,"windBearing":334,"cloudCover":1,"uvIndex":0,"visibility":4.19}]}}');

            swn.processRecord(json);

        });

        it ('null values in the weather record', function() {
            let json = JSON.parse('{"latitude":45.95472,"longitude":13.664836,"timezone":"Europe/Ljubljana","currently":{"time": 2},"hourly":{"data":[{"time":1388530800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":41.68,"apparentTemperature":37.87,"dewPoint":36.19,"humidity":0.81,"pressure":1020.1,"windSpeed":5.82,"windBearing":92,"cloudCover":0.18,"uvIndex":0,"visibility":6.67},{"time":1388534400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.92,"apparentTemperature":39.92,"dewPoint":34.75,"humidity":0.82,"pressure":1019.69,"windSpeed":2.83,"windBearing":58,"cloudCover":0.42,"uvIndex":0,"visibility":6.18},{"time":1388538000,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.8,"apparentTemperature":36.94,"dewPoint":34.18,"humidity":0.8,"pressure":1019.3,"windSpeed":4.16,"windBearing":112,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388541600,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.18,"apparentTemperature":33.08,"dewPoint":34.93,"humidity":0.85,"pressure":1019.3,"windSpeed":9,"windBearing":120,"cloudCover":0.18,"uvIndex":0,"visibility":7.03},{"time":1388545200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.02,"apparentTemperature":33.56,"dewPoint":31.67,"humidity":0.84,"pressure":1019.26,"windSpeed":3.25,"windBearing":239,"cloudCover":0.59,"uvIndex":0,"visibility":5.68},{"time":1388548800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.28,"apparentTemperature":32.75,"dewPoint":34.94,"humidity":0.84,"pressure":1019.1,"windSpeed":10,"windBearing":120,"visibility":7.03},{"time":1388552400,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.88,"apparentTemperature":36.59,"dewPoint":35.76,"humidity":0.85,"pressure":1019,"windSpeed":4.68,"windBearing":120,"visibility":6.67},{"time":1388556000,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.13,"apparentTemperature":35.13,"dewPoint":32.58,"humidity":0.9,"pressure":1019.2,"windSpeed":0.14,"windBearing":156,"cloudCover":0.77,"uvIndex":0,"visibility":7.75},{"time":1388559600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":40.62,"apparentTemperature":37.63,"dewPoint":35.66,"humidity":0.82,"pressure":1019,"windSpeed":4.46,"windBearing":123,"cloudCover":0.75,"uvIndex":0,"visibility":6.07},{"time":1388563200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":42.14,"apparentTemperature":38.98,"dewPoint":36.87,"humidity":0.81,"pressure":1019.4,"windSpeed":5,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.58},{"time":1388566800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":40.49,"apparentTemperature":40.49,"dewPoint":35.13,"humidity":0.81,"pressure":1020.2,"windSpeed":1,"windBearing":110,"cloudCover":0.81,"uvIndex":0,"visibility":7.4},{"time":1388570400,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":44.84,"apparentTemperature":44.84,"dewPoint":38.35,"humidity":0.78,"pressure":1019.9,"windSpeed":1.41,"windBearing":286,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388574000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":46.19,"apparentTemperature":46.19,"dewPoint":38.73,"humidity":0.75,"pressure":1019.8,"windSpeed":2.05,"windBearing":285,"cloudCover":0.75,"uvIndex":1,"visibility":6.86},{"time":1388577600,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":42.55,"apparentTemperature":42.55,"dewPoint":33.77,"humidity":0.71,"pressure":1019.54,"windSpeed":0.05,"windBearing":298,"cloudCover":0.63,"uvIndex":1,"visibility":8.59},{"time":1388581200,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.3,"apparentTemperature":49.3,"dewPoint":39.35,"humidity":0.68,"pressure":1019.1,"windSpeed":1.74,"windBearing":275,"cloudCover":0.31,"uvIndex":1,"visibility":7.06},{"time":1388584800,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":49.6,"apparentTemperature":49.6,"dewPoint":38.88,"humidity":0.66,"pressure":1019,"windSpeed":1.85,"windBearing":298,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388588400,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":45.11,"apparentTemperature":45.11,"dewPoint":36.12,"humidity":0.71,"pressure":1019.19,"windSpeed":0.67,"windBearing":251,"cloudCover":0.43,"uvIndex":0,"visibility":7.96},{"time":1388592000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.54,"apparentTemperature":43.54,"dewPoint":37.19,"humidity":0.78,"pressure":1019.1,"windSpeed":2.07,"windBearing":290,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388595600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":43.2,"apparentTemperature":43.2,"dewPoint":37.15,"humidity":0.79,"pressure":1019.5,"windSpeed":2.33,"windBearing":106,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388599200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.61,"apparentTemperature":39.61,"dewPoint":34.6,"humidity":0.82,"pressure":null,"windSpeed":null,"windBearing":null,"cloudCover":null,"uvIndex":0,"visibility":8.75},{"time":1388602800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":44,"apparentTemperature":41.17,"dewPoint":37.74,"humidity":0.78,"pressure":1020.1,"windSpeed":5,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388606400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":42.88,"apparentTemperature":42.88,"dewPoint":36.9,"humidity":0.79,"pressure":1020.2,"windSpeed":2.06,"windBearing":113,"cloudCover":0.31,"uvIndex":0,"visibility":7.19},{"time":1388610000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.4,"apparentTemperature":39.4,"dewPoint":34.86,"humidity":0.84,"pressure":1020.08,"windSpeed":2.14,"windBearing":103,"cloudCover":0.41,"uvIndex":0,"visibility":6.93},{"time":1388613600,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":40.51,"apparentTemperature":34.72,"dewPoint":35.38,"humidity":0.82,"pressure":1020,"windSpeed":9,"windBearing":130,"cloudCover":0.75,"uvIndex":0,"visibility":6.62},{"time":1388617200,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.89,"apparentTemperature":39.89,"dewPoint":34.98,"humidity":0.82,"pressure":1019.6,"windSpeed":2.71,"windBearing":116,"cloudCover":0.75,"uvIndex":0,"visibility":6.48},{"time":1388620800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":36.96,"apparentTemperature":36.96,"dewPoint":33.75,"humidity":0.88,"pressure":1019.3,"windSpeed":2.49,"windBearing":73,"cloudCover":0.59,"uvIndex":0,"visibility":6.09},{"time":1388624400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":39.4,"apparentTemperature":36.52,"dewPoint":34.61,"humidity":0.83,"pressure":1018.9,"windSpeed":4.11,"windBearing":114,"cloudCover":0.75,"uvIndex":0,"visibility":6.3},{"time":1388628000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.85,"apparentTemperature":37.85,"dewPoint":34.01,"humidity":0.86,"pressure":1018.9,"windSpeed":2.92,"windBearing":107,"cloudCover":0.31,"uvIndex":0,"visibility":6.34},{"time":1388631600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":35.05,"apparentTemperature":35.05,"dewPoint":32.48,"humidity":0.9,"pressure":1018.39,"windSpeed":1.4,"windBearing":296,"cloudCover":0.52,"uvIndex":0,"visibility":6.32},{"time":1388635200,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":36.47,"apparentTemperature":29.75,"dewPoint":32.5,"humidity":0.85,"pressure":1018.3,"windSpeed":9,"windBearing":120,"cloudCover":0.31,"uvIndex":0,"visibility":6.51},{"time":1388638800,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipType":"rain","temperature":37.8,"apparentTemperature":34.52,"dewPoint":34.17,"humidity":0.87,"pressure":1018.1,"windSpeed":4.27,"windBearing":110,"cloudCover":0.31,"uvIndex":0,"visibility":6.67},{"time":1388642400,"summary":"Mostly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":33.23,"apparentTemperature":33.23,"dewPoint":31.37,"humidity":0.93,"pressure":1017.83,"windSpeed":2.35,"windBearing":270,"cloudCover":0.83,"uvIndex":0,"visibility":8.43},{"time":1388646000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipType":"rain","temperature":38.84,"apparentTemperature":38.84,"dewPoint":35.21,"humidity":0.87,"pressure":1017.7,"windSpeed":2.61,"windBearing":66,"cloudCover":0.75,"uvIndex":0,"visibility":6.2},{"time":1388649600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":40.2,"apparentTemperature":40.2,"dewPoint":36.89,"humidity":0.88,"pressure":1018,"windSpeed":2.21,"windBearing":63,"cloudCover":1,"uvIndex":0,"visibility":6.2},{"time":1388653200,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":39.56,"apparentTemperature":34.03,"dewPoint":36.15,"humidity":0.87,"pressure":1017.72,"windSpeed":8.05,"windBearing":290,"cloudCover":0.89,"uvIndex":0,"visibility":7.1},{"time":1388656800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.64,"apparentTemperature":44.64,"dewPoint":38,"humidity":0.77,"pressure":1017.7,"windSpeed":2.33,"windBearing":348,"cloudCover":1,"uvIndex":1,"visibility":6.2},{"time":1388660400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":46.12,"apparentTemperature":46.12,"dewPoint":38.33,"humidity":0.74,"pressure":1017.3,"windSpeed":2.93,"windBearing":295,"cloudCover":1,"uvIndex":1,"visibility":6.03},{"time":1388664000,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":38.01,"dewPoint":34.68,"humidity":0.76,"pressure":1016.52,"windSpeed":5.36,"windBearing":273,"cloudCover":0.92,"uvIndex":1,"visibility":7.28},{"time":1388667600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":47.2,"apparentTemperature":45.03,"dewPoint":40.35,"humidity":0.77,"pressure":1016.2,"windSpeed":4.84,"windBearing":337,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388671200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.85,"apparentTemperature":43.76,"dewPoint":41.03,"humidity":0.83,"pressure":1016.2,"windSpeed":4.41,"windBearing":315,"cloudCover":1,"uvIndex":0,"visibility":5.48},{"time":1388674800,"summary":"Mostly Cloudy","icon":"partly-cloudy-day","precipIntensity":0,"precipProbability":0,"temperature":43.36,"apparentTemperature":40.46,"dewPoint":40.54,"humidity":0.9,"pressure":1016.57,"windSpeed":4.95,"windBearing":286,"cloudCover":0.86,"uvIndex":0,"visibility":4.73},{"time":1388678400,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":41.97,"dewPoint":42.1,"humidity":0.92,"pressure":1016.4,"windSpeed":4.24,"windBearing":313,"cloudCover":1,"uvIndex":0,"visibility":4.91},{"time":1388682000,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":44.2,"apparentTemperature":44.2,"dewPoint":43.13,"humidity":0.96,"pressure":1016.6,"windSpeed":1.99,"windBearing":322,"cloudCover":1,"uvIndex":0,"visibility":4.4},{"time":1388685600,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":41.53,"apparentTemperature":41.53,"dewPoint":40.15,"humidity":0.95,"pressure":1016.82,"windSpeed":2.93,"windBearing":268,"cloudCover":0.94,"uvIndex":0,"visibility":4.83},{"time":1388689200,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":44.45,"humidity":0.95,"pressure":1016.7,"windSpeed":2,"windBearing":60,"cloudCover":1,"uvIndex":0,"visibility":4.6},{"time":1388692800,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.7,"apparentTemperature":45.7,"dewPoint":42.16,"humidity":0.87,"pressure":1017,"windSpeed":1.52,"windBearing":339,"cloudCover":1,"uvIndex":0,"visibility":4.5},{"time":1388696400,"summary":"Overcast","icon":"cloudy","precipIntensity":0,"precipProbability":0,"temperature":42.87,"apparentTemperature":42.87,"dewPoint":41.4,"humidity":0.94,"pressure":1017.27,"windSpeed":2.03,"windBearing":334,"cloudCover":1,"uvIndex":0,"visibility":4.19},{"time":1388700000,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.19,"apparentTemperature":45.19,"dewPoint":42.98,"humidity":0.92,"pressure":1017.3,"windSpeed":1.91,"windBearing":277,"cloudCover":1,"uvIndex":0,"visibility":2.89},{"time":1388703600,"summary":"Overcast","icon":"cloudy","precipType":"rain","temperature":45.45,"apparentTemperature":45.45,"dewPoint":43.01,"humidity":0.91,"pressure":1017.4,"windSpeed":2,"windBearing":254,"cloudCover":1,"uvIndex":0,"visibility":2.92}]}}');

            swn.processRecord(json);
        });
    });

    describe('24h node test', function() {
        it('number of data records', function() {
            assert.equal(swn24.datasize, 24);
        });

        it ('check store structure', function() {
            assert.deepEqual(swn24.rawstore.fields, [{"id":0,"name":"temperature0","type":"float","nullable":false,"internal":false,"primary":false},{"id":1,"name":"humidity0","type":"float","nullable":false,"internal":false,"primary":false},{"id":2,"name":"pressure0","type":"float","nullable":false,"internal":false,"primary":false},{"id":3,"name":"windSpeed0","type":"float","nullable":false,"internal":false,"primary":false},{"id":4,"name":"windBearing0","type":"float","nullable":false,"internal":false,"primary":false},{"id":5,"name":"cloudCover0","type":"float","nullable":false,"internal":false,"primary":false},{"id":6,"name":"temperature1","type":"float","nullable":false,"internal":false,"primary":false},{"id":7,"name":"humidity1","type":"float","nullable":false,"internal":false,"primary":false},{"id":8,"name":"pressure1","type":"float","nullable":false,"internal":false,"primary":false},{"id":9,"name":"windSpeed1","type":"float","nullable":false,"internal":false,"primary":false},{"id":10,"name":"windBearing1","type":"float","nullable":false,"internal":false,"primary":false},{"id":11,"name":"cloudCover1","type":"float","nullable":false,"internal":false,"primary":false},{"id":12,"name":"temperature2","type":"float","nullable":false,"internal":false,"primary":false},{"id":13,"name":"humidity2","type":"float","nullable":false,"internal":false,"primary":false},{"id":14,"name":"pressure2","type":"float","nullable":false,"internal":false,"primary":false},{"id":15,"name":"windSpeed2","type":"float","nullable":false,"internal":false,"primary":false},{"id":16,"name":"windBearing2","type":"float","nullable":false,"internal":false,"primary":false},{"id":17,"name":"cloudCover2","type":"float","nullable":false,"internal":false,"primary":false},{"id":18,"name":"temperature3","type":"float","nullable":false,"internal":false,"primary":false},{"id":19,"name":"humidity3","type":"float","nullable":false,"internal":false,"primary":false},{"id":20,"name":"pressure3","type":"float","nullable":false,"internal":false,"primary":false},{"id":21,"name":"windSpeed3","type":"float","nullable":false,"internal":false,"primary":false},{"id":22,"name":"windBearing3","type":"float","nullable":false,"internal":false,"primary":false},{"id":23,"name":"cloudCover3","type":"float","nullable":false,"internal":false,"primary":false},{"id":24,"name":"temperature4","type":"float","nullable":false,"internal":false,"primary":false},{"id":25,"name":"humidity4","type":"float","nullable":false,"internal":false,"primary":false},{"id":26,"name":"pressure4","type":"float","nullable":false,"internal":false,"primary":false},{"id":27,"name":"windSpeed4","type":"float","nullable":false,"internal":false,"primary":false},{"id":28,"name":"windBearing4","type":"float","nullable":false,"internal":false,"primary":false},{"id":29,"name":"cloudCover4","type":"float","nullable":false,"internal":false,"primary":false},{"id":30,"name":"temperature5","type":"float","nullable":false,"internal":false,"primary":false},{"id":31,"name":"humidity5","type":"float","nullable":false,"internal":false,"primary":false},{"id":32,"name":"pressure5","type":"float","nullable":false,"internal":false,"primary":false},{"id":33,"name":"windSpeed5","type":"float","nullable":false,"internal":false,"primary":false},{"id":34,"name":"windBearing5","type":"float","nullable":false,"internal":false,"primary":false},{"id":35,"name":"cloudCover5","type":"float","nullable":false,"internal":false,"primary":false},{"id":36,"name":"temperature6","type":"float","nullable":false,"internal":false,"primary":false},{"id":37,"name":"humidity6","type":"float","nullable":false,"internal":false,"primary":false},{"id":38,"name":"pressure6","type":"float","nullable":false,"internal":false,"primary":false},{"id":39,"name":"windSpeed6","type":"float","nullable":false,"internal":false,"primary":false},{"id":40,"name":"windBearing6","type":"float","nullable":false,"internal":false,"primary":false},{"id":41,"name":"cloudCover6","type":"float","nullable":false,"internal":false,"primary":false},{"id":42,"name":"temperature7","type":"float","nullable":false,"internal":false,"primary":false},{"id":43,"name":"humidity7","type":"float","nullable":false,"internal":false,"primary":false},{"id":44,"name":"pressure7","type":"float","nullable":false,"internal":false,"primary":false},{"id":45,"name":"windSpeed7","type":"float","nullable":false,"internal":false,"primary":false},{"id":46,"name":"windBearing7","type":"float","nullable":false,"internal":false,"primary":false},{"id":47,"name":"cloudCover7","type":"float","nullable":false,"internal":false,"primary":false},{"id":48,"name":"temperature8","type":"float","nullable":false,"internal":false,"primary":false},{"id":49,"name":"humidity8","type":"float","nullable":false,"internal":false,"primary":false},{"id":50,"name":"pressure8","type":"float","nullable":false,"internal":false,"primary":false},{"id":51,"name":"windSpeed8","type":"float","nullable":false,"internal":false,"primary":false},{"id":52,"name":"windBearing8","type":"float","nullable":false,"internal":false,"primary":false},{"id":53,"name":"cloudCover8","type":"float","nullable":false,"internal":false,"primary":false},{"id":54,"name":"temperature9","type":"float","nullable":false,"internal":false,"primary":false},{"id":55,"name":"humidity9","type":"float","nullable":false,"internal":false,"primary":false},{"id":56,"name":"pressure9","type":"float","nullable":false,"internal":false,"primary":false},{"id":57,"name":"windSpeed9","type":"float","nullable":false,"internal":false,"primary":false},{"id":58,"name":"windBearing9","type":"float","nullable":false,"internal":false,"primary":false},{"id":59,"name":"cloudCover9","type":"float","nullable":false,"internal":false,"primary":false},{"id":60,"name":"temperature10","type":"float","nullable":false,"internal":false,"primary":false},{"id":61,"name":"humidity10","type":"float","nullable":false,"internal":false,"primary":false},{"id":62,"name":"pressure10","type":"float","nullable":false,"internal":false,"primary":false},{"id":63,"name":"windSpeed10","type":"float","nullable":false,"internal":false,"primary":false},{"id":64,"name":"windBearing10","type":"float","nullable":false,"internal":false,"primary":false},{"id":65,"name":"cloudCover10","type":"float","nullable":false,"internal":false,"primary":false},{"id":66,"name":"temperature11","type":"float","nullable":false,"internal":false,"primary":false},{"id":67,"name":"humidity11","type":"float","nullable":false,"internal":false,"primary":false},{"id":68,"name":"pressure11","type":"float","nullable":false,"internal":false,"primary":false},{"id":69,"name":"windSpeed11","type":"float","nullable":false,"internal":false,"primary":false},{"id":70,"name":"windBearing11","type":"float","nullable":false,"internal":false,"primary":false},{"id":71,"name":"cloudCover11","type":"float","nullable":false,"internal":false,"primary":false},{"id":72,"name":"temperature12","type":"float","nullable":false,"internal":false,"primary":false},{"id":73,"name":"humidity12","type":"float","nullable":false,"internal":false,"primary":false},{"id":74,"name":"pressure12","type":"float","nullable":false,"internal":false,"primary":false},{"id":75,"name":"windSpeed12","type":"float","nullable":false,"internal":false,"primary":false},{"id":76,"name":"windBearing12","type":"float","nullable":false,"internal":false,"primary":false},{"id":77,"name":"cloudCover12","type":"float","nullable":false,"internal":false,"primary":false},{"id":78,"name":"temperature13","type":"float","nullable":false,"internal":false,"primary":false},{"id":79,"name":"humidity13","type":"float","nullable":false,"internal":false,"primary":false},{"id":80,"name":"pressure13","type":"float","nullable":false,"internal":false,"primary":false},{"id":81,"name":"windSpeed13","type":"float","nullable":false,"internal":false,"primary":false},{"id":82,"name":"windBearing13","type":"float","nullable":false,"internal":false,"primary":false},{"id":83,"name":"cloudCover13","type":"float","nullable":false,"internal":false,"primary":false},{"id":84,"name":"temperature14","type":"float","nullable":false,"internal":false,"primary":false},{"id":85,"name":"humidity14","type":"float","nullable":false,"internal":false,"primary":false},{"id":86,"name":"pressure14","type":"float","nullable":false,"internal":false,"primary":false},{"id":87,"name":"windSpeed14","type":"float","nullable":false,"internal":false,"primary":false},{"id":88,"name":"windBearing14","type":"float","nullable":false,"internal":false,"primary":false},{"id":89,"name":"cloudCover14","type":"float","nullable":false,"internal":false,"primary":false},{"id":90,"name":"temperature15","type":"float","nullable":false,"internal":false,"primary":false},{"id":91,"name":"humidity15","type":"float","nullable":false,"internal":false,"primary":false},{"id":92,"name":"pressure15","type":"float","nullable":false,"internal":false,"primary":false},{"id":93,"name":"windSpeed15","type":"float","nullable":false,"internal":false,"primary":false},{"id":94,"name":"windBearing15","type":"float","nullable":false,"internal":false,"primary":false},{"id":95,"name":"cloudCover15","type":"float","nullable":false,"internal":false,"primary":false},{"id":96,"name":"temperature16","type":"float","nullable":false,"internal":false,"primary":false},{"id":97,"name":"humidity16","type":"float","nullable":false,"internal":false,"primary":false},{"id":98,"name":"pressure16","type":"float","nullable":false,"internal":false,"primary":false},{"id":99,"name":"windSpeed16","type":"float","nullable":false,"internal":false,"primary":false},{"id":100,"name":"windBearing16","type":"float","nullable":false,"internal":false,"primary":false},{"id":101,"name":"cloudCover16","type":"float","nullable":false,"internal":false,"primary":false},{"id":102,"name":"temperature17","type":"float","nullable":false,"internal":false,"primary":false},{"id":103,"name":"humidity17","type":"float","nullable":false,"internal":false,"primary":false},{"id":104,"name":"pressure17","type":"float","nullable":false,"internal":false,"primary":false},{"id":105,"name":"windSpeed17","type":"float","nullable":false,"internal":false,"primary":false},{"id":106,"name":"windBearing17","type":"float","nullable":false,"internal":false,"primary":false},{"id":107,"name":"cloudCover17","type":"float","nullable":false,"internal":false,"primary":false},{"id":108,"name":"temperature18","type":"float","nullable":false,"internal":false,"primary":false},{"id":109,"name":"humidity18","type":"float","nullable":false,"internal":false,"primary":false},{"id":110,"name":"pressure18","type":"float","nullable":false,"internal":false,"primary":false},{"id":111,"name":"windSpeed18","type":"float","nullable":false,"internal":false,"primary":false},{"id":112,"name":"windBearing18","type":"float","nullable":false,"internal":false,"primary":false},{"id":113,"name":"cloudCover18","type":"float","nullable":false,"internal":false,"primary":false},{"id":114,"name":"temperature19","type":"float","nullable":false,"internal":false,"primary":false},{"id":115,"name":"humidity19","type":"float","nullable":false,"internal":false,"primary":false},{"id":116,"name":"pressure19","type":"float","nullable":false,"internal":false,"primary":false},{"id":117,"name":"windSpeed19","type":"float","nullable":false,"internal":false,"primary":false},{"id":118,"name":"windBearing19","type":"float","nullable":false,"internal":false,"primary":false},{"id":119,"name":"cloudCover19","type":"float","nullable":false,"internal":false,"primary":false},{"id":120,"name":"temperature20","type":"float","nullable":false,"internal":false,"primary":false},{"id":121,"name":"humidity20","type":"float","nullable":false,"internal":false,"primary":false},{"id":122,"name":"pressure20","type":"float","nullable":false,"internal":false,"primary":false},{"id":123,"name":"windSpeed20","type":"float","nullable":false,"internal":false,"primary":false},{"id":124,"name":"windBearing20","type":"float","nullable":false,"internal":false,"primary":false},{"id":125,"name":"cloudCover20","type":"float","nullable":false,"internal":false,"primary":false},{"id":126,"name":"temperature21","type":"float","nullable":false,"internal":false,"primary":false},{"id":127,"name":"humidity21","type":"float","nullable":false,"internal":false,"primary":false},{"id":128,"name":"pressure21","type":"float","nullable":false,"internal":false,"primary":false},{"id":129,"name":"windSpeed21","type":"float","nullable":false,"internal":false,"primary":false},{"id":130,"name":"windBearing21","type":"float","nullable":false,"internal":false,"primary":false},{"id":131,"name":"cloudCover21","type":"float","nullable":false,"internal":false,"primary":false},{"id":132,"name":"temperature22","type":"float","nullable":false,"internal":false,"primary":false},{"id":133,"name":"humidity22","type":"float","nullable":false,"internal":false,"primary":false},{"id":134,"name":"pressure22","type":"float","nullable":false,"internal":false,"primary":false},{"id":135,"name":"windSpeed22","type":"float","nullable":false,"internal":false,"primary":false},{"id":136,"name":"windBearing22","type":"float","nullable":false,"internal":false,"primary":false},{"id":137,"name":"cloudCover22","type":"float","nullable":false,"internal":false,"primary":false},{"id":138,"name":"temperature23","type":"float","nullable":false,"internal":false,"primary":false},{"id":139,"name":"humidity23","type":"float","nullable":false,"internal":false,"primary":false},{"id":140,"name":"pressure23","type":"float","nullable":false,"internal":false,"primary":false},{"id":141,"name":"windSpeed23","type":"float","nullable":false,"internal":false,"primary":false},{"id":142,"name":"windBearing23","type":"float","nullable":false,"internal":false,"primary":false},{"id":143,"name":"cloudCover23","type":"float","nullable":false,"internal":false,"primary":false}]);
        });
    });

    describe('3d node test and flexible field types', function() {
        it('number of data records', function() {
            assert.equal(swn3.datasize, 3);
        });

        it ('check store structure', function() {
            assert.deepEqual(swn3.rawstore.fields, [{"id":0,"name":"temperature0","type":"float","nullable":false,"internal":false,"primary":false},{"id":1,"name":"humidity0","type":"float","nullable":false,"internal":false,"primary":false},{"id":2,"name":"pressure0","type":"float","nullable":false,"internal":false,"primary":false},{"id":3,"name":"windSpeed0","type":"float","nullable":false,"internal":false,"primary":false},{"id":4,"name":"windBearing0","type":"float","nullable":false,"internal":false,"primary":false},{"id":5,"name":"cloudCover0","type":"float","nullable":false,"internal":false,"primary":false},{"id":6,"name":"daylight0","type":"float","nullable":false,"internal":false,"primary":false},{"id":7,"name":"temperature1","type":"float","nullable":false,"internal":false,"primary":false},{"id":8,"name":"humidity1","type":"float","nullable":false,"internal":false,"primary":false},{"id":9,"name":"pressure1","type":"float","nullable":false,"internal":false,"primary":false},{"id":10,"name":"windSpeed1","type":"float","nullable":false,"internal":false,"primary":false},{"id":11,"name":"windBearing1","type":"float","nullable":false,"internal":false,"primary":false},{"id":12,"name":"cloudCover1","type":"float","nullable":false,"internal":false,"primary":false},{"id":13,"name":"daylight1","type":"float","nullable":false,"internal":false,"primary":false},{"id":14,"name":"temperature2","type":"float","nullable":false,"internal":false,"primary":false},{"id":15,"name":"humidity2","type":"float","nullable":false,"internal":false,"primary":false},{"id":16,"name":"pressure2","type":"float","nullable":false,"internal":false,"primary":false},{"id":17,"name":"windSpeed2","type":"float","nullable":false,"internal":false,"primary":false},{"id":18,"name":"windBearing2","type":"float","nullable":false,"internal":false,"primary":false},{"id":19,"name":"cloudCover2","type":"float","nullable":false,"internal":false,"primary":false},{"id":20,"name":"daylight2","type":"float","nullable":false,"internal":false,"primary":false}]);
        });

        it ('data record record saved correctly', function() {
            let json = JSON.parse('{"latitude":45.95472,"longitude":13.664836,"timezone":"Europe/Ljubljana","currently":{"time": 0},"daily":{"data":[{"time":1388530800,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":41.68,"apparentTemperature":37.87,"dewPoint":36.19,"humidity":0.81,"pressure":1020.1,"windSpeed":5.82,"windBearing":92,"cloudCover":0.18,"uvIndex":0,"visibility":6.67},{"time":1388534400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0,"precipProbability":0,"temperature":39.92,"apparentTemperature":39.92,"dewPoint":34.75,"humidity":0.82,"pressure":1019.69,"windSpeed":2.83,"windBearing":58,"cloudCover":0.42,"uvIndex":0,"visibility":6.18},{"time":1388538000,"summary":"Clear","icon":"clear-night","precipType":"rain","temperature":39.8,"apparentTemperature":36.94,"dewPoint":34.18,"humidity":0.8,"pressure":1019.3,"windSpeed":4.16,"windBearing":112,"cloudCover":0.18,"uvIndex":0,"visibility":7.03, "daylight": 1}]}}');

            swn3.processRecord(json);

            assert.equal(swn3.buffer.length, 1);

            let viable = [ 'humidity', 'pressure', 'windSpeed', 'windBearing', 'cloudCover', 'temperature', 'daylight'];

            for (let i = 0; i < 3; i++) {
                let keys = Object.keys(json.daily.data[i]);
                for (let j = 0; j < keys.length; j++) {
                    let key = keys[j];
                    let storekey = key + i;
                    if (viable.indexOf(key) >= 0) {
                        //console.log(storekey, swn.buffer[0][storekey], json.hourly.data[i][key]);
                        assert.equal(swn3.buffer[0][storekey], json.daily.data[i][key]);
                    }
                }

            }
        });
    });

});