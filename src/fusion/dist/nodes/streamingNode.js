const a0_0x2c0d=['mqtt','offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20','nodeid','timeDiff','time','zookeeper','error','tick','Offset','setSlaveOffset','|ema|','nodeId','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20','|winbuf|','):\x20','isMaster','push','base','\x0a\x0asetSlaveOffset:\x20ERROR\x20-\x20timestamps\x20DO\x20NOT\x20match!','offsetExists','\x0aDifference\x20(buffer\x20-\x20zero):\x20','addStreamAggr','|min|','getAggregates','consumer','position','getTimestamp','ERROR','winsize','buffer','\x20-\x20(','connectionConfig','length','parent','getPartialFeatureVector','stringify','setOffset','shift','interval','offset','master','bind','Rows\x20to\x20delete\x20(','attributes','connection','rawstore','sub','processRecord','Connecting\x20to\x20Kafka:\x20','max','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','deleteObsoleteRows','previous','PROBLEM:\x20No\x20connection\x20(OK\x20for\x20tests)!','PROBLEM:\x20No\x20parent\x20defined.\x20No\x20connection\x20(OK\x20for\x20tests).','parse','\x20/\x20','Fusion\x20tick','offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20','name','timeSeriesTick','fusion_id','aggregate','maxNegativeOffset','winbuf','constructor','value','floor','indexOf','test','setSlaveIndex:\x20there\x20is\x20no\x20data\x20-\x20','\x0aNode:\x20','apply','exports','checkDataAvailability','Consumer','stampm','|max|','config','variance','min','broker','Time','message','offsetOutOfRange','topic','postConstructor','measurements_node_','field','ema','broadcastAggregates','log','client','processRecordCb','fusionNodeI','setMasterOffset','|tick','Error','type','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20','getFloat','addListener','fusionTick'];(function(_0x1b5257,_0x2c0d8a){const _0x535b83=function(_0x53582c){while(--_0x53582c){_0x1b5257['push'](_0x1b5257['shift']());}},_0x317638=function(){const _0x2e0a40={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x2df55b,_0x55ae80,_0x295f22,_0x2b368c){_0x2b368c=_0x2b368c||{};let _0x2c0054=_0x55ae80+'='+_0x295f22,_0x28c853=0x0;for(let _0x57b843=0x0,_0x2088ee=_0x2df55b['length'];_0x57b843<_0x2088ee;_0x57b843++){const _0xd1f6f9=_0x2df55b[_0x57b843];_0x2c0054+=';\x20'+_0xd1f6f9;const _0x121312=_0x2df55b[_0xd1f6f9];_0x2df55b['push'](_0x121312),_0x2088ee=_0x2df55b['length'],_0x121312!==!![]&&(_0x2c0054+='='+_0x121312);}_0x2b368c['cookie']=_0x2c0054;},'removeCookie':function(){return'dev';},'getCookie':function(_0x4c1b7c,_0x34f1ce){_0x4c1b7c=_0x4c1b7c||function(_0x357540){return _0x357540;};const _0x3c611c=_0x4c1b7c(new RegExp('(?:^|;\x20)'+_0x34f1ce['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)')),_0x52da97=function(_0x3f3b91,_0x1b42f7){_0x3f3b91(++_0x1b42f7);};return _0x52da97(_0x535b83,_0x2c0d8a),_0x3c611c?decodeURIComponent(_0x3c611c[0x1]):undefined;}},_0x4f1cb9=function(){const _0xa7c716=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0xa7c716['test'](_0x2e0a40['removeCookie']['toString']());};_0x2e0a40['updateCookie']=_0x4f1cb9;let _0x3537d1='';const _0x12b60e=_0x2e0a40['updateCookie']();if(!_0x12b60e)_0x2e0a40['setCookie'](['*'],'counter',0x1);else _0x12b60e?_0x3537d1=_0x2e0a40['getCookie'](null,'counter'):_0x2e0a40['removeCookie']();};_0x317638();}(a0_0x2c0d,0xd6));const a0_0x535b=function(_0x1b5257,_0x2c0d8a){_0x1b5257=_0x1b5257-0x0;let _0x535b83=a0_0x2c0d[_0x1b5257];return _0x535b83;};const a0_0x295f22=function(){let _0x230a5d=!![];return function(_0x1dd13d,_0x151780){const _0x3d0d3d=_0x230a5d?function(){if(_0x151780){const _0x7c36a3=_0x151780[a0_0x535b('0x40')](_0x1dd13d,arguments);return _0x151780=null,_0x7c36a3;}}:function(){};return _0x230a5d=![],_0x3d0d3d;};}(),a0_0x55ae80=a0_0x295f22(this,function(){const _0x5c74d9=function(){const _0x3a358e=_0x5c74d9[a0_0x535b('0x39')]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[a0_0x535b('0x39')](a0_0x535b('0x2a'));return!_0x3a358e[a0_0x535b('0x3d')](a0_0x55ae80);};return _0x5c74d9();});a0_0x55ae80();const {KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require('../common/brokers/brokers.js');class streamingNode{constructor(_0x4a1495,_0x81ea9c,_0x3d19c9,_0x2dff35,_0x451af3,_0x301665,_0x20a415){this[a0_0x535b('0x9')]=_0x4a1495,this[a0_0x535b('0x36')]={},this['master']=_0x3d19c9[a0_0x535b('0x20')],this[a0_0x535b('0x46')]=JSON[a0_0x535b('0x2f')](JSON[a0_0x535b('0x1b')](_0x3d19c9)),this['connectionConfig']=JSON[a0_0x535b('0x2f')](JSON[a0_0x535b('0x1b')](_0x81ea9c)),this['topic']=a0_0x535b('0x4f')+this[a0_0x535b('0x46')][a0_0x535b('0x61')],this[a0_0x535b('0x56')]=_0x301665,this[a0_0x535b('0x55')]=_0x451af3,this[a0_0x535b('0x19')]=_0x20a415,this[a0_0x535b('0x5e')]=_0x3d19c9['fusionTick'],this[a0_0x535b('0x3')]=_0x3d19c9[a0_0x535b('0x61')],this[a0_0x535b('0x15')]=[],this[a0_0x535b('0x11')]=0x0;}[a0_0x535b('0x4e')](){let _0x2d0696=this;if(this[a0_0x535b('0x19')]!=null){if(this['parent'][a0_0x535b('0x46')][a0_0x535b('0x24')]['type']=='kafka')this[a0_0x535b('0x49')]=new KafkaNodeBroker(this[a0_0x535b('0x17')],this[a0_0x535b('0x4d')],a0_0x535b('0x54')+this[a0_0x535b('0x19')][a0_0x535b('0x35')]+this[a0_0x535b('0x3')]),this[a0_0x535b('0x49')][a0_0x535b('0x5d')](_0x2d0696[a0_0x535b('0x27')][a0_0x535b('0x21')](_0x2d0696));else this[a0_0x535b('0x19')][a0_0x535b('0x46')][a0_0x535b('0x24')][a0_0x535b('0x5a')]==a0_0x535b('0x5f')?(this[a0_0x535b('0x49')]=new MQTTBroker(this[a0_0x535b('0x17')],this[a0_0x535b('0x4d')],a0_0x535b('0x54')+this['parent'][a0_0x535b('0x35')]+this['nodeId']),this[a0_0x535b('0x49')]['addListener'](_0x2d0696['processRecord']['bind'](_0x2d0696))):console[a0_0x535b('0x53')](a0_0x535b('0x2d'));}else console[a0_0x535b('0x53')](a0_0x535b('0x2e'));}[a0_0x535b('0x7')](){return this[a0_0x535b('0x20')];}['connectToKafka'](){console[a0_0x535b('0x53')](a0_0x535b('0x28')+this['topic']),this[a0_0x535b('0x43')]=kafka[a0_0x535b('0x43')],this[a0_0x535b('0x54')]=new kafka['Client'](this['connectionConfig'][a0_0x535b('0x64')],this['id']),this[a0_0x535b('0x1f')]=new kafka[(a0_0x535b('0x0'))](this[a0_0x535b('0x54')]);let _0x40dcb3=this;this[a0_0x535b('0x10')]=new this[(a0_0x535b('0x43'))](this['client'],[{'topic':this[a0_0x535b('0x4d')],'partition':0x0}],{'groupId':this['id']}),this['consumer']['on'](a0_0x535b('0x4b'),function(_0x47f404){try{console['log']('Message\x20receieved.');let _0x46d39e=JSON['parse'](_0x47f404[a0_0x535b('0x3a')]);_0x40dcb3['processRecord'](_0x46d39e);}catch(_0x188c75){console[a0_0x535b('0x53')](a0_0x535b('0x13'),_0x188c75);}}),this[a0_0x535b('0x10')]['on'](a0_0x535b('0x65'),function(_0x58dc0b){console[a0_0x535b('0x53')](a0_0x535b('0x59'),_0x58dc0b);}),this['consumer']['on'](a0_0x535b('0x4c'),function(_0x364b4f){console['log'](_0x40dcb3['id'],'outOfRange',_0x364b4f),_0x364b4f['maxNum']=0x2,_0x40dcb3[a0_0x535b('0x1f')]['fetch']([_0x364b4f],function(_0x11b235,_0x2e11bc){if(_0x11b235)return console[a0_0x535b('0x65')](_0x11b235);var _0x33a3d4=Math[a0_0x535b('0x48')](_0x2e11bc[_0x364b4f[a0_0x535b('0x4d')]][_0x364b4f['partition']]);console['log'](_0x40dcb3),_0x40dcb3[a0_0x535b('0x10')][a0_0x535b('0x1c')](_0x364b4f['topic'],_0x364b4f['partition'],_0x33a3d4);});});}[a0_0x535b('0x52')](_0x212177){}[a0_0x535b('0x57')](){this[a0_0x535b('0x11')]=this['buffer'][a0_0x535b('0x18')]-0x1;}['getOffsetTimestamp'](){return this[a0_0x535b('0x15')][this[a0_0x535b('0x11')]]['stampm'];}[a0_0x535b('0x1')](_0x46066a){if(this['buffer'][a0_0x535b('0x18')]==0x0)return console[a0_0x535b('0x53')](a0_0x535b('0x3e')+this['nodeId']),![];let _0x19bf6b=this['buffer']['length']-0x1,_0x418232=this[a0_0x535b('0x15')][_0x19bf6b][a0_0x535b('0x44')],_0x224dae=(_0x418232-_0x46066a)/this[a0_0x535b('0x5e')];console[a0_0x535b('0x53')](a0_0x535b('0x31'),this[a0_0x535b('0x5e')],'Diff\x20ticks:',_0x224dae);let _0x4c053f=_0x19bf6b-_0x224dae;if(_0x4c053f<0x0)return console[a0_0x535b('0x53')](a0_0x535b('0x4')+this[a0_0x535b('0x3')]+'('+_0x4c053f+'/'+_0x19bf6b+')@'+this[a0_0x535b('0x19')][a0_0x535b('0x35')]),![];else{if(_0x4c053f>_0x19bf6b)return console[a0_0x535b('0x53')](a0_0x535b('0x5b')+this[a0_0x535b('0x3')]+'('+_0x4c053f+'/'+_0x19bf6b+')@'+this[a0_0x535b('0x19')][a0_0x535b('0x35')]),![];else _0x4c053f!=Math[a0_0x535b('0x3b')](_0x4c053f)&&console['log']('setSlaveOffset:\x20zeroIndex\x20is\x20not\x20a\x20whole\x20number\x20-\x20'+_0x4c053f);}return console[a0_0x535b('0x53')](_0x4c053f),this[a0_0x535b('0x15')][_0x4c053f][a0_0x535b('0x44')]!=_0x46066a&&(console[a0_0x535b('0x53')](a0_0x535b('0xa')),console[a0_0x535b('0x53')](a0_0x535b('0x3f')+this[a0_0x535b('0x3')]),console['log']('\x0aZero\x20index,\x20last\x20offset:\x20'+_0x4c053f+',\x20'+_0x19bf6b),console['log'](a0_0x535b('0xc')+this[a0_0x535b('0x15')][_0x4c053f][a0_0x535b('0x44')]+'\x20-\x20'+_0x46066a),console[a0_0x535b('0x53')]('\x0a\x0a\x0a')),this[a0_0x535b('0x11')]=_0x4c053f,!![];}[a0_0x535b('0x42')](){let _0x447e55=!![];this[a0_0x535b('0x37')]=0x0;for(let _0x10b2a2 in this[a0_0x535b('0x46')]['attributes']){let _0x2a81f1=this[a0_0x535b('0x46')]['attributes'][_0x10b2a2][a0_0x535b('0x63')];if(_0x2a81f1<this['maxNegativeOffset'])this[a0_0x535b('0x37')]=_0x2a81f1;if(!this[a0_0x535b('0xb')](_0x2a81f1))_0x447e55=![];}return _0x447e55;}[a0_0x535b('0xb')](_0x4e8b29){let _0x206734=this['position']+_0x4e8b29,_0x2ce3e9=this[a0_0x535b('0x15')][a0_0x535b('0x18')]-0x1;if(_0x206734<0x0)return console[a0_0x535b('0x53')](a0_0x535b('0x60')+this[a0_0x535b('0x3')]+a0_0x535b('0x16')+_0x206734+')'),![];else{if(_0x206734>_0x2ce3e9)return console['log'](a0_0x535b('0x32')+this[a0_0x535b('0x3')]+this[a0_0x535b('0x3')]+a0_0x535b('0x16')+_0x206734+'/'+_0x2ce3e9+')'),![];}return!![];}[a0_0x535b('0x2b')](){let _0x257a0f=this[a0_0x535b('0x11')]+this[a0_0x535b('0x37')]-0x5;console[a0_0x535b('0x53')](a0_0x535b('0x22')+this[a0_0x535b('0x3')]+',\x20'+this[a0_0x535b('0x19')]['fusion_id']+a0_0x535b('0x6')+_0x257a0f+a0_0x535b('0x30')+this['buffer'][a0_0x535b('0x18')]);for(let _0x3a574d=0x1;_0x3a574d<_0x257a0f;_0x3a574d++)this['buffer'][a0_0x535b('0x1d')]();}['createAggregates'](_0x1f6427){for(let _0x9b3497 in _0x1f6427){let _0x318a79=_0x1f6427[_0x9b3497],_0x156e82=_0x318a79[a0_0x535b('0x50')],_0x9b26c=_0x318a79[a0_0x535b('0x66')],_0x1dc5f1=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':a0_0x535b('0x34'),'timestamp':a0_0x535b('0x4a'),'value':_0x156e82}),_0x3975cf=_0x156e82+a0_0x535b('0x58');this['aggregate'][_0x3975cf]=_0x1dc5f1;for(let _0x3113b3 in _0x9b26c){let _0x1357d5=_0x9b26c[_0x3113b3],_0x5903e4=_0x1357d5[a0_0x535b('0x5a')];if(_0x5903e4==a0_0x535b('0x51')){let _0x461895=_0x1357d5[a0_0x535b('0x1e')],_0x435bc7=_0x1357d5['initWindow'],_0x3f6c32=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':'ema','inAggr':this[a0_0x535b('0x36')][_0x3975cf],'emaType':a0_0x535b('0x2c'),'interval':_0x461895,'initWindow':_0x435bc7}),_0x2b1d54=_0x156e82+a0_0x535b('0x2')+_0x461895;this['aggregate'][_0x2b1d54]=_0x3f6c32;}else{if(_0x5903e4==a0_0x535b('0x38')){let _0x360cad=_0x1357d5[a0_0x535b('0x14')],_0x3daa57=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':'timeSeriesWinBufVector','inAggr':this[a0_0x535b('0x36')][_0x3975cf],'winsize':_0x360cad}),_0x560149=_0x156e82+a0_0x535b('0x5')+_0x360cad;this[a0_0x535b('0x36')][_0x560149]=_0x3daa57;let _0x222b6d=_0x1357d5[a0_0x535b('0x26')];for(var _0x472975 in _0x222b6d){let _0x5e572e=_0x222b6d[_0x472975],_0x12996c=_0x5e572e[a0_0x535b('0x5a')];if(_0x12996c==a0_0x535b('0x47')){let _0x30d3d8=this['rawstore'][a0_0x535b('0xd')]({'type':'variance','inAggr':this['aggregate'][_0x560149]}),_0x1e0f76=_0x156e82+'|variance|'+_0x360cad;this[a0_0x535b('0x36')][_0x1e0f76]=_0x30d3d8;}else{if(_0x12996c=='ma'){let _0x345e23=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':'ma','inAggr':this[a0_0x535b('0x36')][_0x560149]}),_0x5e38c1=_0x156e82+'|ma|'+_0x360cad;this[a0_0x535b('0x36')][_0x5e38c1]=_0x345e23;}else{if(_0x12996c==a0_0x535b('0x48')){let _0x26700b=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':'winBufMin','inAggr':this[a0_0x535b('0x36')][_0x560149]}),_0x4d23d1=_0x156e82+a0_0x535b('0xe')+_0x360cad;this[a0_0x535b('0x36')][_0x4d23d1]=_0x26700b;}else{if(_0x12996c==a0_0x535b('0x29')){let _0x28b638=this[a0_0x535b('0x25')][a0_0x535b('0xd')]({'type':'winBufMax','inAggr':this[a0_0x535b('0x36')][_0x560149]}),_0x475e99=_0x156e82+a0_0x535b('0x45')+_0x360cad;this['aggregate'][_0x475e99]=_0x28b638;}}}}}}}}}}[a0_0x535b('0xf')](){var _0x2017d9={};for(let _0x5be04a in this[a0_0x535b('0x36')]){!(_0x5be04a['indexOf'](a0_0x535b('0x66'))>0x0||_0x5be04a[a0_0x535b('0x3c')](a0_0x535b('0x38'))>0x0)&&(_0x2017d9[_0x5be04a]=this[a0_0x535b('0x36')][_0x5be04a][a0_0x535b('0x5c')](),_0x2017d9['stampm']=this[a0_0x535b('0x36')][_0x5be04a][a0_0x535b('0x12')]());;};return _0x2017d9;}[a0_0x535b('0x1a')](){let _0xcaaa3f=[];for(let _0x5c1aa0 in this[a0_0x535b('0x46')][a0_0x535b('0x23')]){let _0x592f42=this['position'],_0x32c37e=this[a0_0x535b('0x15')][_0x592f42]['stampm'],_0x8ad25a=this[a0_0x535b('0x46')][a0_0x535b('0x23')][_0x5c1aa0][a0_0x535b('0x23')],_0xdd7bf3=this[a0_0x535b('0x46')]['attributes'][_0x5c1aa0]['time'];_0x592f42=_0x592f42+_0xdd7bf3;let _0x16066d=_0x32c37e+_0xdd7bf3*this[a0_0x535b('0x5e')],_0x5c2dc3=this[a0_0x535b('0x15')][_0x592f42][a0_0x535b('0x44')];if(_0x16066d!=_0x5c2dc3){while(_0x5c2dc3-_0x16066d<0x0){_0x592f42++,_0x5c2dc3=this[a0_0x535b('0x15')][_0x592f42][a0_0x535b('0x44')];}if(_0x5c2dc3!=_0x16066d)_0x592f42--;}for(let _0x2d7da8 in _0x8ad25a){let _0x3393ff=_0x8ad25a[_0x2d7da8][a0_0x535b('0x5a')],_0x43c3b7=_0x8ad25a[_0x2d7da8][a0_0x535b('0x33')];if(_0x3393ff=='value'){let _0x306214=this[a0_0x535b('0x15')][_0x592f42][_0x43c3b7];_0xcaaa3f[a0_0x535b('0x8')](_0x306214);}else{if(_0x3393ff==a0_0x535b('0x62')){let _0x3e90db=_0x592f42-_0x8ad25a[_0x2d7da8][a0_0x535b('0x1e')],_0x86ed9d=this['buffer'][_0x3e90db][_0x43c3b7]-this['buffer'][_0x592f42][_0x43c3b7];_0xcaaa3f[a0_0x535b('0x8')](_0x86ed9d);}}}}return _0xcaaa3f;}}module[a0_0x535b('0x41')]=streamingNode;