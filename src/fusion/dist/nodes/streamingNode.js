var _0x17f4=['addStreamAggr','previous','winbuf','winsize','timeSeriesWinBufVector','|winbuf|','sub','min','winBufMin','|min|','winBufMax','getAggregates','indexOf','getFloat','getTimestamp','name','push','timeDiff','interval','exports','../common/brokers/brokers.js','base','aggregate','master','config','stringify','measurements_node_','nodeid','fusionNodeI','processRecordCb','parent','fusionTick','nodeId','buffer','position','postConstructor','connection','type','broker','connectionConfig','topic','client','addListener','processRecord','bind','mqtt','fusion_id','log','isMaster','connectToKafka','Consumer','Client','zookeeper','offset','Offset','consumer','message','Message\x20receieved.','value','ERROR','error','Error','offsetOutOfRange','outOfRange','partition','setOffset','setMasterOffset','length','getOffsetTimestamp','stampm','setSlaveIndex:\x20there\x20is\x20no\x20data\x20-\x20','Fusion\x20tick','Diff\x20ticks:','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20','setSlaveOffset:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20','floor','\x0a\x0asetSlaveOffset:\x20ERROR\x20-\x20timestamps\x20DO\x20NOT\x20match!','\x0aNode:\x20','\x20-\x20','\x0a\x0a\x0a','checkDataAvailability','maxNegativeOffset','attributes','time','offsetExists','offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20big)\x20-\x20','\x20-\x20(','deleteObsoleteRows','Rows\x20to\x20delete\x20(','):\x20','shift','createAggregates','field','tick','rawstore','timeSeriesTick','|tick','initWindow'];(function(_0x338de3,_0x4d21c0){var _0x38a0f5=function(_0x199f67){while(--_0x199f67){_0x338de3['push'](_0x338de3['shift']());}};var _0x58c7fe=function(){var _0x466820={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x49dd48,_0x34d166,_0x31811c,_0x4d2552){_0x4d2552=_0x4d2552||{};var _0x483719=_0x34d166+'='+_0x31811c;var _0x5411be=0x0;for(var _0x5411be=0x0,_0x20d531=_0x49dd48['length'];_0x5411be<_0x20d531;_0x5411be++){var _0x2083a9=_0x49dd48[_0x5411be];_0x483719+=';\x20'+_0x2083a9;var _0xd36083=_0x49dd48[_0x2083a9];_0x49dd48['push'](_0xd36083);_0x20d531=_0x49dd48['length'];if(_0xd36083!==!![]){_0x483719+='='+_0xd36083;}}_0x4d2552['cookie']=_0x483719;},'removeCookie':function(){return'dev';},'getCookie':function(_0x1677b3,_0x5cdc1f){_0x1677b3=_0x1677b3||function(_0x558495){return _0x558495;};var _0x337e2c=_0x1677b3(new RegExp('(?:^|;\x20)'+_0x5cdc1f['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x247bb4=function(_0x5bb524,_0x585726){_0x5bb524(++_0x585726);};_0x247bb4(_0x38a0f5,_0x4d21c0);return _0x337e2c?decodeURIComponent(_0x337e2c[0x1]):undefined;}};var _0x4cdadc=function(){var _0x3b1371=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x3b1371['test'](_0x466820['removeCookie']['toString']());};_0x466820['updateCookie']=_0x4cdadc;var _0x3b6db6='';var _0x452f9c=_0x466820['updateCookie']();if(!_0x452f9c){_0x466820['setCookie'](['*'],'counter',0x1);}else if(_0x452f9c){_0x3b6db6=_0x466820['getCookie'](null,'counter');}else{_0x466820['removeCookie']();}};_0x58c7fe();}(_0x17f4,0xd8));var _0x56f2=function(_0x284889,_0x599787){_0x284889=_0x284889-0x0;var _0x1a6d69=_0x17f4[_0x284889];return _0x1a6d69;};var _0x34a5df=function(){var _0x10b5c2=!![];return function(_0x424753,_0x409b15){var _0xae8d98=_0x10b5c2?function(){if(_0x409b15){var _0x46547e=_0x409b15['apply'](_0x424753,arguments);_0x409b15=null;return _0x46547e;}}:function(){};_0x10b5c2=![];return _0xae8d98;};}();var _0x4716e1=_0x34a5df(this,function(){var _0x39dfee=function(){return'\x64\x65\x76';},_0x189ae3=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x32ae58=function(){var _0x492ee5=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x492ee5['\x74\x65\x73\x74'](_0x39dfee['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x3b34cb=function(){var _0x5482f0=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x5482f0['\x74\x65\x73\x74'](_0x189ae3['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x507c67=function(_0x19fdd4){var _0x3b92e0=~-0x1>>0x1+0xff%0x0;if(_0x19fdd4['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x3b92e0)){_0x484680(_0x19fdd4);}};var _0x484680=function(_0xbce521){var _0x18286c=~-0x4>>0x1+0xff%0x0;if(_0xbce521['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x18286c){_0x507c67(_0xbce521);}};if(!_0x32ae58()){if(!_0x3b34cb()){_0x507c67('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x507c67('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x507c67('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x4716e1();const {KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require(_0x56f2('0x0'));class streamingNode{constructor(_0x377eb4,_0x3951a6,_0x378510,_0x3734a5,_0x413065,_0x2f8b47,_0x30e0e9){this[_0x56f2('0x1')]=_0x377eb4;this[_0x56f2('0x2')]={};this[_0x56f2('0x3')]=_0x378510['master'];this[_0x56f2('0x4')]=JSON['parse'](JSON[_0x56f2('0x5')](_0x378510));this['connectionConfig']=JSON['parse'](JSON[_0x56f2('0x5')](_0x3951a6));this['topic']=_0x56f2('0x6')+this[_0x56f2('0x4')][_0x56f2('0x7')];this[_0x56f2('0x8')]=_0x2f8b47;this[_0x56f2('0x9')]=_0x413065;this[_0x56f2('0xa')]=_0x30e0e9;this[_0x56f2('0xb')]=_0x378510[_0x56f2('0xb')];this[_0x56f2('0xc')]=_0x378510[_0x56f2('0x7')];this[_0x56f2('0xd')]=[];this[_0x56f2('0xe')]=0x0;}[_0x56f2('0xf')](){let _0xedb420=this;if(this['parent']!=null){if(this[_0x56f2('0xa')][_0x56f2('0x4')][_0x56f2('0x10')][_0x56f2('0x11')]=='kafka'){this[_0x56f2('0x12')]=new KafkaNodeBroker(this[_0x56f2('0x13')],this[_0x56f2('0x14')],_0x56f2('0x15')+this[_0x56f2('0xa')]['fusion_id']+this['nodeId']);this[_0x56f2('0x12')][_0x56f2('0x16')](_0xedb420[_0x56f2('0x17')][_0x56f2('0x18')](_0xedb420));}else if(this[_0x56f2('0xa')][_0x56f2('0x4')]['connection']['type']==_0x56f2('0x19')){this[_0x56f2('0x12')]=new MQTTBroker(this[_0x56f2('0x13')],this[_0x56f2('0x14')],'client'+this[_0x56f2('0xa')][_0x56f2('0x1a')]+this[_0x56f2('0xc')]);this['broker'][_0x56f2('0x16')](_0xedb420[_0x56f2('0x17')][_0x56f2('0x18')](_0xedb420));}else{console[_0x56f2('0x1b')]('PROBLEM:\x20No\x20connection\x20(OK\x20for\x20tests)!');}}else{console[_0x56f2('0x1b')]('PROBLEM:\x20No\x20parent\x20defined.\x20No\x20connection\x20(OK\x20for\x20tests).');}}[_0x56f2('0x1c')](){return this[_0x56f2('0x3')];}[_0x56f2('0x1d')](){console['log']('Connecting\x20to\x20Kafka:\x20'+this[_0x56f2('0x14')]);this[_0x56f2('0x1e')]=kafka['Consumer'];this[_0x56f2('0x15')]=new kafka[(_0x56f2('0x1f'))](this[_0x56f2('0x13')][_0x56f2('0x20')],this['id']);this[_0x56f2('0x21')]=new kafka[(_0x56f2('0x22'))](this[_0x56f2('0x15')]);let _0x1e1f01=this;this['consumer']=new this['Consumer'](this[_0x56f2('0x15')],[{'topic':this[_0x56f2('0x14')],'partition':0x0}],{'groupId':this['id']});this[_0x56f2('0x23')]['on'](_0x56f2('0x24'),function(_0x16708b){try{console[_0x56f2('0x1b')](_0x56f2('0x25'));let _0x31a0cf=JSON['parse'](_0x16708b[_0x56f2('0x26')]);_0x1e1f01[_0x56f2('0x17')](_0x31a0cf);}catch(_0x563397){console['log'](_0x56f2('0x27'),_0x563397);}});this[_0x56f2('0x23')]['on'](_0x56f2('0x28'),function(_0x536afa){console[_0x56f2('0x1b')](_0x56f2('0x29'),_0x536afa);});this[_0x56f2('0x23')]['on'](_0x56f2('0x2a'),function(_0x2c8c4a){console[_0x56f2('0x1b')](_0x1e1f01['id'],_0x56f2('0x2b'),_0x2c8c4a);_0x2c8c4a['maxNum']=0x2;_0x1e1f01['offset']['fetch']([_0x2c8c4a],function(_0xefbe53,_0x5a4fe5){if(_0xefbe53){return console[_0x56f2('0x28')](_0xefbe53);}var _0x379eb5=Math['min'](_0x5a4fe5[_0x2c8c4a['topic']][_0x2c8c4a[_0x56f2('0x2c')]]);console[_0x56f2('0x1b')](_0x1e1f01);_0x1e1f01[_0x56f2('0x23')][_0x56f2('0x2d')](_0x2c8c4a[_0x56f2('0x14')],_0x2c8c4a[_0x56f2('0x2c')],_0x379eb5);});});}['broadcastAggregates'](_0x30e09c){}[_0x56f2('0x2e')](){this[_0x56f2('0xe')]=this[_0x56f2('0xd')][_0x56f2('0x2f')]-0x1;}[_0x56f2('0x30')](){return this['buffer'][this['position']][_0x56f2('0x31')];}['setSlaveOffset'](_0x1414b3){if(this[_0x56f2('0xd')]['length']==0x0){console[_0x56f2('0x1b')](_0x56f2('0x32')+this['nodeId']);return![];}let _0x5f34a3=this[_0x56f2('0xd')][_0x56f2('0x2f')]-0x1;let _0x3f38a5=this[_0x56f2('0xd')][_0x5f34a3][_0x56f2('0x31')];let _0x54044c=(_0x3f38a5-_0x1414b3)/this['fusionTick'];console[_0x56f2('0x1b')](_0x56f2('0x33'),this[_0x56f2('0xb')],_0x56f2('0x34'),_0x54044c);let _0x5dc715=_0x5f34a3-_0x54044c;if(_0x5dc715<0x0){console['log'](_0x56f2('0x35')+this[_0x56f2('0xc')]+'('+_0x5dc715+'/'+_0x5f34a3+')@'+this['parent'][_0x56f2('0x1a')]);return![];}else if(_0x5dc715>_0x5f34a3){console['log'](_0x56f2('0x36')+this[_0x56f2('0xc')]+'('+_0x5dc715+'/'+_0x5f34a3+')@'+this['parent'][_0x56f2('0x1a')]);return![];}else if(_0x5dc715!=Math[_0x56f2('0x37')](_0x5dc715)){console['log']('setSlaveOffset:\x20zeroIndex\x20is\x20not\x20a\x20whole\x20number\x20-\x20'+_0x5dc715);}console[_0x56f2('0x1b')](_0x5dc715);if(this['buffer'][_0x5dc715][_0x56f2('0x31')]!=_0x1414b3){console['log'](_0x56f2('0x38'));console['log'](_0x56f2('0x39')+this[_0x56f2('0xc')]);console[_0x56f2('0x1b')]('\x0aZero\x20index,\x20last\x20offset:\x20'+_0x5dc715+',\x20'+_0x5f34a3);console[_0x56f2('0x1b')]('\x0aDifference\x20(buffer\x20-\x20zero):\x20'+this[_0x56f2('0xd')][_0x5dc715][_0x56f2('0x31')]+_0x56f2('0x3a')+_0x1414b3);console['log'](_0x56f2('0x3b'));}this['position']=_0x5dc715;return!![];}[_0x56f2('0x3c')](){let _0x338cc5=!![];this[_0x56f2('0x3d')]=0x0;for(let _0x41d55f in this[_0x56f2('0x4')][_0x56f2('0x3e')]){let _0x20225a=this[_0x56f2('0x4')][_0x56f2('0x3e')][_0x41d55f][_0x56f2('0x3f')];if(_0x20225a<this['maxNegativeOffset'])this[_0x56f2('0x3d')]=_0x20225a;if(!this[_0x56f2('0x40')](_0x20225a))_0x338cc5=![];}return _0x338cc5;}[_0x56f2('0x40')](_0x47f182){let _0x558354=this[_0x56f2('0xe')]+_0x47f182;let _0x3f916d=this['buffer'][_0x56f2('0x2f')]-0x1;if(_0x558354<0x0){console[_0x56f2('0x1b')]('offsetExists:\x20index\x20does\x20not\x20exist\x20(too\x20small)\x20-\x20'+this[_0x56f2('0xc')]+'\x20-\x20('+_0x558354+')');return![];}else if(_0x558354>_0x3f916d){console[_0x56f2('0x1b')](_0x56f2('0x41')+this[_0x56f2('0xc')]+this[_0x56f2('0xc')]+_0x56f2('0x42')+_0x558354+'/'+_0x3f916d+')');return![];}return!![];}[_0x56f2('0x43')](){let _0x545cff=this['position']+this[_0x56f2('0x3d')]-0x5;console[_0x56f2('0x1b')](_0x56f2('0x44')+this[_0x56f2('0xc')]+',\x20'+this[_0x56f2('0xa')][_0x56f2('0x1a')]+_0x56f2('0x45')+_0x545cff+'\x20/\x20'+this[_0x56f2('0xd')][_0x56f2('0x2f')]);for(let _0x1e857a=0x1;_0x1e857a<_0x545cff;_0x1e857a++)this[_0x56f2('0xd')][_0x56f2('0x46')]();}[_0x56f2('0x47')](_0x43578c){for(let _0x4e2698 in _0x43578c){let _0x4aaf49=_0x43578c[_0x4e2698];let _0x2c3c67=_0x4aaf49[_0x56f2('0x48')];let _0xe3578d=_0x4aaf49[_0x56f2('0x49')];let _0x519824=this[_0x56f2('0x4a')]['addStreamAggr']({'type':_0x56f2('0x4b'),'timestamp':'Time','value':_0x2c3c67});let _0x5f1462=_0x2c3c67+_0x56f2('0x4c');this['aggregate'][_0x5f1462]=_0x519824;for(let _0x3a247b in _0xe3578d){let _0x167c16=_0xe3578d[_0x3a247b];let _0x5abebc=_0x167c16[_0x56f2('0x11')];if(_0x5abebc=='ema'){let _0x113c49=_0x167c16['interval'];let _0x33c9a3=_0x167c16[_0x56f2('0x4d')];let _0x519824=this[_0x56f2('0x4a')][_0x56f2('0x4e')]({'type':'ema','inAggr':this[_0x56f2('0x2')][_0x5f1462],'emaType':_0x56f2('0x4f'),'interval':_0x113c49,'initWindow':_0x33c9a3});let _0x3b507e=_0x2c3c67+'|ema|'+_0x113c49;this[_0x56f2('0x2')][_0x3b507e]=_0x519824;}else if(_0x5abebc==_0x56f2('0x50')){let _0x16b0d1=_0x167c16[_0x56f2('0x51')];let _0x519824=this['rawstore'][_0x56f2('0x4e')]({'type':_0x56f2('0x52'),'inAggr':this[_0x56f2('0x2')][_0x5f1462],'winsize':_0x16b0d1});let _0x59ce7c=_0x2c3c67+_0x56f2('0x53')+_0x16b0d1;this[_0x56f2('0x2')][_0x59ce7c]=_0x519824;let _0x1d6ee0=_0x167c16[_0x56f2('0x54')];for(var _0x4a6fb1 in _0x1d6ee0){let _0x1520ea=_0x1d6ee0[_0x4a6fb1];let _0x598db5=_0x1520ea[_0x56f2('0x11')];if(_0x598db5=='variance'){let _0x519824=this[_0x56f2('0x4a')][_0x56f2('0x4e')]({'type':'variance','inAggr':this[_0x56f2('0x2')][_0x59ce7c]});let _0x170455=_0x2c3c67+'|variance|'+_0x16b0d1;this[_0x56f2('0x2')][_0x170455]=_0x519824;}else if(_0x598db5=='ma'){let _0x519824=this[_0x56f2('0x4a')][_0x56f2('0x4e')]({'type':'ma','inAggr':this['aggregate'][_0x59ce7c]});let _0x3d79b4=_0x2c3c67+'|ma|'+_0x16b0d1;this[_0x56f2('0x2')][_0x3d79b4]=_0x519824;}else if(_0x598db5==_0x56f2('0x55')){let _0x519824=this[_0x56f2('0x4a')]['addStreamAggr']({'type':_0x56f2('0x56'),'inAggr':this[_0x56f2('0x2')][_0x59ce7c]});let _0x576c9b=_0x2c3c67+_0x56f2('0x57')+_0x16b0d1;this[_0x56f2('0x2')][_0x576c9b]=_0x519824;}else if(_0x598db5=='max'){let _0x519824=this[_0x56f2('0x4a')]['addStreamAggr']({'type':_0x56f2('0x58'),'inAggr':this[_0x56f2('0x2')][_0x59ce7c]});let _0x538846=_0x2c3c67+'|max|'+_0x16b0d1;this['aggregate'][_0x538846]=_0x519824;}}}}}}[_0x56f2('0x59')](){var _0x44e8f9={};for(let _0x1d022b in this['aggregate']){if(!(_0x1d022b[_0x56f2('0x5a')]('tick')>0x0||_0x1d022b[_0x56f2('0x5a')](_0x56f2('0x50'))>0x0)){_0x44e8f9[_0x1d022b]=this[_0x56f2('0x2')][_0x1d022b][_0x56f2('0x5b')]();_0x44e8f9['stampm']=this['aggregate'][_0x1d022b][_0x56f2('0x5c')]();};};return _0x44e8f9;}['getPartialFeatureVector'](){let _0x3fcb05=[];for(let _0x3f6cac in this[_0x56f2('0x4')][_0x56f2('0x3e')]){let _0x2a4055=this[_0x56f2('0xe')];let _0xbe2b60=this[_0x56f2('0xd')][_0x2a4055][_0x56f2('0x31')];let _0x1e7bcb=this[_0x56f2('0x4')][_0x56f2('0x3e')][_0x3f6cac]['attributes'];let _0xdcdffe=this[_0x56f2('0x4')]['attributes'][_0x3f6cac][_0x56f2('0x3f')];_0x2a4055=_0x2a4055+_0xdcdffe;let _0x57397c=_0xbe2b60+_0xdcdffe*this['fusionTick'];let _0x175bda=this['buffer'][_0x2a4055]['stampm'];if(_0x57397c!=_0x175bda){while(_0x175bda-_0x57397c<0x0){_0x2a4055++;_0x175bda=this['buffer'][_0x2a4055]['stampm'];}if(_0x175bda!=_0x57397c)_0x2a4055--;}for(let _0x31334d in _0x1e7bcb){let _0x4db5f7=_0x1e7bcb[_0x31334d]['type'];let _0x98dc73=_0x1e7bcb[_0x31334d][_0x56f2('0x5d')];if(_0x4db5f7==_0x56f2('0x26')){let _0x2c4745=this[_0x56f2('0xd')][_0x2a4055][_0x98dc73];_0x3fcb05[_0x56f2('0x5e')](_0x2c4745);}else if(_0x4db5f7==_0x56f2('0x5f')){let _0x17491b=_0x2a4055-_0x1e7bcb[_0x31334d][_0x56f2('0x60')];let _0x796f32=this[_0x56f2('0xd')][_0x17491b][_0x98dc73]-this[_0x56f2('0xd')][_0x2a4055][_0x98dc73];_0x3fcb05[_0x56f2('0x5e')](_0x796f32);}}}return _0x3fcb05;}}module[_0x56f2('0x61')]=streamingNode;