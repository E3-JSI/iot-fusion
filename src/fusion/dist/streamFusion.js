var _0xa1b8=['./db','existsSync','dbPath','mkdirSync','base','Base','createClean','nodes','master','type','airquality','trafficcounter','smartlamp','timevalue','push','processRecordHook','substation','energy','train','static','weather','log','ERROR:\x20Streaming\x20node\x20type\x20not\x20found!','length','model','streamModel','predictions_','connection','kafka','broker','addPublisher','mqtt','buffer','isMaster','setMasterOffset','getOffsetTimestamp','setSlaveOffset','buildFeatureVector','broadcastPrediction','lastTimestamp','cleanupData','Can\x20not\x20be\x20generated!','getPartialFeatureVector','concat','broadcastFeatureVector','./data/','.json','publish','save','exports','qminer','./nodes/streamingNode.js','./nodes/streamingEnergyNode.js','./nodes/streamingTrainNode.js','./nodes/streamingTimeValueNode.js','./nodes/streamingSmartLampNode.js','./nodes/streamingAirQualityNode.js','./nodes/streamingWeatherNode.js','./nodes/streamingStaticNode.js','./common/brokers/brokers.js','config','parse','stringify','connectionConfig','masterNodeId','masterSatisfied','lastFeatureVector','allNodesAvailable','fusion_id','fusionModel','topic','fusionTick','./db/'];(function(_0x42b624,_0x191a2f){var _0x352d7c=function(_0x225f98){while(--_0x225f98){_0x42b624['push'](_0x42b624['shift']());}};var _0x5098cd=function(){var _0x15b541={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x5dd8d4,_0x3e66ac,_0x5f1003,_0x51f1ec){_0x51f1ec=_0x51f1ec||{};var _0x4c253c=_0x3e66ac+'='+_0x5f1003;var _0x202226=0x0;for(var _0x202226=0x0,_0x2f1763=_0x5dd8d4['length'];_0x202226<_0x2f1763;_0x202226++){var _0x20a54d=_0x5dd8d4[_0x202226];_0x4c253c+=';\x20'+_0x20a54d;var _0x32c6a6=_0x5dd8d4[_0x20a54d];_0x5dd8d4['push'](_0x32c6a6);_0x2f1763=_0x5dd8d4['length'];if(_0x32c6a6!==!![]){_0x4c253c+='='+_0x32c6a6;}}_0x51f1ec['cookie']=_0x4c253c;},'removeCookie':function(){return'dev';},'getCookie':function(_0x3010ac,_0x28dd8c){_0x3010ac=_0x3010ac||function(_0x229dfb){return _0x229dfb;};var _0x1c426c=_0x3010ac(new RegExp('(?:^|;\x20)'+_0x28dd8c['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x574075=function(_0xccf38d,_0x5e6ba4){_0xccf38d(++_0x5e6ba4);};_0x574075(_0x352d7c,_0x191a2f);return _0x1c426c?decodeURIComponent(_0x1c426c[0x1]):undefined;}};var _0x16ee8f=function(){var _0x56861f=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x56861f['test'](_0x15b541['removeCookie']['toString']());};_0x15b541['updateCookie']=_0x16ee8f;var _0x2ad015='';var _0x10190f=_0x15b541['updateCookie']();if(!_0x10190f){_0x15b541['setCookie'](['*'],'counter',0x1);}else if(_0x10190f){_0x2ad015=_0x15b541['getCookie'](null,'counter');}else{_0x15b541['removeCookie']();}};_0x5098cd();}(_0xa1b8,0x19f));var _0x29e5=function(_0x55fcb5,_0x2c9638){_0x55fcb5=_0x55fcb5-0x0;var _0x5126a9=_0xa1b8[_0x55fcb5];return _0x5126a9;};var _0x329cae=function(){var _0x2f3e31=!![];return function(_0x3a89c9,_0x2c6db2){var _0x1fa352=_0x2f3e31?function(){if(_0x2c6db2){var _0x24649a=_0x2c6db2['apply'](_0x3a89c9,arguments);_0x2c6db2=null;return _0x24649a;}}:function(){};_0x2f3e31=![];return _0x1fa352;};}();var _0x59656d=_0x329cae(this,function(){var _0x17a6b5=function(){return'\x64\x65\x76';},_0x1eb248=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x2f9c46=function(){var _0x595d8c=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x595d8c['\x74\x65\x73\x74'](_0x17a6b5['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x2d6c1d=function(){var _0x115553=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x115553['\x74\x65\x73\x74'](_0x1eb248['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xa116d2=function(_0x364c8b){var _0x5c8e12=~-0x1>>0x1+0xff%0x0;if(_0x364c8b['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x5c8e12)){_0x388728(_0x364c8b);}};var _0x388728=function(_0x1f7683){var _0x38a4da=~-0x4>>0x1+0xff%0x0;if(_0x1f7683['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x38a4da){_0xa116d2(_0x1f7683);}};if(!_0x2f9c46()){if(!_0x2d6c1d()){_0xa116d2('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0xa116d2('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0xa116d2('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x59656d();const qm=require(_0x29e5('0x0'));const fs=require('fs');const streamingNode=require(_0x29e5('0x1'));const streamingEnergyNode=require(_0x29e5('0x2'));const streamingSubstationNode=require('./nodes/streamingSubstationNode.js');const streamingTrainNode=require(_0x29e5('0x3'));const streamingTimeValueNode=require(_0x29e5('0x4'));const streamingSmartLampNode=require(_0x29e5('0x5'));const streamingTrafficCounterNode=require('./nodes/streamingTrafficCounterNode.js');const streamingAirQualityNode=require(_0x29e5('0x6'));const streamingWeatherNode=require(_0x29e5('0x7'));const streamingStaticNode=require(_0x29e5('0x8'));const streamModel=require('./streamModel.js');const {AbstractBroker,KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require(_0x29e5('0x9'));class streamFusion{constructor(_0x26c6a0,_0x3f6969,_0x331a2c){let _0x39b786=this;this[_0x29e5('0xa')]=JSON[_0x29e5('0xb')](JSON[_0x29e5('0xc')](_0x3f6969));this[_0x29e5('0xd')]=JSON[_0x29e5('0xb')](JSON['stringify'](_0x26c6a0));this['nodes']=[];this[_0x29e5('0xe')]=-0x1;this[_0x29e5('0xf')]=!![];this['lastTimestamp']=0x0;this[_0x29e5('0x10')]=[];this[_0x29e5('0x11')]=![];this[_0x29e5('0x12')]=_0x3f6969[_0x29e5('0x13')];this[_0x29e5('0x14')]='features_'+this[_0x29e5('0x12')];this[_0x29e5('0x15')]=_0x3f6969[_0x29e5('0x15')];this['dbPath']=_0x29e5('0x16')+this['fusion_id'];if(!fs['existsSync'](_0x29e5('0x17'))){fs['mkdirSync'](_0x29e5('0x17'));}if(!fs[_0x29e5('0x18')](this[_0x29e5('0x19')])){fs[_0x29e5('0x1a')](this[_0x29e5('0x19')]);}this[_0x29e5('0x1b')]=new qm[(_0x29e5('0x1c'))]({'dbPath':this[_0x29e5('0x19')],'mode':_0x29e5('0x1d')});for(let _0x53a8f0 in _0x3f6969['nodes']){let _0x1af673=_0x3f6969[_0x29e5('0x1e')][_0x53a8f0];_0x1af673[_0x29e5('0x15')]=this['fusionTick'];if(_0x1af673[_0x29e5('0x1f')]==!![])this['masterNodeId']=_0x53a8f0;if(_0x1af673[_0x29e5('0x20')]==_0x29e5('0x21')){this[_0x29e5('0x1e')]['push'](new streamingAirQualityNode(this[_0x29e5('0x1b')],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786['processRecordHook'],_0x53a8f0,_0x39b786));}else if(_0x1af673['type']==_0x29e5('0x22')){this[_0x29e5('0x1e')]['push'](new streamingTrafficCounterNode(this['base'],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786['processRecordHook'],_0x53a8f0,_0x39b786));}else if(_0x1af673[_0x29e5('0x20')]==_0x29e5('0x23')){this[_0x29e5('0x1e')]['push'](new streamingSmartLampNode(this[_0x29e5('0x1b')],this['connectionConfig'],_0x1af673,_0x331a2c,_0x39b786['processRecordHook'],_0x53a8f0,_0x39b786));}else if(_0x1af673[_0x29e5('0x20')]==_0x29e5('0x24')){this[_0x29e5('0x1e')][_0x29e5('0x25')](new streamingTimeValueNode(this['base'],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786[_0x29e5('0x26')],_0x53a8f0,_0x39b786));}else if(_0x1af673['type']==_0x29e5('0x27')){this['nodes']['push'](new streamingSubstationNode(this['base'],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786[_0x29e5('0x26')],_0x53a8f0,_0x39b786));}else if(_0x1af673[_0x29e5('0x20')]==_0x29e5('0x28')){this[_0x29e5('0x1e')][_0x29e5('0x25')](new streamingEnergyNode(this[_0x29e5('0x1b')],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786['processRecordHook'],_0x53a8f0,_0x39b786));}else if(_0x1af673[_0x29e5('0x20')]==_0x29e5('0x29')){this[_0x29e5('0x1e')]['push'](new streamingTrainNode(this['base'],this[_0x29e5('0xd')],_0x1af673,_0x331a2c,_0x39b786[_0x29e5('0x26')],_0x53a8f0,_0x39b786));}else if(_0x1af673['type']==_0x29e5('0x2a')){this[_0x29e5('0x1e')]['push'](new streamingStaticNode(this[_0x29e5('0x1b')],this['connectionConfig'],_0x1af673,_0x331a2c,_0x39b786[_0x29e5('0x26')],_0x53a8f0,_0x39b786));}else if(_0x1af673['type']==_0x29e5('0x2b')){this['nodes'][_0x29e5('0x25')](new streamingWeatherNode(this['base'],this['connectionConfig'],_0x1af673,_0x331a2c,_0x39b786['processRecordHook'],_0x53a8f0,_0x39b786));}else{console[_0x29e5('0x2c')](_0x29e5('0x2d'));}}console[_0x29e5('0x2c')]('Created\x20'+this[_0x29e5('0x1e')][_0x29e5('0x2e')]+'\x20nodes.');if(_0x29e5('0x2f')in _0x3f6969){this[_0x29e5('0x30')]=new streamModel(_0x3f6969,_0x39b786);this[_0x29e5('0x14')]=_0x29e5('0x31')+this['fusion_id'];}if('connection'in _0x3f6969){if(_0x3f6969[_0x29e5('0x32')][_0x29e5('0x20')]==_0x29e5('0x33')){this[_0x29e5('0x34')]=new KafkaNodeBroker(this['connectionConfig'],this[_0x29e5('0x14')],this[_0x29e5('0x12')]);this[_0x29e5('0x34')][_0x29e5('0x35')]();}else if(_0x3f6969[_0x29e5('0x32')]['type']==_0x29e5('0x36')){this[_0x29e5('0x34')]=new MQTTBroker(this[_0x29e5('0xd')],this[_0x29e5('0x14')],this['fusion_id']);this['broker'][_0x29e5('0x35')]();}else{this[_0x29e5('0x34')]=new AbstractBroker(this['connectionConfig'],this[_0x29e5('0x14')],this[_0x29e5('0x12')]);}}}[_0x29e5('0x26')](_0x5c08b9,_0x4b3859){if(!_0x4b3859[_0x29e5('0x11')]){for(let _0xbc0710 in _0x4b3859[_0x29e5('0x1e')]){if(_0x4b3859[_0x29e5('0x1e')][_0xbc0710]['buffer'][_0x29e5('0x2e')]==0x0){return null;}}_0x4b3859['allNodesAvailable']=!![];}if(_0x4b3859[_0x29e5('0x1e')][_0x4b3859[_0x29e5('0xe')]][_0x29e5('0x37')][_0x29e5('0x2e')]>0x0&&_0x4b3859[_0x29e5('0xf')]==![]){_0x5c08b9=_0x4b3859['masterNodeId'];};if(_0x4b3859[_0x29e5('0x1e')][_0x5c08b9][_0x29e5('0x38')]()==!![]){_0x4b3859[_0x29e5('0x1e')][_0x5c08b9][_0x29e5('0x39')]();let _0x3469a2=_0x4b3859[_0x29e5('0x1e')][_0x5c08b9][_0x29e5('0x3a')]();let _0x4faaa3=!![];for(let _0x1c8d8a in _0x4b3859[_0x29e5('0x1e')]){if(_0x1c8d8a!=_0x5c08b9){if(_0x4b3859[_0x29e5('0x1e')][_0x1c8d8a][_0x29e5('0x3b')](_0x3469a2)){if(!_0x4b3859[_0x29e5('0x1e')][_0x1c8d8a]['checkDataAvailability']()){_0x4faaa3=![];}}else{_0x4faaa3=![];}}}if(_0x4faaa3&&_0x4b3859['lastTimestamp']!=_0x3469a2){_0x4b3859[_0x29e5('0xf')]=!![];let _0x219bcc=_0x4b3859[_0x29e5('0x3c')]();if(_0x29e5('0x2f')in _0x4b3859[_0x29e5('0xa')]){let _0x276fd5;if(_0x219bcc['length']!=0x0){_0x276fd5=_0x4b3859['streamModel']['updateStream'](_0x219bcc,_0x3469a2);_0x4b3859[_0x29e5('0x3d')](_0x276fd5[0x0],_0x276fd5[0x1],_0x276fd5[0x2]);}}else{_0x4b3859['broadcastFeatureVector'](_0x3469a2,_0x219bcc);}_0x4b3859[_0x29e5('0x3e')]=_0x3469a2;_0x4b3859[_0x29e5('0x10')]=_0x219bcc;_0x4b3859[_0x29e5('0x3f')]();}else{console[_0x29e5('0x2c')]('Data\x20not\x20available.');_0x4b3859['masterSatisfied']=![];}}else{if(!_0x4b3859[_0x29e5('0xf')]){}}}[_0x29e5('0x3c')](){let _0x1d63b9=[];for(let _0x5f5d3a in this[_0x29e5('0x1e')]){let _0x5f35fa=this[_0x29e5('0x1e')][_0x5f5d3a]['checkDataAvailability']();if(_0x5f35fa==![]){console[_0x29e5('0x2c')](_0x29e5('0x40'));return[];}let _0x1006fb=this['nodes'][_0x5f5d3a][_0x29e5('0x41')]();_0x1d63b9=_0x1d63b9[_0x29e5('0x42')](_0x1006fb);}return _0x1d63b9;}[_0x29e5('0x43')](_0x48c694,_0x58ff3a){let _0x4dd7f5=JSON[_0x29e5('0xc')]({'timestamp':_0x48c694,'ftr_vector':_0x58ff3a});if(_0x58ff3a!=[])fs['appendFileSync'](_0x29e5('0x44')+this['fusion_id']+_0x29e5('0x45'),_0x4dd7f5+'\x0a');this[_0x29e5('0x34')][_0x29e5('0x46')](_0x4dd7f5);}[_0x29e5('0x3d')](_0xede3d8,_0x56732f,_0x198173){let _0x512f60={'timestamp':_0xede3d8,'value':_0x56732f,'horizon':_0x198173};this['broker'][_0x29e5('0x46')](_0x512f60);}[_0x29e5('0x3f')](){for(let _0x575f79 in this[_0x29e5('0x1e')]){this[_0x29e5('0x1e')][_0x575f79]['deleteObsoleteRows']();}}[_0x29e5('0x47')](){}}module[_0x29e5('0x48')]=streamFusion;