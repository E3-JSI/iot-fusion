var _0x5bce=['buffer','masterNodeId','masterSatisfied','isMaster','setMasterOffset','getOffsetTimestamp','setSlaveOffset','checkDataAvailability','updateStream','broadcastPrediction','broadcastFeatureVector','log','Data\x20not\x20available.','Can\x20not\x20be\x20generated!','appendFileSync','./data/','.json','publish','cleanupData','deleteObsoleteRows','save','qminer','./nodes/streamingNode.js','./nodes/streamingEnergyNode.js','./nodes/streamingSubstationNode.js','./nodes/streamingTrainNode.js','./nodes/streamingSmartLampNode.js','./nodes/streamingTrafficCounterNode.js','./nodes/streamingAirQualityNode.js','./nodes/streamingWeatherNode.js','./streamModel.js','./common/brokers/brokers.js','config','parse','stringify','connectionConfig','nodes','lastTimestamp','lastFeatureVector','allNodesAvailable','fusion_id','fusionModel','topic','features_','fusionTick','dbPath','existsSync','mkdirSync','./db','Base','createClean','master','type','airquality','push','base','processRecordHook','trafficcounter','timevalue','energy','train','static','weather','ERROR:\x20Streaming\x20node\x20type\x20not\x20found!','Created\x20','length','streamModel','connection','kafka','broker','addPublisher','mqtt'];(function(_0x32716c,_0x2a845b){var _0x2ff143=function(_0x342522){while(--_0x342522){_0x32716c['push'](_0x32716c['shift']());}};var _0x102762=function(){var _0x9d2458={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x3bb439,_0x4b83b6,_0xed42f9,_0x25d6f7){_0x25d6f7=_0x25d6f7||{};var _0x2b8aa9=_0x4b83b6+'='+_0xed42f9;var _0x4ca757=0x0;for(var _0x4ca757=0x0,_0x3dc8fb=_0x3bb439['length'];_0x4ca757<_0x3dc8fb;_0x4ca757++){var _0x4a88c1=_0x3bb439[_0x4ca757];_0x2b8aa9+=';\x20'+_0x4a88c1;var _0x3a6cc3=_0x3bb439[_0x4a88c1];_0x3bb439['push'](_0x3a6cc3);_0x3dc8fb=_0x3bb439['length'];if(_0x3a6cc3!==!![]){_0x2b8aa9+='='+_0x3a6cc3;}}_0x25d6f7['cookie']=_0x2b8aa9;},'removeCookie':function(){return'dev';},'getCookie':function(_0x29aa8b,_0x44ce30){_0x29aa8b=_0x29aa8b||function(_0x1de486){return _0x1de486;};var _0x227171=_0x29aa8b(new RegExp('(?:^|;\x20)'+_0x44ce30['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x23d735=function(_0x170c06,_0x1727a0){_0x170c06(++_0x1727a0);};_0x23d735(_0x2ff143,_0x2a845b);return _0x227171?decodeURIComponent(_0x227171[0x1]):undefined;}};var _0x1d493e=function(){var _0xf61a22=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0xf61a22['test'](_0x9d2458['removeCookie']['toString']());};_0x9d2458['updateCookie']=_0x1d493e;var _0x4e8a4a='';var _0x1427b4=_0x9d2458['updateCookie']();if(!_0x1427b4){_0x9d2458['setCookie'](['*'],'counter',0x1);}else if(_0x1427b4){_0x4e8a4a=_0x9d2458['getCookie'](null,'counter');}else{_0x9d2458['removeCookie']();}};_0x102762();}(_0x5bce,0x135));var _0x14c9=function(_0x5629b7,_0x3dd9ec){_0x5629b7=_0x5629b7-0x0;var _0x1917bd=_0x5bce[_0x5629b7];return _0x1917bd;};var _0xae828b=function(){var _0x1a6e59=!![];return function(_0x707281,_0x2b7085){var _0x2375ab=_0x1a6e59?function(){if(_0x2b7085){var _0x53ed3b=_0x2b7085['apply'](_0x707281,arguments);_0x2b7085=null;return _0x53ed3b;}}:function(){};_0x1a6e59=![];return _0x2375ab;};}();var _0x494d6e=_0xae828b(this,function(){var _0x5acffa=function(){return'\x64\x65\x76';},_0x5ed9da=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x5493db=function(){var _0x12cc20=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x12cc20['\x74\x65\x73\x74'](_0x5acffa['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4c1084=function(){var _0x4350de=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x4350de['\x74\x65\x73\x74'](_0x5ed9da['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4b195c=function(_0x5b2fec){var _0x3cd42e=~-0x1>>0x1+0xff%0x0;if(_0x5b2fec['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x3cd42e)){_0x44dff5(_0x5b2fec);}};var _0x44dff5=function(_0x2c3891){var _0x177317=~-0x4>>0x1+0xff%0x0;if(_0x2c3891['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x177317){_0x4b195c(_0x2c3891);}};if(!_0x5493db()){if(!_0x4c1084()){_0x4b195c('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x4b195c('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x4b195c('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x494d6e();const qm=require(_0x14c9('0x0'));const fs=require('fs');const streamingNode=require(_0x14c9('0x1'));const streamingEnergyNode=require(_0x14c9('0x2'));const streamingSubstationNode=require(_0x14c9('0x3'));const streamingTrainNode=require(_0x14c9('0x4'));const streamingTimeValueNode=require('./nodes/streamingTimeValueNode.js');const streamingSmartLampNode=require(_0x14c9('0x5'));const streamingTrafficCounterNode=require(_0x14c9('0x6'));const streamingAirQualityNode=require(_0x14c9('0x7'));const streamingWeatherNode=require(_0x14c9('0x8'));const streamingStaticNode=require('./nodes/streamingStaticNode.js');const streamModel=require(_0x14c9('0x9'));const {AbstractBroker,KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require(_0x14c9('0xa'));class streamFusion{constructor(_0x1dc797,_0xf66e59,_0x585da1){let _0x1f4c45=this;this[_0x14c9('0xb')]=JSON[_0x14c9('0xc')](JSON[_0x14c9('0xd')](_0xf66e59));this[_0x14c9('0xe')]=JSON['parse'](JSON[_0x14c9('0xd')](_0x1dc797));this[_0x14c9('0xf')]=[];this['masterNodeId']=-0x1;this['masterSatisfied']=!![];this[_0x14c9('0x10')]=0x0;this[_0x14c9('0x11')]=[];this[_0x14c9('0x12')]=![];this[_0x14c9('0x13')]=_0xf66e59[_0x14c9('0x14')];this[_0x14c9('0x15')]=_0x14c9('0x16')+this['fusion_id'];this[_0x14c9('0x17')]=_0xf66e59[_0x14c9('0x17')];this[_0x14c9('0x18')]='./db/'+this[_0x14c9('0x13')];if(!fs[_0x14c9('0x19')]('./db')){fs[_0x14c9('0x1a')](_0x14c9('0x1b'));}if(!fs[_0x14c9('0x19')](this[_0x14c9('0x18')])){fs[_0x14c9('0x1a')](this['dbPath']);}this['base']=new qm[(_0x14c9('0x1c'))]({'dbPath':this[_0x14c9('0x18')],'mode':_0x14c9('0x1d')});for(let _0x1d6a15 in _0xf66e59[_0x14c9('0xf')]){let _0xfa285b=_0xf66e59[_0x14c9('0xf')][_0x1d6a15];_0xfa285b[_0x14c9('0x17')]=this[_0x14c9('0x17')];if(_0xfa285b[_0x14c9('0x1e')]==!![])this['masterNodeId']=_0x1d6a15;if(_0xfa285b[_0x14c9('0x1f')]==_0x14c9('0x20')){this['nodes'][_0x14c9('0x21')](new streamingAirQualityNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]==_0x14c9('0x24')){this['nodes']['push'](new streamingTrafficCounterNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]=='smartlamp'){this[_0x14c9('0xf')][_0x14c9('0x21')](new streamingSmartLampNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b['type']==_0x14c9('0x25')){this[_0x14c9('0xf')][_0x14c9('0x21')](new streamingTimeValueNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]=='substation'){this[_0x14c9('0xf')]['push'](new streamingSubstationNode(this['base'],this['connectionConfig'],_0xfa285b,_0x585da1,_0x1f4c45['processRecordHook'],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]==_0x14c9('0x26')){this[_0x14c9('0xf')][_0x14c9('0x21')](new streamingEnergyNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45['processRecordHook'],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]==_0x14c9('0x27')){this[_0x14c9('0xf')][_0x14c9('0x21')](new streamingTrainNode(this['base'],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b[_0x14c9('0x1f')]==_0x14c9('0x28')){this[_0x14c9('0xf')][_0x14c9('0x21')](new streamingStaticNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else if(_0xfa285b['type']==_0x14c9('0x29')){this['nodes']['push'](new streamingWeatherNode(this[_0x14c9('0x22')],this[_0x14c9('0xe')],_0xfa285b,_0x585da1,_0x1f4c45[_0x14c9('0x23')],_0x1d6a15,_0x1f4c45));}else{console['log'](_0x14c9('0x2a'));}}console['log'](_0x14c9('0x2b')+this[_0x14c9('0xf')][_0x14c9('0x2c')]+'\x20nodes.');if('model'in _0xf66e59){this[_0x14c9('0x2d')]=new streamModel(_0xf66e59,_0x1f4c45);this[_0x14c9('0x15')]='predictions_'+this['fusion_id'];}if(_0x14c9('0x2e')in _0xf66e59){if(_0xf66e59[_0x14c9('0x2e')][_0x14c9('0x1f')]==_0x14c9('0x2f')){this[_0x14c9('0x30')]=new KafkaNodeBroker(this[_0x14c9('0xe')],this[_0x14c9('0x15')],this[_0x14c9('0x13')]);this[_0x14c9('0x30')][_0x14c9('0x31')]();}else if(_0xf66e59['connection'][_0x14c9('0x1f')]==_0x14c9('0x32')){this['broker']=new MQTTBroker(this[_0x14c9('0xe')],this[_0x14c9('0x15')],this['fusion_id']);this['broker'][_0x14c9('0x31')]();}else{this['broker']=new AbstractBroker(this[_0x14c9('0xe')],this[_0x14c9('0x15')],this[_0x14c9('0x13')]);}}}[_0x14c9('0x23')](_0x5cc419,_0x2d3e98){if(!_0x2d3e98['allNodesAvailable']){for(let _0x227a08 in _0x2d3e98[_0x14c9('0xf')]){if(_0x2d3e98[_0x14c9('0xf')][_0x227a08][_0x14c9('0x33')]['length']==0x0){return null;}}_0x2d3e98['allNodesAvailable']=!![];}if(_0x2d3e98[_0x14c9('0xf')][_0x2d3e98[_0x14c9('0x34')]]['buffer'][_0x14c9('0x2c')]>0x0&&_0x2d3e98[_0x14c9('0x35')]==![]){_0x5cc419=_0x2d3e98[_0x14c9('0x34')];};if(_0x2d3e98['nodes'][_0x5cc419][_0x14c9('0x36')]()==!![]){_0x2d3e98[_0x14c9('0xf')][_0x5cc419][_0x14c9('0x37')]();let _0x279e74=_0x2d3e98[_0x14c9('0xf')][_0x5cc419][_0x14c9('0x38')]();let _0x380046=!![];for(let _0x1575ea in _0x2d3e98[_0x14c9('0xf')]){if(_0x1575ea!=_0x5cc419){if(_0x2d3e98[_0x14c9('0xf')][_0x1575ea][_0x14c9('0x39')](_0x279e74)){if(!_0x2d3e98[_0x14c9('0xf')][_0x1575ea][_0x14c9('0x3a')]()){_0x380046=![];}}else{_0x380046=![];}}}if(_0x380046&&_0x2d3e98['lastTimestamp']!=_0x279e74){_0x2d3e98[_0x14c9('0x35')]=!![];let _0x2b2472=_0x2d3e98['buildFeatureVector']();if('model'in _0x2d3e98[_0x14c9('0xb')]){let _0x4f1a49;if(_0x2b2472[_0x14c9('0x2c')]!=0x0){_0x4f1a49=_0x2d3e98[_0x14c9('0x2d')][_0x14c9('0x3b')](_0x2b2472,_0x279e74);_0x2d3e98[_0x14c9('0x3c')](_0x4f1a49[0x0],_0x4f1a49[0x1],_0x4f1a49[0x2]);}}else{_0x2d3e98[_0x14c9('0x3d')](_0x279e74,_0x2b2472);}_0x2d3e98[_0x14c9('0x10')]=_0x279e74;_0x2d3e98[_0x14c9('0x11')]=_0x2b2472;_0x2d3e98['cleanupData']();}else{console[_0x14c9('0x3e')](_0x14c9('0x3f'));_0x2d3e98[_0x14c9('0x35')]=![];}}else{if(!_0x2d3e98[_0x14c9('0x35')]){}}}['buildFeatureVector'](){let _0x424c27=[];for(let _0x1f4a82 in this[_0x14c9('0xf')]){let _0x2c47cc=this['nodes'][_0x1f4a82][_0x14c9('0x3a')]();if(_0x2c47cc==![]){console['log'](_0x14c9('0x40'));return[];}let _0x116b69=this[_0x14c9('0xf')][_0x1f4a82]['getPartialFeatureVector']();_0x424c27=_0x424c27['concat'](_0x116b69);}return _0x424c27;}[_0x14c9('0x3d')](_0x47c556,_0x173cc7){let _0x467866=JSON[_0x14c9('0xd')]({'timestamp':_0x47c556,'ftr_vector':_0x173cc7});if(_0x173cc7!=[])fs[_0x14c9('0x41')](_0x14c9('0x42')+this[_0x14c9('0x13')]+_0x14c9('0x43'),_0x467866+'\x0a');this[_0x14c9('0x30')][_0x14c9('0x44')](_0x467866);}[_0x14c9('0x3c')](_0x1362ed,_0x36f9d6,_0x532180){let _0x449109={'timestamp':_0x1362ed,'value':_0x36f9d6,'horizon':_0x532180};this[_0x14c9('0x30')][_0x14c9('0x44')](_0x449109);}[_0x14c9('0x45')](){for(let _0x4f5018 in this['nodes']){this[_0x14c9('0xf')][_0x4f5018][_0x14c9('0x46')]();}}[_0x14c9('0x47')](){}}module['exports']=streamFusion;