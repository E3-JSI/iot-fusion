const a0_0x5f2e=['topic','airquality','type','log','apply','energy','model','push','./models/IncrementalLearning.js','processRecordHook','lastTimestamp','existsSync','./nodes/streamingNode.js','timevalue','constructor','nodes','buffer','connection','stringify','streamModel','connectionConfig','fusion_id','parse','./nodes/streamingEnergyNode.js','smartlamp','kafka','trafficcounter','masterSatisfied','features_','broker','^([^\x20]+(\x20+[^\x20]+)+)+[^\x20]}','buildFeatureVector','./nodes/streamingTrafficCounterNode.js','fusionTick','Can\x20not\x20be\x20generated!','substation','Created\x20','weather','length','Base','./nodes/streamingSmartLampNode.js','getOffsetTimestamp','allNodesAvailable','dbPath','base','config','./db/','master','static','./data/','horizon','appendFileSync','isMaster','addPublisher','checkDataAvailability','publish','./nodes/streamingTrainNode.js','./common/brokers/brokers.js','\x20nodes.','./db','mkdirSync','masterNodeId','.json','getPartialFeatureVector','updateStream','broadcastPrediction','./nodes/streamingStaticNode.js','predictions_'];(function(_0x3454ac,_0x5f2e65){const _0x33458b=function(_0x49e7be){while(--_0x49e7be){_0x3454ac['push'](_0x3454ac['shift']());}},_0x2edfaf=function(){const _0x34e121={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x4e1ae2,_0x1af96d,_0x14359e,_0x27b840){_0x27b840=_0x27b840||{};let _0x1763fe=_0x1af96d+'='+_0x14359e,_0x20e6a6=0x0;for(let _0x4f6bb1=0x0,_0x160947=_0x4e1ae2['length'];_0x4f6bb1<_0x160947;_0x4f6bb1++){const _0x34b197=_0x4e1ae2[_0x4f6bb1];_0x1763fe+=';\x20'+_0x34b197;const _0x4ada86=_0x4e1ae2[_0x34b197];_0x4e1ae2['push'](_0x4ada86),_0x160947=_0x4e1ae2['length'],_0x4ada86!==!![]&&(_0x1763fe+='='+_0x4ada86);}_0x27b840['cookie']=_0x1763fe;},'removeCookie':function(){return'dev';},'getCookie':function(_0x4d34ca,_0x65412c){_0x4d34ca=_0x4d34ca||function(_0x41f205){return _0x41f205;};const _0x34693e=_0x4d34ca(new RegExp('(?:^|;\x20)'+_0x65412c['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)')),_0x5ef850=function(_0x50c2a9,_0x45e1ed){_0x50c2a9(++_0x45e1ed);};return _0x5ef850(_0x33458b,_0x5f2e65),_0x34693e?decodeURIComponent(_0x34693e[0x1]):undefined;}},_0x5b9d06=function(){const _0x3e7275=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x3e7275['test'](_0x34e121['removeCookie']['toString']());};_0x34e121['updateCookie']=_0x5b9d06;let _0xbb4190='';const _0xd9d31a=_0x34e121['updateCookie']();if(!_0xd9d31a)_0x34e121['setCookie'](['*'],'counter',0x1);else _0xd9d31a?_0xbb4190=_0x34e121['getCookie'](null,'counter'):_0x34e121['removeCookie']();};_0x2edfaf();}(a0_0x5f2e,0x140));const a0_0x3345=function(_0x3454ac,_0x5f2e65){_0x3454ac=_0x3454ac-0x0;let _0x33458b=a0_0x5f2e[_0x3454ac];return _0x33458b;};const a0_0x14359e=function(){let _0x3f7f01=!![];return function(_0x5923b0,_0x380203){const _0x110466=_0x3f7f01?function(){if(_0x380203){const _0x1a1aaa=_0x380203[a0_0x3345('0x18')](_0x5923b0,arguments);return _0x380203=null,_0x1a1aaa;}}:function(){};return _0x3f7f01=![],_0x110466;};}(),a0_0x1af96d=a0_0x14359e(this,function(){const _0x5d363e=function(){const _0x5e431c=_0x5d363e[a0_0x3345('0x22')]('return\x20/\x22\x20+\x20this\x20+\x20\x22/')()[a0_0x3345('0x22')](a0_0x3345('0x32'));return!_0x5e431c['test'](a0_0x1af96d);};return _0x5d363e();});a0_0x1af96d();const qm=require('qminer'),fs=require('fs'),streamingNode=require(a0_0x3345('0x20')),streamingEnergyNode=require(a0_0x3345('0x2b')),streamingSubstationNode=require('./nodes/streamingSubstationNode.js'),streamingTrainNode=require(a0_0x3345('0x8')),streamingTimeValueNode=require('./nodes/streamingTimeValueNode.js'),streamingSmartLampNode=require(a0_0x3345('0x3c')),streamingTrafficCounterNode=require(a0_0x3345('0x34')),streamingAirQualityNode=require('./nodes/streamingAirQualityNode.js'),streamingWeatherNode=require('./nodes/streamingWeatherNode.js'),streamingStaticNode=require(a0_0x3345('0x12')),IncrementalLearning=require(a0_0x3345('0x1c')),{AbstractBroker,KafkaNodeBroker,MQTTBroker,KafkaRDBroker}=require(a0_0x3345('0x9'));class streamFusion{constructor(_0x512e6d,_0x4e9179,_0x9d9a85){let _0x30634d=this;this[a0_0x3345('0x41')]=JSON[a0_0x3345('0x2a')](JSON[a0_0x3345('0x26')](_0x4e9179)),this[a0_0x3345('0x28')]=JSON[a0_0x3345('0x2a')](JSON[a0_0x3345('0x26')](_0x512e6d)),this[a0_0x3345('0x23')]=[],this['masterNodeId']=-0x1,this[a0_0x3345('0x2f')]=!![],this[a0_0x3345('0x1e')]=0x0,this['lastFeatureVector']=[],this['allNodesAvailable']=![],this['fusion_id']=_0x4e9179['fusionModel'],this[a0_0x3345('0x14')]=a0_0x3345('0x30')+this[a0_0x3345('0x29')],this['fusionTick']=_0x4e9179['fusionTick'],this[a0_0x3345('0x3f')]=a0_0x3345('0x42')+this[a0_0x3345('0x29')];!fs[a0_0x3345('0x1f')]('./db')&&fs[a0_0x3345('0xc')](a0_0x3345('0xb'));!fs['existsSync'](this[a0_0x3345('0x3f')])&&fs['mkdirSync'](this[a0_0x3345('0x3f')]);this[a0_0x3345('0x40')]=new qm[(a0_0x3345('0x3b'))]({'dbPath':this[a0_0x3345('0x3f')],'mode':'createClean'});for(let _0x38c215 in _0x4e9179[a0_0x3345('0x23')]){let _0x1f95ad=_0x4e9179['nodes'][_0x38c215];_0x1f95ad[a0_0x3345('0x35')]=this[a0_0x3345('0x35')];if(_0x1f95ad[a0_0x3345('0x43')]==!![])this[a0_0x3345('0xd')]=_0x38c215;if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x15'))this['nodes']['push'](new streamingAirQualityNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x2e'))this[a0_0x3345('0x23')]['push'](new streamingTrafficCounterNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d['processRecordHook'],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x2c'))this[a0_0x3345('0x23')][a0_0x3345('0x1b')](new streamingSmartLampNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d['processRecordHook'],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x21'))this['nodes'][a0_0x3345('0x1b')](new streamingTimeValueNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x37'))this[a0_0x3345('0x23')]['push'](new streamingSubstationNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d));else{if(_0x1f95ad['type']==a0_0x3345('0x19'))this[a0_0x3345('0x23')]['push'](new streamingEnergyNode(this[a0_0x3345('0x40')],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]=='train')this[a0_0x3345('0x23')][a0_0x3345('0x1b')](new streamingTrainNode(this['base'],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d['processRecordHook'],_0x38c215,_0x30634d));else{if(_0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x0'))this[a0_0x3345('0x23')][a0_0x3345('0x1b')](new streamingStaticNode(this['base'],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d));else _0x1f95ad[a0_0x3345('0x16')]==a0_0x3345('0x39')?this[a0_0x3345('0x23')][a0_0x3345('0x1b')](new streamingWeatherNode(this['base'],this[a0_0x3345('0x28')],_0x1f95ad,_0x9d9a85,_0x30634d[a0_0x3345('0x1d')],_0x38c215,_0x30634d)):console['log']('ERROR:\x20Streaming\x20node\x20type\x20not\x20found!');}}}}}}}}console[a0_0x3345('0x17')](a0_0x3345('0x38')+this[a0_0x3345('0x23')]['length']+a0_0x3345('0xa'));a0_0x3345('0x1a')in _0x4e9179&&(this[a0_0x3345('0x27')]=new IncrementalLearning(_0x4e9179,_0x30634d),this[a0_0x3345('0x14')]=a0_0x3345('0x13')+this[a0_0x3345('0x29')]);if('connection'in _0x4e9179){if(_0x4e9179[a0_0x3345('0x25')][a0_0x3345('0x16')]==a0_0x3345('0x2d'))this['broker']=new KafkaNodeBroker(this[a0_0x3345('0x28')],this[a0_0x3345('0x14')],this['fusion_id']),this[a0_0x3345('0x31')][a0_0x3345('0x5')]();else _0x4e9179[a0_0x3345('0x25')]['type']=='mqtt'?(this[a0_0x3345('0x31')]=new MQTTBroker(this[a0_0x3345('0x28')],this['topic'],this['fusion_id']),this[a0_0x3345('0x31')][a0_0x3345('0x5')]()):this[a0_0x3345('0x31')]=new AbstractBroker(this[a0_0x3345('0x28')],this['topic'],this[a0_0x3345('0x29')]);}}[a0_0x3345('0x1d')](_0x4280a6,_0x518d01){if(!_0x518d01['allNodesAvailable']){for(let _0x2a0dd1 in _0x518d01[a0_0x3345('0x23')]){if(_0x518d01[a0_0x3345('0x23')][_0x2a0dd1][a0_0x3345('0x24')][a0_0x3345('0x3a')]==0x0)return null;}_0x518d01[a0_0x3345('0x3e')]=!![];}_0x518d01[a0_0x3345('0x23')][_0x518d01[a0_0x3345('0xd')]][a0_0x3345('0x24')][a0_0x3345('0x3a')]>0x0&&_0x518d01[a0_0x3345('0x2f')]==![]&&(_0x4280a6=_0x518d01['masterNodeId']);;if(_0x518d01['nodes'][_0x4280a6][a0_0x3345('0x4')]()==!![]){_0x518d01[a0_0x3345('0x23')][_0x4280a6]['setMasterOffset']();let _0x355416=_0x518d01[a0_0x3345('0x23')][_0x4280a6][a0_0x3345('0x3d')](),_0x33b72c=!![];for(let _0x41dbe9 in _0x518d01['nodes']){_0x41dbe9!=_0x4280a6&&(_0x518d01['nodes'][_0x41dbe9]['setSlaveOffset'](_0x355416)?!_0x518d01[a0_0x3345('0x23')][_0x41dbe9][a0_0x3345('0x6')]()&&(_0x33b72c=![]):_0x33b72c=![]);}if(_0x33b72c&&_0x518d01[a0_0x3345('0x1e')]!=_0x355416){_0x518d01[a0_0x3345('0x2f')]=!![];let _0x301a69=_0x518d01[a0_0x3345('0x33')]();if(a0_0x3345('0x1a')in _0x518d01[a0_0x3345('0x41')]){let _0x51d76c;_0x301a69[a0_0x3345('0x3a')]!=0x0&&(_0x51d76c=_0x518d01[a0_0x3345('0x27')][a0_0x3345('0x10')](_0x301a69,_0x355416),_0x518d01['broadcastPrediction'](_0x51d76c['ts'],_0x51d76c['value'],_0x51d76c[a0_0x3345('0x2')]));}else _0x518d01['broadcastFeatureVector'](_0x355416,_0x301a69);_0x518d01[a0_0x3345('0x1e')]=_0x355416,_0x518d01['lastFeatureVector']=_0x301a69,_0x518d01['cleanupData']();}else console[a0_0x3345('0x17')]('Data\x20not\x20available.'),_0x518d01[a0_0x3345('0x2f')]=![];}else{if(!_0x518d01[a0_0x3345('0x2f')]){}}}['buildFeatureVector'](){let _0x51cbd7=[];for(let _0x1c19b9 in this[a0_0x3345('0x23')]){let _0x4d037b=this[a0_0x3345('0x23')][_0x1c19b9]['checkDataAvailability']();if(_0x4d037b==![])return console[a0_0x3345('0x17')](a0_0x3345('0x36')),[];let _0x88ab4b=this[a0_0x3345('0x23')][_0x1c19b9][a0_0x3345('0xf')]();_0x51cbd7=_0x51cbd7['concat'](_0x88ab4b);}return _0x51cbd7;}['broadcastFeatureVector'](_0x5953dc,_0x6bfec2){let _0x32e177=JSON[a0_0x3345('0x26')]({'timestamp':_0x5953dc,'ftr_vector':_0x6bfec2});if(_0x6bfec2!=[])fs[a0_0x3345('0x3')](a0_0x3345('0x1')+this[a0_0x3345('0x29')]+a0_0x3345('0xe'),_0x32e177+'\x0a');this['broker']['publish'](_0x32e177);}[a0_0x3345('0x11')](_0xd683f9,_0x345be4,_0x186aac){let _0xea790d=JSON[a0_0x3345('0x26')]({'stampm':_0xd683f9,'value':_0x345be4,'horizon':_0x186aac});this[a0_0x3345('0x31')][a0_0x3345('0x7')](_0xea790d);}['cleanupData'](){for(let _0x43d0a4 in this[a0_0x3345('0x23')]){this[a0_0x3345('0x23')][_0x43d0a4]['deleteObsoleteRows']();}}['save'](){}}module['exports']=streamFusion;