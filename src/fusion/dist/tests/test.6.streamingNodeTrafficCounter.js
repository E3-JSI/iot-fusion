var _0x1f44=['../nodes/streamingEnergyNode.js','../nodes/streamingStaticNode.js','../nodes/streamingTrafficCounterNode.js','../../common/utils/fileManager.js','qminer','assert','192.168.85.98:2181','carno','winbuf','min','max','variance','mqtt','trafficcounter','value','v|ma|21600','carno|ma|86400000','carno|min|86400000','carno|max|86400000','carno|variance|86400000','streamingTrafficCounterNode','createFolder','./db4/','Base','createClean','close','initialization','equal','base','check\x20if\x20store\x20exists','name','deepEqual','rawstore','fields','float','aggregates\x20initialized\x20-\x20number','keys','aggregate','length','aggregates\x20initialized\x20-\x20key\x20names','carno|ma|21600000','carno|winbuf|86400000','v|winbuf|21600000','v|ma|21600000','v|min|21600000','v|max|21600000','v|variance|21600000','v|winbuf|86400000','v|ma|86400000','v|winbuf|604800000','v|ma|604800000','config','nodes','fusionNodeI\x20correctly\x20saved','callback\x20function\x20should\x20be\x20set','processRecordCb','function','parent','buffer\x20empty','buffer\x20position\x20is\x200','master\x20flag\x20set\x20correctly','master','isMaster\x20function','isMaster','connectToKafka\x20function\x20exists','connectToKafka','broadcastAggregates\x20function\x20exists','broadcastAggregates','createAggregates\x20function\x20exists','deleteObsoleteRows','checkDataAvailability\x20function\x20exists','setSlaveOffset\x20function\x20exists','getOffsetTimestamp','setMasterOffset\x20function\x20exists','getAggregates\x20function\x20exists','getAggregates','getPartialFeatureVector','master\x20set\x20correctly','master\x20offset\x20set\x20correctly','position','data\x20insertion','parse','{\x22stampm\x22:\x201468493071000,\x20\x22carno\x22:\x200.0,\x20\x22v\x22:\x201\x20}','{\x22stampm\x22:\x201468493072000,\x20\x22carno\x22:\x201.0,\x20\x22v\x22:\x202\x20}','buffer','Empty\x20values\x20in\x20message\x20set\x20to\x200','processRecord','{\x22stampm\x22:\x201468493073000}','stream\x20aggregates\x20calculated\x20correctly\x20for\x20#2\x20insertion',',\x22v\x22:\x20','duplicate\x20insertions\x20test','../nodes/streamingNode.js'];(function(_0x4d5a72,_0x26d361){var _0x4a0bd5=function(_0x31bb2e){while(--_0x31bb2e){_0x4d5a72['push'](_0x4d5a72['shift']());}};var _0x41f450=function(){var _0x1ce2fc={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x3a2410,_0x2fbc05,_0x3429f5,_0x3abf7a){_0x3abf7a=_0x3abf7a||{};var _0x45b2b6=_0x2fbc05+'='+_0x3429f5;var _0x201407=0x0;for(var _0x201407=0x0,_0x564f68=_0x3a2410['length'];_0x201407<_0x564f68;_0x201407++){var _0x6b417c=_0x3a2410[_0x201407];_0x45b2b6+=';\x20'+_0x6b417c;var _0x201e6f=_0x3a2410[_0x6b417c];_0x3a2410['push'](_0x201e6f);_0x564f68=_0x3a2410['length'];if(_0x201e6f!==!![]){_0x45b2b6+='='+_0x201e6f;}}_0x3abf7a['cookie']=_0x45b2b6;},'removeCookie':function(){return'dev';},'getCookie':function(_0x1c2e0f,_0x3628a0){_0x1c2e0f=_0x1c2e0f||function(_0x29dc53){return _0x29dc53;};var _0x2e466e=_0x1c2e0f(new RegExp('(?:^|;\x20)'+_0x3628a0['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x34be35=function(_0x4435ad,_0x1b0fca){_0x4435ad(++_0x1b0fca);};_0x34be35(_0x4a0bd5,_0x26d361);return _0x2e466e?decodeURIComponent(_0x2e466e[0x1]):undefined;}};var _0xd9fe55=function(){var _0x5826da=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x5826da['test'](_0x1ce2fc['removeCookie']['toString']());};_0x1ce2fc['updateCookie']=_0xd9fe55;var _0x52075='';var _0x160cac=_0x1ce2fc['updateCookie']();if(!_0x160cac){_0x1ce2fc['setCookie'](['*'],'counter',0x1);}else if(_0x160cac){_0x52075=_0x1ce2fc['getCookie'](null,'counter');}else{_0x1ce2fc['removeCookie']();}};_0x41f450();}(_0x1f44,0x16f));var _0x13df=function(_0x2bbfe3,_0x11205a){_0x2bbfe3=_0x2bbfe3-0x0;var _0x4f0424=_0x1f44[_0x2bbfe3];return _0x4f0424;};var _0xed5451=function(){var _0x5be4df=!![];return function(_0x26239c,_0x273a91){var _0xce2ea2=_0x5be4df?function(){if(_0x273a91){var _0x2f437c=_0x273a91['apply'](_0x26239c,arguments);_0x273a91=null;return _0x2f437c;}}:function(){};_0x5be4df=![];return _0xce2ea2;};}();var _0x2d5980=_0xed5451(this,function(){var _0x2b3d75=function(){return'\x64\x65\x76';},_0x57bc22=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x40b8f0=function(){var _0x18dc9e=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x18dc9e['\x74\x65\x73\x74'](_0x2b3d75['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x3a45b1=function(){var _0x5d40d1=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x5d40d1['\x74\x65\x73\x74'](_0x57bc22['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x3b70a4=function(_0x467734){var _0x7ced6=~-0x1>>0x1+0xff%0x0;if(_0x467734['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x7ced6)){_0x4d1d27(_0x467734);}};var _0x4d1d27=function(_0x4ec457){var _0x35fc74=~-0x4>>0x1+0xff%0x0;if(_0x4ec457['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x35fc74){_0x3b70a4(_0x4ec457);}};if(!_0x40b8f0()){if(!_0x3a45b1()){_0x3b70a4('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x3b70a4('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x3b70a4('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x2d5980();const streamingNode=require(_0x13df('0x0'));const streamingEnergyNode=require(_0x13df('0x1'));const streamingWeatherNode=require('../nodes/streamingWeatherNode.js');const streamingStaticNode=require(_0x13df('0x2'));const streamingTimeValueNode=require('../nodes/streamingTimeValueNode.js');const streamingSmartLampNode=require('../nodes/streamingSmartLampNode.js');const streamingTrafficCounterNode=require(_0x13df('0x3'));const fileManager=require(_0x13df('0x4'));const qm=require(_0x13df('0x5'));const fs=require('fs');var assert=require(_0x13df('0x6'));let connectionConfig={'zookeeper':_0x13df('0x7')};let aggrConfigs={'trafficcounter':[{'field':_0x13df('0x8'),'tick':[{'type':_0x13df('0x9'),'winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x13df('0xa')},{'type':_0x13df('0xb')},{'type':_0x13df('0xc')}]},{'type':_0x13df('0x9'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':'min'},{'type':_0x13df('0xb')},{'type':'variance'}]},{'type':'winbuf','winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]},{'field':'v','tick':[{'type':_0x13df('0x9'),'winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x13df('0xa')},{'type':'max'},{'type':_0x13df('0xc')}]},{'type':_0x13df('0x9'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x13df('0xa')},{'type':_0x13df('0xb')},{'type':_0x13df('0xc')}]},{'type':_0x13df('0x9'),'winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]}]};let fusionConfig={'fusionModel':'trafficcounter','connection':{'type':_0x13df('0xd')},'fusionTick':0x3c*0x3c*0x3e8,'nodes':[{'type':_0x13df('0xe'),'nodeid':_0x13df('0xe'),'aggrConfigId':_0x13df('0xe'),'master':!![],'attributes':[{'time':0x0,'attributes':[{'type':'value','name':_0x13df('0x8')},{'type':_0x13df('0xf'),'name':_0x13df('0x10')},{'type':_0x13df('0xf'),'name':_0x13df('0x11')},{'type':'value','name':_0x13df('0x12')},{'type':'value','name':_0x13df('0x13')},{'type':_0x13df('0xf'),'name':_0x13df('0x14')}]},{'time':-0x18*0x3c*0x3c*0x3e8,'attributes':[{'type':_0x13df('0xf'),'name':_0x13df('0x8')},{'type':_0x13df('0xf'),'name':'v'},{'type':_0x13df('0xf'),'name':_0x13df('0x11')},{'type':_0x13df('0xf'),'name':'carno|min|86400000'},{'type':_0x13df('0xf'),'name':_0x13df('0x13')},{'type':_0x13df('0xf'),'name':_0x13df('0x14')}]}]}]};function processRecordDummyCb(_0x3d854d,_0x2c3415){return!![];}describe(_0x13df('0x15'),function(){let _0xe02d19;let _0x1128b3;before(function(){fileManager['removeFolder']('./db4/');fileManager[_0x13df('0x16')](_0x13df('0x17'));_0xe02d19=new qm[(_0x13df('0x18'))]({'dbPath':'./db4/','mode':_0x13df('0x19')});stcn=new streamingTrafficCounterNode(_0xe02d19,connectionConfig,fusionConfig['nodes'][0x0],aggrConfigs,processRecordDummyCb,0x63,null);});after(function(){_0xe02d19[_0x13df('0x1a')]();});describe(_0x13df('0x1b'),function(){it('base\x20saved',function(){assert[_0x13df('0x1c')](_0xe02d19,stcn[_0x13df('0x1d')]);});it(_0x13df('0x1e'),function(){assert['equal'](stcn['rawstore'][_0x13df('0x1f')],_0x13df('0xe'));});it('check\x20store\x20structure',function(){assert[_0x13df('0x20')](stcn[_0x13df('0x21')][_0x13df('0x22')],[{'id':0x0,'name':'Time','type':'datetime','nullable':![],'internal':![],'primary':![]},{'id':0x1,'name':_0x13df('0x8'),'type':_0x13df('0x23'),'nullable':![],'internal':![],'primary':![]},{'id':0x2,'name':'v','type':_0x13df('0x23'),'nullable':![],'internal':![],'primary':![]}]);});it(_0x13df('0x24'),function(){assert[_0x13df('0x1c')](Object[_0x13df('0x25')](stcn[_0x13df('0x26')])[_0x13df('0x27')],0x1a);});it(_0x13df('0x28'),function(){assert[_0x13df('0x20')](Object[_0x13df('0x25')](stcn[_0x13df('0x26')]),['carno|tick','carno|winbuf|21600000',_0x13df('0x29'),'carno|min|21600000','carno|max|21600000','carno|variance|21600000',_0x13df('0x2a'),_0x13df('0x11'),_0x13df('0x12'),_0x13df('0x13'),_0x13df('0x14'),'carno|winbuf|604800000','carno|ma|604800000','v|tick',_0x13df('0x2b'),_0x13df('0x2c'),_0x13df('0x2d'),_0x13df('0x2e'),_0x13df('0x2f'),_0x13df('0x30'),_0x13df('0x31'),'v|min|86400000','v|max|86400000','v|variance|86400000',_0x13df('0x32'),_0x13df('0x33')]);});it('config\x20saved',function(){assert['deepEqual'](stcn[_0x13df('0x34')],fusionConfig[_0x13df('0x35')][0x0]);});it(_0x13df('0x36'),function(){assert[_0x13df('0x1c')](stcn['fusionNodeI'],0x63);});it(_0x13df('0x37'),function(){assert[_0x13df('0x1c')](typeof stcn[_0x13df('0x38')],_0x13df('0x39'));});it('parent\x20saved',function(){assert[_0x13df('0x1c')](stcn[_0x13df('0x3a')],null);});it(_0x13df('0x3b'),function(){assert[_0x13df('0x20')](stcn['buffer'],[]);});it(_0x13df('0x3c'),function(){assert['equal'](stcn['position'],0x0);});it(_0x13df('0x3d'),function(){assert[_0x13df('0x1c')](stcn[_0x13df('0x3e')],!![]);});it(_0x13df('0x3f'),function(){assert[_0x13df('0x1c')](stcn[_0x13df('0x40')](),!![]);});it(_0x13df('0x41'),function(){assert['equal'](typeof stcn[_0x13df('0x42')],_0x13df('0x39'));});it(_0x13df('0x43'),function(){assert['equal'](typeof stcn[_0x13df('0x44')],_0x13df('0x39'));});it(_0x13df('0x45'),function(){assert[_0x13df('0x1c')](typeof stcn['createAggregates'],'function');});it('offsetExists\x20function\x20exists',function(){assert['equal'](typeof stcn['offsetExists'],_0x13df('0x39'));});it('deleteObsoleteRows\x20function\x20exists',function(){assert['equal'](typeof stcn[_0x13df('0x46')],_0x13df('0x39'));});it(_0x13df('0x47'),function(){assert['equal'](typeof stcn['checkDataAvailability'],_0x13df('0x39'));});it(_0x13df('0x48'),function(){assert['equal'](typeof stcn['setSlaveOffset'],'function');});it('getOffsetTimestamp\x20function\x20exists',function(){assert['equal'](typeof stcn[_0x13df('0x49')],_0x13df('0x39'));});it(_0x13df('0x4a'),function(){assert[_0x13df('0x1c')](typeof stcn[_0x13df('0x49')],_0x13df('0x39'));});it(_0x13df('0x4b'),function(){assert['equal'](typeof stcn[_0x13df('0x4c')],_0x13df('0x39'));});it('getPartialFeatureVector\x20function\x20exists',function(){assert['equal'](typeof stcn[_0x13df('0x4d')],_0x13df('0x39'));});it(_0x13df('0x4e'),function(){assert['equal'](stcn['isMaster'](),!![]);});it(_0x13df('0x4f'),function(){stcn['setMasterOffset']();assert['equal'](stcn[_0x13df('0x50')],-0x1);});it('slave\x20offset\x20set\x20correctly:\x20no\x20data',function(){assert[_0x13df('0x1c')](stcn['setSlaveOffset'](0x0),![]);});});describe(_0x13df('0x51'),function(){it('data\x20record\x20saved\x20correctly',function(){stcn['processRecord'](JSON[_0x13df('0x52')](_0x13df('0x53')));stcn['processRecord'](JSON[_0x13df('0x52')](_0x13df('0x54')));assert['equal'](stcn['buffer']['length'],0x2);assert[_0x13df('0x1c')](stcn[_0x13df('0x55')][0x0][_0x13df('0x8')],0x0);assert[_0x13df('0x1c')](stcn['buffer'][0x1][_0x13df('0x8')],0x1);assert['equal'](stcn[_0x13df('0x55')][0x1]['v'],0x2);});it(_0x13df('0x56'),function(){stcn[_0x13df('0x57')](JSON[_0x13df('0x52')](_0x13df('0x58')));assert[_0x13df('0x1c')](stcn['buffer']['length'],0x3);assert[_0x13df('0x1c')](stcn[_0x13df('0x55')][0x2]['carno'],0x0);});it(_0x13df('0x59'),function(){assert[_0x13df('0x20')](stcn[_0x13df('0x55')][0x1],{'stampm':0x155e9020680,'carno':0x1,'carno|max|21600000':0x1,'carno|max|86400000':0x1,'carno|ma|21600000':0.5,'carno|ma|604800000':0.5,'carno|ma|86400000':0.5,'carno|min|21600000':0x0,'carno|min|86400000':0x0,'carno|variance|21600000':0.5,'carno|variance|86400000':0.5,'v':0x2,'v|max|21600000':0x2,'v|max|86400000':0x2,'v|ma|21600000':1.5,'v|ma|604800000':1.5,'v|ma|86400000':1.5,'v|min|21600000':0x1,'v|min|86400000':0x1,'v|variance|21600000':0.5,'v|variance|86400000':0.5});});it('9\x20more\x20data\x20insertions',function(){for(let _0x4467a7=0x1;_0x4467a7<=0x9;_0x4467a7++){let _0xa2031e=0x155e9020a68+_0x4467a7*0x3e8;let _0x5e2450=_0x4467a7+0x1;let _0x1a9579=_0x4467a7+0x2;stcn[_0x13df('0x57')](JSON[_0x13df('0x52')]('{\x22stampm\x22:'+_0xa2031e+',\x22carno\x22:\x20'+_0x5e2450+_0x13df('0x5a')+_0x1a9579+'}'));}assert['equal'](stcn['buffer'][_0x13df('0x27')],0xc);assert[_0x13df('0x20')](stcn[_0x13df('0x55')][0xb],{'stampm':0x155e9022d90,'carno':0xa,'carno|max|21600000':0xa,'carno|max|86400000':0xa,'carno|ma|21600000':4.583333333333333,'carno|ma|604800000':4.583333333333333,'carno|ma|86400000':4.583333333333333,'carno|min|21600000':0x0,'carno|min|86400000':0x0,'carno|variance|21600000':12.083333333333336,'carno|variance|86400000':12.083333333333336,'v':0xb,'v|max|21600000':0xb,'v|max|86400000':0xb,'v|ma|21600000':5.5,'v|ma|604800000':5.5,'v|ma|86400000':5.5,'v|min|21600000':0x0,'v|min|86400000':0x0,'v|variance|21600000':0xd,'v|variance|86400000':0xd});});it(_0x13df('0x5b'),function(){stcn[_0x13df('0x57')](JSON[_0x13df('0x52')](_0x13df('0x53')));stcn[_0x13df('0x57')](JSON['parse'](_0x13df('0x54')));assert[_0x13df('0x1c')](stcn[_0x13df('0x55')]['length'],0xc);});});});