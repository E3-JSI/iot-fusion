var _0x2447=['dimml|ma|604800000','pact|ma|21600000','pact|min|21600000','pact|max|21600000','pact|winbuf|86400000','pact|max|86400000','pact|winbuf|604800000','config\x20saved','config','fusionNodeI\x20correctly\x20saved','fusionNodeI','processRecordCb','parent\x20saved','parent','buffer','buffer\x20position\x20is\x200','position','master\x20flag\x20set\x20correctly','isMaster','connectToKafka\x20function\x20exists','connectToKafka','function','broadcastAggregates','offsetExists\x20function\x20exists','deleteObsoleteRows\x20function\x20exists','deleteObsoleteRows','checkDataAvailability\x20function\x20exists','checkDataAvailability','setSlaveOffset\x20function\x20exists','getOffsetTimestamp\x20function\x20exists','getOffsetTimestamp','getAggregates\x20function\x20exists','getAggregates','getPartialFeatureVector\x20function\x20exists','getPartialFeatureVector','master\x20set\x20correctly','setMasterOffset','slave\x20offset\x20set\x20correctly:\x20no\x20data','setSlaveOffset','data\x20insertion','processRecord','parse','{\x22stampm\x22:\x201468493071000,\x20\x22pact\x22:\x200.0,\x20\x22dimml\x22:\x200\x20}','Empty\x20values\x20in\x20message\x20set\x20to\x200',',\x22dimml\x22:\x20',',\x22pact\x22:\x20','{\x22stampm\x22:\x201468493072000,\x20\x22pact\x22:\x201.0,\x20\x22dimml\x22:\x201\x20}','../nodes/streamingNode.js','../nodes/streamingEnergyNode.js','../nodes/streamingWeatherNode.js','../nodes/streamingStaticNode.js','../nodes/streamingTimeValueNode.js','qminer','192.168.85.98:2181','dimml','winbuf','variance','min','max','pact','mqtt','smartlamp','value','pact|ma|21600','dimml|ma|86400000','dimml|min|86400000','dimml|variance|86400000','streamingSmartLampNode','./db4/','createFolder','createClean','nodes','close','initialization','base\x20saved','equal','base','check\x20if\x20store\x20exists','rawstore','deepEqual','fields','Time','datetime','float','aggregates\x20initialized\x20-\x20number','keys','aggregate','length','aggregates\x20initialized\x20-\x20key\x20names','dimml|tick','dimml|winbuf|21600000','dimml|ma|21600000','dimml|min|21600000','dimml|max|21600000','dimml|variance|21600000','dimml|winbuf|86400000','dimml|winbuf|604800000'];(function(_0x42ea7b,_0x3a9966){var _0x1fa2c0=function(_0x8cce97){while(--_0x8cce97){_0x42ea7b['push'](_0x42ea7b['shift']());}};var _0x30f947=function(){var _0x4dc08d={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x4fbf48,_0x214f67,_0x102138,_0x138a3a){_0x138a3a=_0x138a3a||{};var _0x4aab1f=_0x214f67+'='+_0x102138;var _0x1cc748=0x0;for(var _0x1cc748=0x0,_0xe16874=_0x4fbf48['length'];_0x1cc748<_0xe16874;_0x1cc748++){var _0x3c489f=_0x4fbf48[_0x1cc748];_0x4aab1f+=';\x20'+_0x3c489f;var _0x2ee020=_0x4fbf48[_0x3c489f];_0x4fbf48['push'](_0x2ee020);_0xe16874=_0x4fbf48['length'];if(_0x2ee020!==!![]){_0x4aab1f+='='+_0x2ee020;}}_0x138a3a['cookie']=_0x4aab1f;},'removeCookie':function(){return'dev';},'getCookie':function(_0x44c357,_0x1224f4){_0x44c357=_0x44c357||function(_0x572349){return _0x572349;};var _0x5a1394=_0x44c357(new RegExp('(?:^|;\x20)'+_0x1224f4['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x14f506=function(_0x14b7a8,_0x41d461){_0x14b7a8(++_0x41d461);};_0x14f506(_0x1fa2c0,_0x3a9966);return _0x5a1394?decodeURIComponent(_0x5a1394[0x1]):undefined;}};var _0x303bae=function(){var _0x1e1488=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x1e1488['test'](_0x4dc08d['removeCookie']['toString']());};_0x4dc08d['updateCookie']=_0x303bae;var _0x46446e='';var _0x5be499=_0x4dc08d['updateCookie']();if(!_0x5be499){_0x4dc08d['setCookie'](['*'],'counter',0x1);}else if(_0x5be499){_0x46446e=_0x4dc08d['getCookie'](null,'counter');}else{_0x4dc08d['removeCookie']();}};_0x30f947();}(_0x2447,0x1b3));var _0x1357=function(_0x41b5ff,_0xff9ae8){_0x41b5ff=_0x41b5ff-0x0;var _0x3e8ff1=_0x2447[_0x41b5ff];return _0x3e8ff1;};var _0x5c1474=function(){var _0x32dd9e=!![];return function(_0x5c3e91,_0x5ee910){var _0x492bfc=_0x32dd9e?function(){if(_0x5ee910){var _0x581747=_0x5ee910['apply'](_0x5c3e91,arguments);_0x5ee910=null;return _0x581747;}}:function(){};_0x32dd9e=![];return _0x492bfc;};}();var _0x18f7f3=_0x5c1474(this,function(){var _0xb2f106=function(){return'\x64\x65\x76';},_0x2585c2=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x741093=function(){var _0x9e2026=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x9e2026['\x74\x65\x73\x74'](_0xb2f106['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x429324=function(){var _0x390e6b=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x390e6b['\x74\x65\x73\x74'](_0x2585c2['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x4e052a=function(_0x3fbeb0){var _0x28cfde=~-0x1>>0x1+0xff%0x0;if(_0x3fbeb0['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x28cfde)){_0x3908cb(_0x3fbeb0);}};var _0x3908cb=function(_0x1578b4){var _0x552928=~-0x4>>0x1+0xff%0x0;if(_0x1578b4['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x552928){_0x4e052a(_0x1578b4);}};if(!_0x741093()){if(!_0x429324()){_0x4e052a('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x4e052a('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x4e052a('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x18f7f3();const streamingNode=require(_0x1357('0x0'));const streamingEnergyNode=require(_0x1357('0x1'));const streamingWeatherNode=require(_0x1357('0x2'));const streamingStaticNode=require(_0x1357('0x3'));const streamingTimeValueNode=require(_0x1357('0x4'));const streamingSmartLampNode=require('../nodes/streamingSmartLampNode.js');const fileManager=require('../../common/utils/fileManager.js');const qm=require(_0x1357('0x5'));const fs=require('fs');var assert=require('assert');let connectionConfig={'zookeeper':_0x1357('0x6')};let aggrConfigs={'smartlamp':[{'field':_0x1357('0x7'),'tick':[{'type':_0x1357('0x8'),'winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':'min'},{'type':'max'},{'type':_0x1357('0x9')}]},{'type':_0x1357('0x8'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1357('0xa')},{'type':_0x1357('0xb')},{'type':_0x1357('0x9')}]},{'type':'winbuf','winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]},{'field':_0x1357('0xc'),'tick':[{'type':_0x1357('0x8'),'winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1357('0xa')},{'type':_0x1357('0xb')},{'type':_0x1357('0x9')}]},{'type':_0x1357('0x8'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1357('0xa')},{'type':_0x1357('0xb')},{'type':'variance'}]},{'type':'winbuf','winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]}]};let fusionConfig={'fusionModel':'smartlamp','connection':{'type':_0x1357('0xd')},'fusionTick':0x3c*0x3c*0x3e8,'nodes':[{'type':'smartlamp','nodeid':_0x1357('0xe'),'aggrConfigId':_0x1357('0xe'),'master':!![],'attributes':[{'time':0x0,'attributes':[{'type':_0x1357('0xf'),'name':_0x1357('0x7')},{'type':'value','name':_0x1357('0x10')},{'type':_0x1357('0xf'),'name':_0x1357('0x11')},{'type':'value','name':_0x1357('0x12')},{'type':'value','name':'dimml|max|86400000'},{'type':'value','name':_0x1357('0x13')}]},{'time':-0x18*0x3c*0x3c*0x3e8,'attributes':[{'type':_0x1357('0xf'),'name':_0x1357('0x7')},{'type':_0x1357('0xf'),'name':_0x1357('0xc')},{'type':_0x1357('0xf'),'name':_0x1357('0x11')},{'type':_0x1357('0xf'),'name':_0x1357('0x12')},{'type':_0x1357('0xf'),'name':'dimml|max|86400000'},{'type':_0x1357('0xf'),'name':_0x1357('0x13')}]}]}]};function processRecordDummyCb(_0x28688a,_0x13a9dd){return!![];}describe(_0x1357('0x14'),function(){let _0x125c3a;let _0x369c0a;before(function(){fileManager['removeFolder'](_0x1357('0x15'));fileManager[_0x1357('0x16')](_0x1357('0x15'));_0x125c3a=new qm['Base']({'dbPath':_0x1357('0x15'),'mode':_0x1357('0x17')});ssln=new streamingSmartLampNode(_0x125c3a,connectionConfig,fusionConfig[_0x1357('0x18')][0x0],aggrConfigs,processRecordDummyCb,0x63,null);});after(function(){_0x125c3a[_0x1357('0x19')]();});describe(_0x1357('0x1a'),function(){it(_0x1357('0x1b'),function(){assert[_0x1357('0x1c')](_0x125c3a,ssln[_0x1357('0x1d')]);});it(_0x1357('0x1e'),function(){assert[_0x1357('0x1c')](ssln[_0x1357('0x1f')]['name'],'smartlamp');});it('check\x20store\x20structure',function(){assert[_0x1357('0x20')](ssln[_0x1357('0x1f')][_0x1357('0x21')],[{'id':0x0,'name':_0x1357('0x22'),'type':_0x1357('0x23'),'nullable':![],'internal':![],'primary':![]},{'id':0x1,'name':_0x1357('0xc'),'type':_0x1357('0x24'),'nullable':![],'internal':![],'primary':![]},{'id':0x2,'name':_0x1357('0x7'),'type':_0x1357('0x24'),'nullable':![],'internal':![],'primary':![]}]);});it(_0x1357('0x25'),function(){assert[_0x1357('0x1c')](Object[_0x1357('0x26')](ssln[_0x1357('0x27')])[_0x1357('0x28')],0x1a);});it(_0x1357('0x29'),function(){assert['deepEqual'](Object[_0x1357('0x26')](ssln['aggregate']),[_0x1357('0x2a'),_0x1357('0x2b'),_0x1357('0x2c'),_0x1357('0x2d'),_0x1357('0x2e'),_0x1357('0x2f'),_0x1357('0x30'),_0x1357('0x11'),_0x1357('0x12'),'dimml|max|86400000',_0x1357('0x13'),_0x1357('0x31'),_0x1357('0x32'),'pact|tick','pact|winbuf|21600000',_0x1357('0x33'),_0x1357('0x34'),_0x1357('0x35'),'pact|variance|21600000',_0x1357('0x36'),'pact|ma|86400000','pact|min|86400000',_0x1357('0x37'),'pact|variance|86400000',_0x1357('0x38'),'pact|ma|604800000']);});it(_0x1357('0x39'),function(){assert[_0x1357('0x20')](ssln[_0x1357('0x3a')],fusionConfig[_0x1357('0x18')][0x0]);});it(_0x1357('0x3b'),function(){assert['equal'](ssln[_0x1357('0x3c')],0x63);});it('callback\x20function\x20should\x20be\x20set',function(){assert['equal'](typeof ssln[_0x1357('0x3d')],'function');});it(_0x1357('0x3e'),function(){assert['equal'](ssln[_0x1357('0x3f')],null);});it('buffer\x20empty',function(){assert['deepEqual'](ssln[_0x1357('0x40')],[]);});it(_0x1357('0x41'),function(){assert['equal'](ssln[_0x1357('0x42')],0x0);});it(_0x1357('0x43'),function(){assert[_0x1357('0x1c')](ssln['master'],!![]);});it('isMaster\x20function',function(){assert[_0x1357('0x1c')](ssln[_0x1357('0x44')](),!![]);});it(_0x1357('0x45'),function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x46')],_0x1357('0x47'));});it('broadcastAggregates\x20function\x20exists',function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x48')],_0x1357('0x47'));});it('createAggregates\x20function\x20exists',function(){assert[_0x1357('0x1c')](typeof ssln['createAggregates'],_0x1357('0x47'));});it(_0x1357('0x49'),function(){assert['equal'](typeof ssln['offsetExists'],'function');});it(_0x1357('0x4a'),function(){assert['equal'](typeof ssln[_0x1357('0x4b')],_0x1357('0x47'));});it(_0x1357('0x4c'),function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x4d')],_0x1357('0x47'));});it(_0x1357('0x4e'),function(){assert[_0x1357('0x1c')](typeof ssln['setSlaveOffset'],'function');});it(_0x1357('0x4f'),function(){assert['equal'](typeof ssln[_0x1357('0x50')],_0x1357('0x47'));});it('setMasterOffset\x20function\x20exists',function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x50')],_0x1357('0x47'));});it(_0x1357('0x51'),function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x52')],_0x1357('0x47'));});it(_0x1357('0x53'),function(){assert[_0x1357('0x1c')](typeof ssln[_0x1357('0x54')],_0x1357('0x47'));});it(_0x1357('0x55'),function(){assert[_0x1357('0x1c')](ssln[_0x1357('0x44')](),!![]);});it('master\x20offset\x20set\x20correctly',function(){ssln[_0x1357('0x56')]();assert['equal'](ssln[_0x1357('0x42')],-0x1);});it(_0x1357('0x57'),function(){assert[_0x1357('0x1c')](ssln[_0x1357('0x58')](0x0),![]);});});describe(_0x1357('0x59'),function(){it('data\x20record\x20saved\x20correctly',function(){ssln[_0x1357('0x5a')](JSON[_0x1357('0x5b')](_0x1357('0x5c')));ssln[_0x1357('0x5a')](JSON[_0x1357('0x5b')]('{\x22stampm\x22:\x201468493072000,\x20\x22pact\x22:\x201.0,\x20\x22dimml\x22:\x201\x20}'));assert['equal'](ssln[_0x1357('0x40')][_0x1357('0x28')],0x2);assert[_0x1357('0x1c')](ssln[_0x1357('0x40')][0x0][_0x1357('0x7')],0x0);assert[_0x1357('0x1c')](ssln['buffer'][0x1][_0x1357('0xc')],0x1);});it(_0x1357('0x5d'),function(){ssln[_0x1357('0x5a')](JSON[_0x1357('0x5b')]('{\x22stampm\x22:\x201468493073000}'));assert['equal'](ssln[_0x1357('0x40')][_0x1357('0x28')],0x3);assert[_0x1357('0x1c')](ssln[_0x1357('0x40')][0x2][_0x1357('0x7')],0x0);});it('stream\x20aggregates\x20calculated\x20correctly\x20for\x20#2\x20insertion',function(){assert[_0x1357('0x20')](ssln[_0x1357('0x40')][0x1],{'stampm':0x155e9020680,'dimml':0x1,'dimml|max|21600000':0x1,'dimml|max|86400000':0x1,'dimml|ma|21600000':0.5,'dimml|ma|604800000':0.5,'dimml|ma|86400000':0.5,'dimml|min|21600000':0x0,'dimml|min|86400000':0x0,'dimml|variance|21600000':0.5,'dimml|variance|86400000':0.5,'pact':0x1,'pact|max|21600000':0x1,'pact|max|86400000':0x1,'pact|ma|21600000':0.5,'pact|ma|604800000':0.5,'pact|ma|86400000':0.5,'pact|min|21600000':0x0,'pact|min|86400000':0x0,'pact|variance|21600000':0.5,'pact|variance|86400000':0.5});});it('9\x20more\x20data\x20insertions',function(){for(let _0x32ed95=0x1;_0x32ed95<=0x9;_0x32ed95++){let _0x1a4fe3=0x155e9020a68+_0x32ed95*0x3e8;let _0x4485f9=_0x32ed95+0x1;let _0x311b3a=_0x32ed95+0x1;ssln['processRecord'](JSON[_0x1357('0x5b')]('{\x22stampm\x22:'+_0x1a4fe3+_0x1357('0x5e')+_0x4485f9+_0x1357('0x5f')+_0x311b3a+'}'));}assert[_0x1357('0x1c')](ssln[_0x1357('0x40')][_0x1357('0x28')],0xc);assert[_0x1357('0x20')](ssln[_0x1357('0x40')][0xb],{'stampm':0x155e9022d90,'dimml':0xa,'dimml|max|21600000':0xa,'dimml|max|86400000':0xa,'dimml|ma|21600000':4.583333333333333,'dimml|ma|604800000':4.583333333333333,'dimml|ma|86400000':4.583333333333333,'dimml|min|21600000':0x0,'dimml|min|86400000':0x0,'dimml|variance|21600000':12.083333333333336,'dimml|variance|86400000':12.083333333333336,'pact':0xa,'pact|max|21600000':0xa,'pact|max|86400000':0xa,'pact|ma|21600000':4.583333333333333,'pact|ma|604800000':4.583333333333333,'pact|ma|86400000':4.583333333333333,'pact|min|21600000':0x0,'pact|min|86400000':0x0,'pact|variance|21600000':12.083333333333336,'pact|variance|86400000':12.083333333333336});});it('duplicate\x20insertions\x20test',function(){ssln['processRecord'](JSON[_0x1357('0x5b')](_0x1357('0x5c')));ssln[_0x1357('0x5a')](JSON['parse'](_0x1357('0x60')));assert[_0x1357('0x1c')](ssln[_0x1357('0x40')]['length'],0xc);});});});