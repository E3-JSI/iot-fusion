var _0x13ca=['max','min','variance','winbuf','voltage','N1_24h','kafka','Substation','current|ma|000','value','voltage|ma|000','current|ma|3600000','current|ma|21600000','current|max|21600000','current|variance|21600000','voltage|ma|21600000','voltage|min|21600000','voltage|variance|21600000','current|ma|86400000','current|max|86400000','current|variance|86400000','voltage|ma|86400000','voltage|max|86400000','voltage|variance|86400000','current|ma|604800000','static','timeOfDay','weekEnd','dayAfterHoliday','dayBeforeHoliday','dayOfWeek','dayOfYear','monthOfYear','weather','temperature1','humidity1','pressure1','windSpeed1','windBearing1','cloudCover1','removeFolder','./db2/','createClean','nodes','initialization','equal','check\x20if\x20store\x20exists','rawstore','name','deepEqual','fields','Time','datetime','float','power','aggregates\x20initialized\x20-\x20number','length','aggregates\x20initialized\x20-\x20key\x20names','keys','aggregate','current|tick','current|winbuf|3600000','current|min|21600000','current|winbuf|86400000','current|winbuf|604800000','voltage|tick','voltage|winbuf|3600000','voltage|ma|3600000','voltage|winbuf|21600000','voltage|winbuf|86400000','voltage|min|86400000','voltage|ma|604800000','fusionNodeI\x20correctly\x20saved','fusionNodeI','callback\x20function\x20should\x20be\x20set','processRecordCb','parent\x20saved','parent','buffer\x20position\x20is\x200','master','isMaster\x20function','isMaster','broadcastAggregates','function','createAggregates\x20function\x20exists','createAggregates','offsetExists\x20function\x20exists','offsetExists','deleteObsoleteRows','checkDataAvailability','setSlaveOffset\x20function\x20exists','setMasterOffset\x20function\x20exists','getOffsetTimestamp','getAggregates\x20function\x20exists','getAggregates','getPartialFeatureVector\x20function\x20exists','getPartialFeatureVector','master\x20set\x20correctly','setMasterOffset','position','slave\x20offset\x20set\x20correctly:\x20no\x20data','setSlaveOffset','data\x20insertion','data\x20record\x20saved\x20correctly','processRecord','parse','{\x22timestamp\x22:1538737201000,\x22current\x22:13,\x22voltage\x22:242.45}','{\x22timestamp\x22:1538737213000,\x22current\x22:15,\x22voltage\x22:262.45}','{\x22timestamp\x22:1538737200000,\x22current\x22:16,\x22voltage\x22:232.45}','{\x22timestamp\x22:1538737202000,\x22current\x22:18,\x22voltage\x22:252.45}','{\x22timestamp\x22:1538737213000,\x22current\x22:19,\x22voltage\x22:262.45}','log','buffer','../nodes/streamingEnergyNode.js','../nodes/streamingWeatherNode.js','../nodes/streamingTrainNode.js','../nodes/streamingSubstationNode.js','../../common/utils/fileManager.js','qminer','assert','192.168.85.98:2181','current'];(function(_0x10549d,_0x34b49d){var _0x3eb033=function(_0x9f0702){while(--_0x9f0702){_0x10549d['push'](_0x10549d['shift']());}};var _0x2c0444=function(){var _0x21c73b={'data':{'key':'cookie','value':'timeout'},'setCookie':function(_0x5ede4b,_0x1ca324,_0x2cc67f,_0x1639b2){_0x1639b2=_0x1639b2||{};var _0x5105d6=_0x1ca324+'='+_0x2cc67f;var _0x59cb1a=0x0;for(var _0x59cb1a=0x0,_0x4fcc5e=_0x5ede4b['length'];_0x59cb1a<_0x4fcc5e;_0x59cb1a++){var _0x120f4c=_0x5ede4b[_0x59cb1a];_0x5105d6+=';\x20'+_0x120f4c;var _0x5a22e8=_0x5ede4b[_0x120f4c];_0x5ede4b['push'](_0x5a22e8);_0x4fcc5e=_0x5ede4b['length'];if(_0x5a22e8!==!![]){_0x5105d6+='='+_0x5a22e8;}}_0x1639b2['cookie']=_0x5105d6;},'removeCookie':function(){return'dev';},'getCookie':function(_0x6c44fd,_0x4a4ac0){_0x6c44fd=_0x6c44fd||function(_0x3db8e9){return _0x3db8e9;};var _0x5d7431=_0x6c44fd(new RegExp('(?:^|;\x20)'+_0x4a4ac0['replace'](/([.$?*|{}()[]\/+^])/g,'$1')+'=([^;]*)'));var _0x4f3b32=function(_0x423907,_0x1190e7){_0x423907(++_0x1190e7);};_0x4f3b32(_0x3eb033,_0x34b49d);return _0x5d7431?decodeURIComponent(_0x5d7431[0x1]):undefined;}};var _0x5ca2fe=function(){var _0x51b0e3=new RegExp('\x5cw+\x20*\x5c(\x5c)\x20*{\x5cw+\x20*[\x27|\x22].+[\x27|\x22];?\x20*}');return _0x51b0e3['test'](_0x21c73b['removeCookie']['toString']());};_0x21c73b['updateCookie']=_0x5ca2fe;var _0x36c011='';var _0x144717=_0x21c73b['updateCookie']();if(!_0x144717){_0x21c73b['setCookie'](['*'],'counter',0x1);}else if(_0x144717){_0x36c011=_0x21c73b['getCookie'](null,'counter');}else{_0x21c73b['removeCookie']();}};_0x2c0444();}(_0x13ca,0x1df));var _0x1020=function(_0x283b9d,_0x59e596){_0x283b9d=_0x283b9d-0x0;var _0x2c387f=_0x13ca[_0x283b9d];return _0x2c387f;};var _0x6123c9=function(){var _0x152b30=!![];return function(_0x14d04e,_0x12ddf9){var _0x430818=_0x152b30?function(){if(_0x12ddf9){var _0x2740d6=_0x12ddf9['apply'](_0x14d04e,arguments);_0x12ddf9=null;return _0x2740d6;}}:function(){};_0x152b30=![];return _0x430818;};}();var _0x49946f=_0x6123c9(this,function(){var _0x3b47ff=function(){return'\x64\x65\x76';},_0x46e96a=function(){return'\x77\x69\x6e\x64\x6f\x77';};var _0x160568=function(){var _0x15d7f9=new RegExp('\x5c\x77\x2b\x20\x2a\x5c\x28\x5c\x29\x20\x2a\x7b\x5c\x77\x2b\x20\x2a\x5b\x27\x7c\x22\x5d\x2e\x2b\x5b\x27\x7c\x22\x5d\x3b\x3f\x20\x2a\x7d');return!_0x15d7f9['\x74\x65\x73\x74'](_0x3b47ff['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0xb43134=function(){var _0x266533=new RegExp('\x28\x5c\x5c\x5b\x78\x7c\x75\x5d\x28\x5c\x77\x29\x7b\x32\x2c\x34\x7d\x29\x2b');return _0x266533['\x74\x65\x73\x74'](_0x46e96a['\x74\x6f\x53\x74\x72\x69\x6e\x67']());};var _0x422317=function(_0x4808fc){var _0x5115ad=~-0x1>>0x1+0xff%0x0;if(_0x4808fc['\x69\x6e\x64\x65\x78\x4f\x66']('\x69'===_0x5115ad)){_0x310360(_0x4808fc);}};var _0x310360=function(_0x18fa17){var _0x59fa8d=~-0x4>>0x1+0xff%0x0;if(_0x18fa17['\x69\x6e\x64\x65\x78\x4f\x66']((!![]+'')[0x3])!==_0x59fa8d){_0x422317(_0x18fa17);}};if(!_0x160568()){if(!_0xb43134()){_0x422317('\x69\x6e\x64\u0435\x78\x4f\x66');}else{_0x422317('\x69\x6e\x64\x65\x78\x4f\x66');}}else{_0x422317('\x69\x6e\x64\u0435\x78\x4f\x66');}});_0x49946f();const streamingNode=require('../nodes/streamingNode.js');const streamingEnergyNode=require(_0x1020('0x0'));const streamingWeatherNode=require(_0x1020('0x1'));const streamingStaticNode=require('../nodes/streamingStaticNode.js');const streamingTrainNode=require(_0x1020('0x2'));const streamingSubstationNode=require(_0x1020('0x3'));const fileManager=require(_0x1020('0x4'));const qm=require(_0x1020('0x5'));const fs=require('fs');var assert=require(_0x1020('0x6'));let connectionConfig={'zookeeper':_0x1020('0x7')};let aggrConfigs={'Substation':[{'field':_0x1020('0x8'),'tick':[{'type':'winbuf','winsize':0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]},{'type':'winbuf','winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1020('0x9')},{'type':_0x1020('0xa')},{'type':_0x1020('0xb')}]},{'type':_0x1020('0xc'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':'max'},{'type':_0x1020('0xa')},{'type':_0x1020('0xb')}]},{'type':'winbuf','winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]},{'field':_0x1020('0xd'),'tick':[{'type':_0x1020('0xc'),'winsize':0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]},{'type':'winbuf','winsize':0x6*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1020('0x9')},{'type':_0x1020('0xa')},{'type':'variance'}]},{'type':_0x1020('0xc'),'winsize':0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'},{'type':_0x1020('0x9')},{'type':'min'},{'type':_0x1020('0xb')}]},{'type':'winbuf','winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]}],'weather':[],'static':[{'field':'holiday','tick':[{'type':_0x1020('0xc'),'winsize':0x7*0x18*0x3c*0x3c*0x3e8,'sub':[{'type':'ma'}]}]}]};let fusionConfig={'fusionModel':_0x1020('0xe'),'connection':{'type':_0x1020('0xf')},'fusionTick':0x3e8,'nodes':[{'type':_0x1020('0x10'),'fusionTick':0x3e8,'nodeid':'N1','aggrConfigId':_0x1020('0x10'),'master':!![],'attributes':[{'time':0x0,'attributes':[{'type':'value','name':_0x1020('0x11')},{'type':_0x1020('0x12'),'name':_0x1020('0x13')}]},{'time':-0xe10*0x3e8,'attributes':[{'type':_0x1020('0x12'),'name':_0x1020('0x14')},{'type':'value','name':'voltage|ma|3600000'}]},{'time':-0x6*0xe10*0x3e8,'attributes':[{'type':'value','name':_0x1020('0x15')},{'type':_0x1020('0x12'),'name':_0x1020('0x16')},{'type':_0x1020('0x12'),'name':'current|min|21600000'},{'type':_0x1020('0x12'),'name':_0x1020('0x17')},{'type':_0x1020('0x12'),'name':_0x1020('0x18')},{'type':_0x1020('0x12'),'name':'voltage|max|21600000'},{'type':'value','name':_0x1020('0x19')},{'type':_0x1020('0x12'),'name':_0x1020('0x1a')}]},{'time':-0x18*0xe10*0x3e8,'attributes':[{'type':_0x1020('0x12'),'name':_0x1020('0x1b')},{'type':_0x1020('0x12'),'name':_0x1020('0x1c')},{'type':'value','name':'current|min|86400000'},{'type':_0x1020('0x12'),'name':_0x1020('0x1d')},{'type':_0x1020('0x12'),'name':_0x1020('0x1e')},{'type':_0x1020('0x12'),'name':_0x1020('0x1f')},{'type':_0x1020('0x12'),'name':'voltage|min|86400000'},{'type':'value','name':_0x1020('0x20')}]},{'time':-0x7*0x18*0xe10*0x3e8,'attributes':[{'type':'value','name':_0x1020('0x21')},{'type':_0x1020('0x12'),'name':'voltage|ma|604800000'}]}]},{'type':'static','nodeid':'S1','aggrConfigId':_0x1020('0x22'),'master':![],'attributes':[{'time':0x18*0x168*0x3e8,'attributes':[{'type':_0x1020('0x12'),'name':_0x1020('0x23')},{'type':_0x1020('0x12'),'name':_0x1020('0x24')},{'type':_0x1020('0x12'),'name':'holiday'},{'type':'value','name':_0x1020('0x25')},{'type':'value','name':_0x1020('0x26')},{'type':_0x1020('0x12'),'name':_0x1020('0x27')},{'type':_0x1020('0x12'),'name':_0x1020('0x28')},{'type':'value','name':_0x1020('0x29')}]}]},{'type':_0x1020('0x2a'),'nodeid':'W1','aggrConfigId':'weather','master':![],'attributes':[{'time':0x0,'attributes':[{'type':_0x1020('0x12'),'name':_0x1020('0x2b')},{'type':_0x1020('0x12'),'name':_0x1020('0x2c')},{'type':_0x1020('0x12'),'name':_0x1020('0x2d')},{'type':_0x1020('0x12'),'name':_0x1020('0x2e')},{'type':_0x1020('0x12'),'name':_0x1020('0x2f')},{'type':'value','name':_0x1020('0x30')}]}]}]};function processRecordDummyCb(_0x536635,_0x110282){return!![];}describe('streamingSubstationNode',function(){let _0x278327;let _0x41011c;before(function(){fileManager[_0x1020('0x31')](_0x1020('0x32'));fileManager['createFolder'](_0x1020('0x32'));_0x278327=new qm['Base']({'dbPath':_0x1020('0x32'),'mode':_0x1020('0x33')});sen=new streamingSubstationNode(_0x278327,connectionConfig,fusionConfig[_0x1020('0x34')][0x0],aggrConfigs,processRecordDummyCb,0x63,null);});after(function(){_0x278327['close']();});describe(_0x1020('0x35'),function(){it('base\x20saved',function(){assert[_0x1020('0x36')](_0x278327,sen['base']);});it(_0x1020('0x37'),function(){assert[_0x1020('0x36')](sen[_0x1020('0x38')][_0x1020('0x39')],'N1');});it('check\x20store\x20structure',function(){assert[_0x1020('0x3a')](sen[_0x1020('0x38')][_0x1020('0x3b')],[{'id':0x0,'name':_0x1020('0x3c'),'type':_0x1020('0x3d'),'nullable':![],'internal':![],'primary':![]},{'id':0x1,'name':_0x1020('0x8'),'type':_0x1020('0x3e'),'nullable':![],'internal':![],'primary':![]},{'id':0x2,'name':_0x1020('0xd'),'type':_0x1020('0x3e'),'nullable':![],'internal':![],'primary':![]},{'id':0x3,'name':_0x1020('0x3f'),'type':_0x1020('0x3e'),'nullable':![],'internal':![],'primary':![]}]);});it(_0x1020('0x40'),function(){assert[_0x1020('0x36')](Object['keys'](sen['aggregate'])[_0x1020('0x41')],0x1e);});it(_0x1020('0x42'),function(){assert[_0x1020('0x3a')](Object[_0x1020('0x43')](sen[_0x1020('0x44')]),[_0x1020('0x45'),_0x1020('0x46'),_0x1020('0x14'),'current|winbuf|21600000',_0x1020('0x15'),_0x1020('0x16'),_0x1020('0x47'),'current|variance|21600000',_0x1020('0x48'),'current|ma|86400000',_0x1020('0x1c'),'current|min|86400000',_0x1020('0x1d'),_0x1020('0x49'),_0x1020('0x21'),_0x1020('0x4a'),_0x1020('0x4b'),_0x1020('0x4c'),_0x1020('0x4d'),'voltage|ma|21600000','voltage|max|21600000',_0x1020('0x19'),_0x1020('0x1a'),_0x1020('0x4e'),_0x1020('0x1e'),_0x1020('0x1f'),_0x1020('0x4f'),_0x1020('0x20'),'voltage|winbuf|604800000',_0x1020('0x50')]);});it('config\x20saved',function(){assert['deepEqual'](sen['config'],fusionConfig[_0x1020('0x34')][0x0]);});it(_0x1020('0x51'),function(){assert[_0x1020('0x36')](sen[_0x1020('0x52')],0x63);});it(_0x1020('0x53'),function(){assert['equal'](typeof sen[_0x1020('0x54')],'function');});it(_0x1020('0x55'),function(){assert[_0x1020('0x36')](sen[_0x1020('0x56')],null);});it('buffer\x20empty',function(){assert[_0x1020('0x3a')](sen['buffer'],[]);});it(_0x1020('0x57'),function(){assert[_0x1020('0x36')](sen['position'],0x0);});it('master\x20flag\x20set\x20correctly',function(){assert[_0x1020('0x36')](sen[_0x1020('0x58')],!![]);});it(_0x1020('0x59'),function(){assert[_0x1020('0x36')](sen[_0x1020('0x5a')](),!![]);});it('connectToKafka\x20function\x20exists',function(){assert[_0x1020('0x36')](typeof sen['connectToKafka'],'function');});it('broadcastAggregates\x20function\x20exists',function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x5b')],_0x1020('0x5c'));});it(_0x1020('0x5d'),function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x5e')],_0x1020('0x5c'));});it(_0x1020('0x5f'),function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x60')],_0x1020('0x5c'));});it('deleteObsoleteRows\x20function\x20exists',function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x61')],_0x1020('0x5c'));});it('checkDataAvailability\x20function\x20exists',function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x62')],_0x1020('0x5c'));});it(_0x1020('0x63'),function(){assert[_0x1020('0x36')](typeof sen['setSlaveOffset'],_0x1020('0x5c'));});it('getOffsetTimestamp\x20function\x20exists',function(){assert[_0x1020('0x36')](typeof sen['getOffsetTimestamp'],_0x1020('0x5c'));});it(_0x1020('0x64'),function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x65')],'function');});it(_0x1020('0x66'),function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x67')],_0x1020('0x5c'));});it(_0x1020('0x68'),function(){assert[_0x1020('0x36')](typeof sen[_0x1020('0x69')],_0x1020('0x5c'));});it(_0x1020('0x6a'),function(){assert[_0x1020('0x36')](sen['isMaster'](),!![]);});it('master\x20offset\x20set\x20correctly',function(){sen[_0x1020('0x6b')]();assert[_0x1020('0x36')](sen[_0x1020('0x6c')],-0x1);});it(_0x1020('0x6d'),function(){assert[_0x1020('0x36')](sen[_0x1020('0x6e')](0x0),![]);});});describe(_0x1020('0x6f'),function(){it(_0x1020('0x70'),function(){sen[_0x1020('0x71')](JSON[_0x1020('0x72')]('{\x22timestamp\x22:1538737200000,\x22current\x22:12,\x22voltage\x22:232.45}'));sen[_0x1020('0x71')](JSON['parse'](_0x1020('0x73')));sen['processRecord'](JSON[_0x1020('0x72')]('{\x22timestamp\x22:1538737202000,\x22current\x22:14,\x22voltage\x22:252.45}'));sen['processRecord'](JSON[_0x1020('0x72')](_0x1020('0x74')));sen[_0x1020('0x71')](JSON['parse'](_0x1020('0x75')));sen[_0x1020('0x71')](JSON['parse']('{\x22timestamp\x22:1538737201000,\x22current\x22:17,\x22voltage\x22:242.45}'));sen[_0x1020('0x71')](JSON[_0x1020('0x72')](_0x1020('0x76')));sen[_0x1020('0x71')](JSON[_0x1020('0x72')](_0x1020('0x77')));console[_0x1020('0x78')]('buffer\x20values');console[_0x1020('0x78')](sen[_0x1020('0x79')]);});});});